# Финальная версия прошивки ESP32 котла

## Версия: Final
**Дата создания:** Текущая стабильная версия

## Описание

Финальная стабильная версия прошивки для управления котлом на ESP32 со всеми реализованными функциями и исправлениями.

## Основные функции

### Управление котлом
- Автоматическое управление вентилятором и насосом
- Защита от перегрева (порог настраивается, по умолчанию 82°C)
- Защита от разгона без наддува (тест вентилятора)
- Обнаружение прогорания угля
- Защита от застоя насоса (антистагнация)
- Таймаут разогрева с предупреждением

### Мониторинг
- Температура подачи, обратки, котельной, уличная, дома (MQTT)
- История температур для анализа трендов
- Отображение состояния логики с таймерами
- Предупреждения о критических состояниях

### Веб-интерфейс
- Адаптивный дизайн для мобильных устройств
- Индикатор состояния логики в карточке уставки
- Таймеры для активных состояний (разогрев, тест вентилятора, подброс угля)
- Звуковое предупреждение о перегреве (каждые 5 секунд)
- Кнопка отключения звука с автоматическим включением после выхода из перегрева
- Увеличенная карточка подачи и уставки (в 3 раза)

### Дополнительные функции
- MQTT публикация данных
- OTA обновления прошивки и SPIFFS
- OLED дисплей
- Энкодер для управления
- NTP синхронизация времени
- WiFi Manager для настройки сети

## Структура проекта

- `src/` - исходный код прошивки
- `include/` - заголовочные файлы
- `data/` - файлы для SPIFFS (веб-интерфейс)
- `lib/` - библиотеки проекта
- `platformio.ini` - конфигурация PlatformIO

## Компиляция и загрузка

```bash
# Компиляция
pio run -e esp32dev_ota

# Загрузка прошивки
pio run -e esp32dev_ota -t upload

# Загрузка SPIFFS
pio run -e esp32dev_ota -t uploadfs
```

## OTA обновление

IP адрес устройства: **192.168.0.197** (проверьте в настройках)

Используйте PlatformIO в VS Code/Cursor или скрипты из корневой папки проекта.

## Настройки по умолчанию

- **Температура перегрева:** 82°C
- **Уставка:** 60°C
- **Минимальная температура:** 45°C
- **Максимальная температура:** 75°C
- **Гистерезис:** 2°C
- **Таймаут разогрева:** 30 минут

## Особенности реализации

1. **Индикатор состояния логики** - показывает текущее состояние работы котла с таймерами
2. **Звуковое предупреждение** - писк каждые 5 секунд при перегреве с возможностью отключения
3. **Валидация настроек** - все значения проверяются на корректность
4. **Защита от ошибок** - множественные проверки безопасности

## История изменений

- Исправлена логика отображения предупреждения о перегреве
- Добавлена валидация значения температуры перегрева
- Добавлен звуковой сигнал при перегреве
- Добавлены таймеры для активных состояний
- Улучшен веб-интерфейс

