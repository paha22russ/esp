# MQTT –¢–æ–ø–∏–∫–∏ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ç–ª–æ–º ESP32

## –ü—Ä–µ—Ñ–∏–∫—Å —Ç–æ–ø–∏–∫–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `kotel/device1` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ)

---

## üì§ –ü—É–±–ª–∏–∫—É–µ–º—ã–µ —Ç–æ–ø–∏–∫–∏ (–æ—Ç ESP32)

### –ü—Ä–æ—Å—Ç—ã–µ —Ç–æ–ø–∏–∫–∏ (–ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)

#### `{prefix}/simple/temp`
**–¢–∏–ø:** –ß–∏—Å–ª–æ (float)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏ –∫–æ—Ç–ª–∞  
**–ü—Ä–∏–º–µ—Ä:** `65.5`

#### `{prefix}/simple/enabled`
**–¢–∏–ø:** –°—Ç—Ä–æ–∫–∞ (`"1"` –∏–ª–∏ `"0"`)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–≤–∫–ª—é—á–µ–Ω–∞/–≤—ã–∫–ª—é—á–µ–Ω–∞)  
**–ü—Ä–∏–º–µ—Ä:** `1` (–≤–∫–ª—é—á–µ–Ω–∞) –∏–ª–∏ `0` (–≤—ã–∫–ª—é—á–µ–Ω–∞)

#### `{prefix}/simple/setpoint`
**–¢–∏–ø:** –ß–∏—Å–ª–æ (float)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –£—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã  
**–ü—Ä–∏–º–µ—Ä:** `60.0`

#### `{prefix}/simple/sensors`
**–¢–∏–ø:** –°—Ç—Ä–æ–∫–∞ (`"1"` –∏–ª–∏ `"0"`)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ª–µ –ø–∏—Ç–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ DS18B20  
**–ü—Ä–∏–º–µ—Ä:** `1` (–≤–∫–ª—é—á–µ–Ω–æ) –∏–ª–∏ `0` (–≤—ã–∫–ª—é—á–µ–Ω–æ)  
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `1` = –ø–∏—Ç–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤ –≤–∫–ª—é—á–µ–Ω–æ, `0` = –ø–∏—Ç–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ

#### `{prefix}/simple/ip`
**–¢–∏–ø:** –°—Ç—Ä–æ–∫–∞ (IP –∞–¥—Ä–µ—Å)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** IP –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Å–µ—Ç–∏  
**–ü—Ä–∏–º–µ—Ä:** `192.168.0.197`  
**Retain:** –î–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –±—Ä–æ–∫–µ—Ä–µ)

---

### –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)

#### `{prefix}/state`
**–¢–∏–ø:** JSON –æ–±—ä–µ–∫—Ç  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã  
**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "supplyTemp": 65.5,
  "returnTemp": 55.2,
  "boilerTemp": 70.0,
  "outdoorTemp": -5.0,
  "homeTemp": 22.0,
  "setpoint": 60.0,
  "fanState": true,
  "pumpState": true,
  "systemEnabled": true,
  "systemState": "HEATING",
  "coalFeeding": false,
  "sensorsRelayState": true,
  ...
}
```

---

### –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### `{prefix}/status`
**–¢–∏–ø:** –°—Ç—Ä–æ–∫–∞ (`"online"` –∏–ª–∏ `"offline"`)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞  
**Retain:** –î–∞  
**–ü—Ä–∏–º–µ—Ä:** `online`

---

### ML –¥–∞–Ω–Ω—ã–µ (–ø—É–±–ª–∏–∫—É—é—Ç—Å—è —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫—É–Ω–¥)

#### `{prefix}/ml/data`
**–¢–∏–ø:** JSON –æ–±—ä–µ–∫—Ç  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏  
**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "timestamp": 1704115200,
  "supplyTemp": 65.5,
  "returnTemp": 55.2,
  "boilerTemp": 70.0,
  "outdoorTemp": -5.0,
  "homeTemp": 22.0,
  "setpoint": 60.0,
  "fanState": true,
  "pumpState": true,
  "systemEnabled": true,
  ...
}
```

---

## üì• –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—ã–µ —Ç–æ–ø–∏–∫–∏ (–∫–æ–º–∞–Ω–¥—ã –¥–ª—è ESP32)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–≤–∫–æ–π

#### `{prefix}/setpoint/set`
**–¢–∏–ø:** –ß–∏—Å–ª–æ (float)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–π —É—Å—Ç–∞–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã  
**–î–∏–∞–ø–∞–∑–æ–Ω:** 40.0 - 80.0  
**–ü—Ä–∏–º–µ—Ä:** `65.5`

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–µ –ø–∏—Ç–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤

#### `{prefix}/sensors/reset`
**–¢–∏–ø:** –°—Ç—Ä–æ–∫–∞  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–µ –ø–∏—Ç–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ DS18B20 –¥–ª—è —Å–±—Ä–æ—Å–∞ –æ—à–∏–±–æ–∫  
**–ó–Ω–∞—á–µ–Ω–∏—è:**
- `"1"`, `"on"`, `"reset"` - –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±—Ä–æ—Å (–≤—ã–∫–ª—é—á–∏—Ç—å –Ω–∞ 500–º—Å, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∏—Ç—å)
- `"0"`, `"off"` - –í—ã–∫–ª—é—á–∏—Ç—å —Ä–µ–ª–µ (–æ—Ç–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤)

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –°–±—Ä–æ—Å –¥–∞—Ç—á–∏–∫–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
mosquitto_pub -h mqtt.broker.com -t "kotel/device1/sensors/reset" -m "reset"

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ "1"
mosquitto_pub -h mqtt.broker.com -t "kotel/device1/sensors/reset" -m "1"

# –í—ã–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤
mosquitto_pub -h mqtt.broker.com -t "kotel/device1/sensors/reset" -m "0"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥—ã `"reset"`, `"1"` –∏–ª–∏ `"on"` —Ä–µ–ª–µ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ 500 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤ DS18B20 –Ω–∞ –æ–±–µ–∏—Ö —à–∏–Ω–∞—Ö (GPIO 4 –∏ GPIO 5) –∏ —Å–±—Ä–æ—Å—É –æ—à–∏–±–æ–∫.

---

### –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –¥–æ–º–µ (–æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

#### `home/esp01/temperature`
**–¢–∏–ø:** –ß–∏—Å–ª–æ (float)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –¥–æ–º–µ, –ø–æ–ª—É—á–∞–µ–º–∞—è –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ESP01)  
**–î–∏–∞–ø–∞–∑–æ–Ω:** -50.0 - 50.0  
**–ü—Ä–∏–º–µ—Ä:** `22.5`

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–±—Ä–æ—Å –¥–∞—Ç—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ MQTT

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è mosquitto_pub
mosquitto_pub -h m5.wqtt.ru -p 5374 -u u_OLTTB0 -P XDzCIXr0 \
  -t "kotel/device1/sensors/reset" -m "reset"

# –ò—Å–ø–æ–ª—å–∑—É—è Python (paho-mqtt)
import paho.mqtt.client as mqtt

client = mqtt.Client()
client.username_pw_set("u_OLTTB0", "XDzCIXr0")
client.connect("m5.wqtt.ru", 5374)
client.publish("kotel/device1/sensors/reset", "reset")
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ª–µ –¥–∞—Ç—á–∏–∫–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è mosquitto_sub
mosquitto_sub -h m5.wqtt.ru -p 5374 -u u_OLTTB0 -P XDzCIXr0 \
  -t "kotel/device1/simple/sensors"

# –ë—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å: "1" (–≤–∫–ª—é—á–µ–Ω–æ) –∏–ª–∏ "0" (–≤—ã–∫–ª—é—á–µ–Ω–æ)
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ MQTT

```bash
mosquitto_pub -h m5.wqtt.ru -p 5374 -u u_OLTTB0 -P XDzCIXr0 \
  -t "kotel/device1/setpoint/set" -m "65.0"
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ –≤–∫–ª–∞–¥–∫–µ **"üì° MQTT"**:
- –°–µ—Ä–≤–µ—Ä MQTT
- –ü–æ—Ä—Ç
- –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å
- –ü—Ä–µ—Ñ–∏–∫—Å —Ç–æ–ø–∏–∫–æ–≤
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **QoS:** 0 (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏) –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–æ–ø–∏–∫–æ–≤
- **Retain:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è `/status` –∏ `/simple/ip`
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã—Ö —Ç–æ–ø–∏–∫–æ–≤:** 30 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:** 30 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ML –¥–∞–Ω–Ω—ã—Ö:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫—É–Ω–¥)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. –í—Å–µ —Ç–æ–ø–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `kotel/device1`)
2. –†–µ–ª–µ –¥–∞—Ç—á–∏–∫–æ–≤ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Ç–∞–Ω–∏–µ–º –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤ DS18B20 –Ω–∞ –æ–±–µ–∏—Ö —à–∏–Ω–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. –ü—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞—Ç—á–∏–∫–æ–≤ –ø–∏—Ç–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ 500–º—Å, –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
4. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ª–µ –¥–∞—Ç—á–∏–∫–æ–≤ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ —Ç–æ–ø–∏–∫–µ `/simple/sensors` –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
