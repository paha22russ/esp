# Changelog - Версия 4.2.0 Demo

## [4.2.0] - 2024-12-XX

### Добавлено
- Отображение загрузки CPU на OLED дисплее
  - Обновление раз в секунду
  - Формат: "CPU: X.X%"
  - Показывается в свободной строке (когда подброс угля не активен)

### Изменено
- Оптимизирован веб-сервер для быстрой загрузки
  - Добавлены заголовки кеширования (Cache-Control: max-age=3600)
  - Keep-alive соединения для быстрых последующих запросов
  - Приоритет обработке веб-запросов в loop()
- Уменьшена задержка при старте (с 1000 мс до 500 мс)
- Уменьшена задержка перед перезагрузкой (с 3000 мс до 1000 мс)

### Удалено
- ~200+ отладочных сообщений Serial.print/println (оставлены только критичные ошибки)
- Сложное меню с OLED дисплея (возвращено простое отображение)
- Режим "тест вентилятора"
- Лишние проверки SPIFFS в handleWebInterface()

### Исправлено
- Оптимизирована обработка веб-запросов (быстрее загрузка интерфейса)
- Улучшена производительность основного цикла (меньше блокирующих операций)

### Технические детали

#### Загрузка CPU
- Измерение времени выполнения каждого loop() в микросекундах
- Накопление суммарного времени за период обновления (1 секунда)
- Вычисление средней загрузки CPU
- Защита от переполнения micros()

#### Оптимизация веб-сервера
- Потоковая передача файлов из SPIFFS (server.streamFile())
- Заголовки кеширования для браузера
- Keep-alive соединения
- Приоритет обработке веб-запросов

#### Оптимизация кода
- Убраны лишние отладочные сообщения из:
  - Обработки энкодера
  - MQTT подключения и публикации
  - WiFi подключения
  - OTA обновлений
  - Обработки датчиков
  - Сохранения/загрузки настроек
- Упрощена функция handleWebInterface()
- Оптимизирован setup() (убраны лишние проверки)

### Производительность
- Уменьшена нагрузка на Serial порт
- Быстрее старт системы
- Быстрее загрузка веб-интерфейса (особенно при повторных открытиях)
- Меньше использование памяти (убраны лишние строки)

### Совместимость
- Совместима с предыдущими версиями (настройки EEPROM)
- Все функции работают как прежде
- Веб-интерфейс без изменений (только оптимизация загрузки)
