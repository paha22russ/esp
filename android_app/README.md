# Android приложение для управления котлом

## Описание

Android приложение для мониторинга и управления твердотопливным котлом через MQTT.

## Возможности

- ✅ Отображение температур в реальном времени (Подача, Обратка, Котельная, Улица, Дом)
- ✅ Управление уставкой температуры
- ✅ Управление системой (включение/выключение)
- ✅ Управление вентилятором и насосом
- ✅ Управление подбросом угля
- ✅ Отображение статуса подключения MQTT
- ✅ Настройки MQTT подключения

## Требования

- Android Studio Hedgehog (2023.1.1) или новее
- Android SDK 24 (Android 7.0) или выше
- Kotlin 1.9.20+

## Установка и запуск

1. Откройте проект в Android Studio
2. Дождитесь синхронизации Gradle
3. Подключите Android устройство или запустите эмулятор
4. Нажмите Run (Shift+F10)

## Настройка MQTT

При первом запуске приложения необходимо настроить MQTT подключение:

1. Откройте меню (три точки в правом верхнем углу)
2. Выберите "Настройки"
3. Заполните параметры:
   - **Сервер**: `m5.wqtt.ru` (или ваш MQTT брокер)
   - **Порт**: `5374` (или порт вашего брокера)
   - **Пользователь**: `u_OLTTB0` (или ваш логин)
   - **Пароль**: `XDzCIXr0` (или ваш пароль)
   - **Префикс топиков**: `kotel/device1` (или ваш префикс)
4. Нажмите "Сохранить"

## Структура проекта

```
android_app/
├── app/
│   ├── src/main/
│   │   ├── java/com/kotel/control/
│   │   │   ├── MainActivity.kt          # Главная активность
│   │   │   ├── SettingsActivity.kt      # Настройки
│   │   │   ├── mqtt/
│   │   │   │   └── MqttManager.kt       # Менеджер MQTT подключения
│   │   │   └── ui/
│   │   │       └── TemperatureCard.kt   # UI компонент для температуры
│   │   ├── res/
│   │   │   ├── layout/                  # XML layouts
│   │   │   ├── values/                  # Strings, colors, themes
│   │   │   └── menu/                     # Меню
│   │   └── AndroidManifest.xml
│   └── build.gradle
├── build.gradle                          # Корневой build.gradle
├── settings.gradle
└── README.md
```

## MQTT Топики

### Подписки (чтение данных)

- `{prefix}/simple/temp` - Температура подачи
- `{prefix}/simple/returnTemp` - Температура обратки
- `{prefix}/simple/outdoorTemp` - Температура улицы
- `{prefix}/simple/boilerTemp` - Температура котельной
- `{prefix}/simple/enabled` - Состояние системы (1/0)
- `{prefix}/simple/setpoint` - Уставка температуры
- `{prefix}/state` - Полное состояние системы (JSON)

### Публикации (управление)

- `{prefix}/setpoint/set` - Установка уставки (число, например: "60.5")
- `{prefix}/system/enable` - Включение/выключение системы ("1"/"0")
- `{prefix}/control/fan` - Управление вентилятором ("1"/"0")
- `{prefix}/control/pump` - Управление насосом ("1"/"0")
- `{prefix}/coalFeeding` - Подброс угля ("toggle")

## Зависимости

- **Material Design Components** - UI компоненты
- **Eclipse Paho MQTT** - MQTT клиент
- **Retrofit** - HTTP клиент (для будущего использования HTTP API)
- **Gson** - JSON парсинг
- **Kotlin Coroutines** - Асинхронные операции

## Разработка

### Добавление новых функций

1. Температуры отображаются автоматически при получении MQTT сообщений
2. Для добавления новых элементов управления:
   - Добавьте UI элементы в `activity_main.xml`
   - Добавьте обработчики в `MainActivity.kt`
   - Добавьте методы публикации в `MqttManager.kt`

### Использование HTTP API (альтернатива MQTT)

Приложение может работать через HTTP API вместо MQTT:
- `GET http://IP/api/status` - Получение статуса
- `POST http://IP/api/setpoint?value=60` - Установка уставки
- `POST http://IP/api/control?device=fan&state=1` - Управление устройством
- `POST http://IP/api/system/enable?enabled=1` - Управление системой

Для реализации HTTP API можно использовать Retrofit (уже добавлен в зависимости).

## Лицензия

Проект для внутреннего использования.
