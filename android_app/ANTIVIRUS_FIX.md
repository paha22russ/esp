# КРИТИЧНО: Проблема с антивирусом

## Ошибка: "Отказано в доступе" / "Access Denied"

Эта ошибка означает, что **антивирус блокирует доступ к файлам Gradle**.

## Решение

### Шаг 1: Добавьте в исключения антивируса

**ОБЯЗАТЕЛЬНО добавьте эти папки и файлы в исключения:**

1. `C:\Users\Pavel\.gradle` - **ВЕСЬ кеш Gradle**
2. `C:\Users\Pavel\Yandex.Disk\Arduino\Projects\kotel_esp32\android_app` - **ВЕСЬ проект Android**
3. `C:\Program Files\Android\Android Studio\jbr\bin\jlink.exe` - **Файл jlink.exe (критично для SDK 34!)**
4. `C:\Users\Pavel\AppData\Local\Android\Sdk` - **ВЕСЬ Android SDK**

### Шаг 2: Как добавить в исключения (примеры)

#### Windows Defender:
1. Откройте "Безопасность Windows"
2. Защита от вирусов и угроз → Управление настройками
3. Исключения → Добавить или удалить исключения
4. Добавьте папки (см. выше)

#### Другие антивирусы:
- **Kaspersky**: Настройки → Дополнительно → Угрозы и исключения → Исключения
- **Avast**: Настройки → Общие → Исключения
- **Norton**: Настройки → Антивирус → Сканирование и риски → Исключения

### Шаг 3: Очистка кеша

1. Закройте Android Studio **ПОЛНОСТЬЮ**
2. Запустите `clean_gradle_cache.bat`
3. Подождите 10 секунд

### Шаг 4: Перезапуск

1. Откройте Android Studio
2. File → Invalidate Caches / Restart → Invalidate and Restart
3. Дождитесь синхронизации (5-10 минут)

### Шаг 5: Сборка

1. Build → Clean Project
2. Build → Rebuild Project
3. Build → Build Bundle(s) / APK(s) → Build APK(s)

## Альтернативное решение 1: Сборка без кеша

Если добавление в исключения не помогает, попробуйте собрать БЕЗ кеша:

1. Закройте Android Studio
2. Запустите `gradlew_without_cache.bat` в папке `android_app`
3. Этот скрипт использует временный кеш в папке TEMP
4. Дождитесь завершения сборки
5. APK будет в: `app\build\outputs\apk\debug\app-debug.apk`

## Альтернативное решение 2: Временное отключение антивируса

Если ничего не помогает:

1. **Временно отключите антивирус** на время сборки (10-15 минут)
2. Выполните очистку (`clean_gradle_cache.bat`)
3. Откройте Android Studio
4. Build → Clean Project
5. Build → Rebuild Project
6. Build → Build Bundle(s) / APK(s) → Build APK(s)
7. **Включите антивирус обратно** после успешной сборки

## Проверка

После добавления в исключения, проверьте:
- Файлы в `%USERPROFILE%\.gradle\caches` не удаляются автоматически
- Gradle может создавать и читать файлы без ошибок

## КРИТИЧНО: Проблема с jlink.exe

Если вы видите ошибку:
```
Error while executing process ...\jlink.exe
```

Это означает, что **антивирус блокирует выполнение `jlink.exe`**, который необходим для Android SDK 34.

### Решение:

1. **Добавьте `jlink.exe` в исключения антивируса:**
   - Путь: `C:\Program Files\Android\Android Studio\jbr\bin\jlink.exe`
   - Или весь каталог: `C:\Program Files\Android\Android Studio\jbr\bin\`

2. **Добавьте папку Android SDK в исключения:**
   - Путь: `C:\Users\Pavel\AppData\Local\Android\Sdk`

3. **Перезапустите Android Studio** после добавления исключений

4. **Попробуйте собрать снова**

### Альтернатива (если не помогает):

Временно отключите антивирус на время сборки (10-15 минут), затем включите обратно.

## Важно

**НЕ удаляйте папки из исключений** после успешной сборки - они нужны для всех будущих сборок!
