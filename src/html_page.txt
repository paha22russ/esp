<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ç–ª–æ–º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            padding: 10px;
            color: #fff;
            overflow-x: hidden;
        }
        
        /* –ü–µ—Ä–µ–≥—Ä–µ–≤ - —è—Ä–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω */
        body.overheat {
            background: #cc0000 !important;
            animation: overheatPulse 1s infinite;
        }
        
        @keyframes overheatPulse {
            0%, 100% { background: #cc0000; }
            50% { background: #ff3333; }
        }
        
        /* –ü–æ–≥–∞—Å–∞–Ω–∏–µ - –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ñ–æ–Ω (–Ω–µ —è—Ä–∫–æ) */
        body.extinguishing {
            background: #3a2a1a;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            background: #2a2a2a;
            border-radius: 0;
            overflow-x: hidden;
            position: relative;
            border: none;
            min-height: 100vh;
            box-shadow: none;
        }

        .header {
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
            border-radius: 0;
            margin-bottom: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            position: relative;
            border-bottom: 2px solid #3a3a3a;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 400;
            letter-spacing: 1px;
            flex: 1;
            margin: 0;
            color: #ff6b35;
        }

        .menu-button {
            background: linear-gradient(135deg, #3a3a3a 0%, #2a2a2a 100%);
            border: 1px solid #4a4a4a;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-button:hover {
            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        }
        
        .menu-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: #2a2a2a;
            border-radius: 8px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            min-width: 200px;
            z-index: 2000;
            display: none;
            margin-top: 5px;
            overflow: hidden;
            border: 1px solid #3a3a3a;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            color: #fff !important;
            border-bottom: 1px solid #3a3a3a;
            transition: background 0.2s;
            font-size: 0.95em;
        }

        .dropdown-item:hover {
            background: #3a3a3a;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .status-bar {
            background: rgba(0,0,0,0.2);
            padding: 10px 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px 15px;
            font-size: 0.75em;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .status-indicator:hover {
            background: rgba(255,255,255,0.08);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
            flex-shrink: 0;
            box-shadow: 0 0 4px rgba(40, 167, 69, 0.5);
        }
        
        .status-dot.success {
            background: #28a745;
            animation: pulse 2s infinite;
            box-shadow: 0 0 4px rgba(40, 167, 69, 0.5);
        }
        
        .status-dot.warning {
            background: #ffc107;
            animation: pulse 2s infinite;
            box-shadow: 0 0 4px rgba(255, 193, 7, 0.5);
        }
        
        .status-dot.danger { 
            background: #dc3545;
            animation: blink 1s infinite;
            box-shadow: 0 0 4px rgba(220, 53, 69, 0.5);
        }
        
        .status-dot.info {
            background: #17a2b8;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 4px rgba(23, 162, 184, 0.5);
        }
        
        .status-dot.idle {
            background: #6c757d;
            animation: none;
            box-shadow: none;
        }
        
        .status-indicator strong {
            font-weight: 600;
            color: #fff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .state-display {
            font-size: 0.9em;
            font-weight: 500;
            color: #fff;
        }

        /* WiFi Signal Bars */
        .wifi-signal-bars {
            display: inline-flex;
            align-items: flex-end;
            gap: 2px;
            height: 12px;
            margin-right: 4px;
        }

        .wifi-bar {
            width: 3px;
            background: #6c757d;
            border-radius: 1px 1px 0 0;
            transition: all 0.3s;
        }

        .wifi-bar.bar1 {
            height: 3px;
        }

        .wifi-bar.bar2 {
            height: 5px;
        }

        .wifi-bar.bar3 {
            height: 7px;
        }

        .wifi-bar.bar4 {
            height: 9px;
        }

        .wifi-bar.active {
            background: #2ECC71;
        }

        .wifi-bar.warning {
            background: #F39C12;
        }

        .wifi-bar.danger {
            background: #E74C3C;
        }

        .wifi-rssi-text {
            font-size: 0.85em;
            opacity: 0.9;
            font-weight: 500;
        }

        .main-page {
            padding: 8px;
            padding-bottom: 15px;
        }

        .temperature-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .temp-card {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            position: relative;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .temp-card.main-temp-card {
            padding: 12px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–∞—á–∏ –∏ —É—Å—Ç–∞–≤–∫–∏ - —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤ 3 —Ä–∞–∑–∞ */
        #supplyTempCard {
            padding: 30px !important;
            border-radius: 30px !important;
        }
        
        #supplyTempCard .supply-label {
            font-size: 33px !important;
            margin-bottom: 18px !important;
        }
        
        #supplyTempCard .supply-value {
            font-size: 84px !important;
            margin: 24px 0 !important;
        }
        
        #supplyTempCard .setpoint-value {
            font-size: 60px !important;
            margin: 12px 0 !important;
        }
        
        #supplyTempCard .setpoint-label {
            font-size: 30px !important;
            margin-bottom: 12px !important;
        }
        
        #supplyTempCard .setpoint-btn {
            padding: 4px 12px !important;
            font-size: 14px !important;
            min-width: 40px !important;
            height: 32px !important;
        }
        
        #supplyTempCard .setpoint-section {
            margin-top: 24px !important;
            padding-top: 24px !important;
        }
        
        #supplyTempCard .setpoint-control-wrapper {
            gap: 15px !important;
        }

        .temp-card:hover {
            transform: translateY(-2px);
            box-shadow: 7px 7px 15px rgba(0,0,0,0.4);
        }

        .temp-card.overheat {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .temp-label {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 6px;
        }

        .temp-value {
            font-size: 28px;
            font-weight: 300;
            color: #ff6b35;
            margin: 8px 0;
        }
        
        .temp-value.setpoint {
            font-size: 20px;
            color: #aaa;
            margin: 4px 0;
        }

        .temp-unit {
            font-size: 0.4em;
            opacity: 0.8;
        }

        .temp-trend-arrow {
            display: inline-block;
            font-size: 0.5em;
            margin-left: 4px;
            animation: trendPulse 3s ease-in-out infinite;
            opacity: 0.7;
        }

        .temp-trend-arrow.up {
            color: #2ECC71; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è —Ä–æ—Å—Ç–∞ */
        }

        .temp-trend-arrow.down {
            color: #E74C3C; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø–∞–¥–µ–Ω–∏—è */
        }

        @keyframes trendPulse {
            0%, 100% { 
                opacity: 0.3;
            }
            50% { 
                opacity: 0.9;
            }
        }

        .temp-trend-arrow.up {
            animation: trendPulseUp 3s ease-in-out infinite;
        }

        .temp-trend-arrow.down {
            animation: trendPulseDown 3s ease-in-out infinite;
        }

        @keyframes trendPulseUp {
            0%, 100% { 
                opacity: 0.3;
                transform: translateY(0);
            }
            50% { 
                opacity: 0.9;
                transform: translateY(-2px);
            }
        }

        @keyframes trendPulseDown {
            0%, 100% { 
                opacity: 0.3;
                transform: translateY(0);
            }
            50% { 
                opacity: 0.9;
                transform: translateY(2px);
            }
        }
        
        .temp-warning-icon {
            display: inline-block;
            font-size: 0.6em;
            margin-left: 4px;
            color: #F39C12;
            animation: warningPulse 2s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .overheat-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(204, 0, 0, 0.95);
            color: #fff;
            padding: 30px 50px;
            border-radius: 15px;
            font-size: 32px;
            font-weight: bold;
            z-index: 1000;
            display: none;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.8);
            animation: warningPulse 0.5s infinite;
        }

        @keyframes warningPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        .overheat-warning.show {
            display: block;
        }

        .setpoint-control {
            background: #2a2a2a;
            border-radius: 15px;
            padding: 20px 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            border: 2px solid #3a3a3a;
            transition: border-color 0.3s;
        }
        
        .setpoint-control.fan-on {
            border-color: #00ff00;
        }
        
        .setpoint-control.pump-on {
            border-color: #00ff00;
        }
        
        .setpoint-control.fan-on.pump-on {
            border-color: #00ff00;
        }
        
        .setpoint-control.fan-off.pump-off {
            border-color: #555;
        }

        .setpoint-display {
            font-size: 48px;
            font-weight: 300;
            color: #ff6b35;
            margin: 15px 0;
        }

        .setpoint-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .setpoint-btn {
            min-width: 40px;
            height: 32px;
            border: none;
            background: #3a3a3a;
            color: #fff;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .setpoint-btn:hover:not(:disabled) {
            background: #4a4a4a;
            transform: scale(1.05);
        }

        .setpoint-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .setpoint-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .device-icons {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .device-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #3a3a3a;
            background: #2a2a2a;
            position: relative;
            overflow: hidden;
            box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .device-icon.active {
            background: #00ff00;
            border-color: #00ff00;
            color: #000;
        }

        .device-icon.inactive {
            border-color: #555;
            background: #2a2a2a;
            color: #888;
        }

        .device-icon.fan.active {
            animation: pulseFan 1.2s ease-in-out infinite;
        }

        @keyframes pulseFan {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.85; }
        }

        .device-icon.pump.active {
            animation: pulsePump 1.5s ease-in-out infinite;
        }

        @keyframes pulsePump {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .settings-page {
            display: none;
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .settings-page.active {
            display: block;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group h3 {
            color: #aaa;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 400;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            color: #fff;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .setting-item input[type="number"],
        .setting-item input[type="text"],
        .setting-item input[type="password"],
        .setting-item select {
            width: 100%;
            padding: 10px;
            background: #3a3a3a;
            border: 1px solid #555;
            border-radius: 5px;
            color: #fff;
            font-size: 14px;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è readonly –ø–æ–ª–µ–π —Å —Å–µ—Ä—ã–º —Ñ–æ–Ω–æ–º */
        .setting-item input[readonly][style*="background: #e9ecef"] {
            background: #3a3a3a !important;
            color: #fff !important;
        }

        .setting-item input:focus,
        .setting-item select:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ff6b35;
            color: #fff;
        }

        .btn-primary:hover {
            background: #ff8c55;
        }

        .btn-secondary {
            background: #3a3a3a;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #4a4a4a;
        }

        .back-button {
            background: #3a3a3a;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            width: 100%;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: #4a4a4a;
        }

        .info-box {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498DB;
            padding: 10px;
            margin-bottom: 12px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #fff;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }

        .switch .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .switch input:checked + .slider {
            background-color: #28a745;
        }

        .switch input:checked + .slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <h1>üî• –ö–æ—Ç–µ–ª</h1>
                <button class="menu-button" onclick="toggleMenu()" title="–ú–µ–Ω—é">‚ò∞</button>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item" onclick="showSettings('auto')">‚öôÔ∏è –†–µ–∂–∏–º –ê–≤—Ç–æ</div>
                <div class="dropdown-item" onclick="showSettings('mqtt')">üì° MQTT</div>
                <div class="dropdown-item" onclick="showSettings('wifi')">üì∂ WiFi</div>
                <div class="dropdown-item" onclick="showSettings('sensors')">üå°Ô∏è –î–∞—Ç—á–∏–∫–∏</div>
                <div class="dropdown-item" onclick="showSettings('ntp')">üïê NTP</div>
                <div class="dropdown-item" onclick="showSettings('ml')">ü§ñ ML –û–±—É—á–µ–Ω–∏–µ</div>
                <div class="dropdown-item" onclick="showSettings('relay')">‚ö° –†–µ–ª–µ</div>
                <div class="dropdown-item" onclick="showSettings('pins')">üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>
                <div class="dropdown-item" onclick="showSettings('system')">‚ÑπÔ∏è –°–∏—Å—Ç–µ–º–∞</div>
            </div>
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span class="state-display" id="stateDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="status-indicator">
                    <span style="color: #aaa;">–°–∏—Å—Ç–µ–º–∞:</span>
                    <strong id="systemStatus">--</strong>
                </div>
                <div class="status-indicator">
                    <span style="color: #aaa;">WiFi:</span>
                    <strong id="wifiStatus">--</strong>
                    <div id="wifiRSSIDisplay" style="margin-left: 6px; display: inline-flex; align-items: center; gap: 3px;">
                        <div class="wifi-signal-bars" id="wifiSignalBars"></div>
                        <span class="wifi-rssi-text" id="wifiRSSIText" style="font-size: 0.85em; opacity: 0.9;"></span>
                    </div>
                </div>
                <div class="status-indicator">
                    <span style="color: #aaa;">MQTT:</span>
                    <strong id="mqttStatus">--</strong>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div class="main-page" id="mainPage">
            <div class="overheat-warning" id="overheatWarning">
                ‚ö†Ô∏è –ü–ï–†–ï–ì–†–ï–í! –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: –ü–æ–¥–∞—á–∞ + –£—Å—Ç–∞–≤–∫–∞ -->
            <div class="temp-card" id="supplyTempCard" style="margin-bottom: 8px;">
                <div class="temp-label supply-label">–ü–æ–¥–∞—á–∞</div>
                <div class="temp-value supply-value">
                    <span id="supplyTemp">--</span><span class="temp-unit">¬∞C</span>
                    <span class="temp-trend-arrow" id="supplyTrendArrow" style="display: none;"></span>
                </div>
                <div class="setpoint-section" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #3a3a3a;">
                    <div class="temp-label setpoint-label" style="font-size: 10px; margin-bottom: 4px;">–£—Å—Ç–∞–≤–∫–∞</div>
                    <div class="setpoint-control-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                        <button class="setpoint-btn" onclick="changeSetpoint(-1)" style="padding: 4px 12px; font-size: 14px;">-</button>
                        <div class="temp-value setpoint setpoint-value">
                            <span id="setpointValue">60</span><span class="temp-unit">¬∞C</span>
                        </div>
                        <button class="setpoint-btn" onclick="changeSetpoint(1)" style="padding: 4px 12px; font-size: 14px;">+</button>
                    </div>
                </div>
            </div>

            <div class="temperature-display">
                <div class="temp-card">
                    <div class="temp-label">–û–±—Ä–∞—Ç–∫–∞</div>
                    <div class="temp-value">
                        <span id="returnTemp">--</span><span class="temp-unit">¬∞C</span>
                        <span class="temp-trend-arrow" id="returnTrendArrow" style="display: none;"></span>
                        <span class="temp-warning-icon" id="returnTempWarning" style="display: none;" title="–ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–±—Ä–∞—Ç–∫–∏">‚ö†Ô∏è</span>
                    </div>
                </div>
                <div class="temp-card sensor-card">
                    <div class="temp-label">–ö–æ—Ç–µ–ª—å–Ω–∞—è</div>
                    <div class="temp-value">
                        <span id="boilerTemp">--</span><span class="temp-unit">¬∞C</span>
                        <span class="temp-trend-arrow" id="boilerTrendArrow" style="display: none;"></span>
                    </div>
                </div>
            </div>

            <div class="temperature-display">
                <div class="temp-card sensor-card">
                    <div class="temp-label">–£–ª–∏—Ü–∞</div>
                    <div class="temp-value">
                        <span id="outdoorTemp">--</span><span class="temp-unit">¬∞C</span>
                        <span class="temp-trend-arrow" id="outdoorTrendArrow" style="display: none;"></span>
                    </div>
                </div>
                <div class="temp-card sensor-card">
                    <div class="temp-label">–î–æ–º (MQTT)</div>
                    <div class="temp-value">
                        <span id="homeTemp">--</span><span class="temp-unit">¬∞C</span>
                        <span class="temp-trend-arrow" id="homeTrendArrow" style="display: none;"></span>
                    </div>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
            <div style="background: #2a2a2a; border-radius: 12px; padding: 10px; margin: 8px 0; display: flex; justify-content: space-around; font-size: 0.85em;">
                <div style="text-align: center;">
                    <div style="color: #aaa; font-size: 0.9em;">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä</div>
                    <div id="fanStatusText" style="font-weight: 600; color: #888;">–í–´–ö–õ</div>
                </div>
                <div style="text-align: center;">
                    <div style="color: #aaa; font-size: 0.9em;">–ù–∞—Å–æ—Å</div>
                    <div id="pumpStatusText" style="font-weight: 600; color: #888;">–í–´–ö–õ</div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞ –∏ –ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 8px 0;">
                <!-- –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª/–≤—ã–∫–ª -->
                <div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;">
                    <div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–°–∏—Å—Ç–µ–º–∞</div>
                    <label style="display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;">
                        <label class="switch" style="transform: scale(0.8);">
                            <input type="checkbox" id="systemEnabled" onchange="toggleSystem()">
                            <span class="slider"></span>
                        </label>
                        <span id="systemStatusText" style="font-size: 0.85em; font-weight: 600;">–í–ö–õ</span>
                    </label>
                </div>
                
                <!-- –ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è -->
                <div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;">
                    <div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è</div>
                    <button id="coalFeedingButton" onclick="toggleCoalFeeding()" style="width: 100%; padding: 8px; font-size: 0.85em; font-weight: 600; background: #F39C12; color: #fff; border: none; border-radius: 8px; cursor: pointer;">
                        <span id="coalFeedingButtonText">üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å</span>
                    </button>
                    <div id="coalFeedingTimer" style="margin-top: 6px; font-size: 0.75em; font-weight: 600; color: #F39C12; display: none;">
                        <span id="coalFeedingTime">00:00</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ê–≤—Ç–æ -->
        <div id="settingsAuto" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="settings-group">
                <h3>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–ª–∞</h3>
                <div class="setting-item">
                    <label>–£—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–ª–∞ (¬∞C)</label>
                    <input type="number" id="autoSetpoint" min="40" max="80" value="60" step="1">
                </div>
                <div class="setting-item">
                    <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label>
                    <input type="number" id="autoMinTemp" min="40" max="80" value="45" step="1">
                </div>
                <div class="setting-item">
                    <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label>
                    <input type="number" id="autoMaxTemp" min="40" max="80" value="75" step="1">
                </div>
                <div class="setting-item">
                    <label>–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (¬∞C)</label>
                    <input type="number" id="autoHysteresis" min="0.5" max="5" value="2" step="0.5">
                </div>
            </div>

            <div class="settings-group">
                <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–µ—Ä—Ü–∏–∏</h3>
                <div class="setting-item">
                    <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∏–Ω–µ—Ä—Ü–∏–∏ (¬∞C)</label>
                    <input type="number" id="autoInertiaTemp" min="40" max="80" value="55" step="1">
                </div>
                <div class="setting-item">
                    <label>–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏–Ω–µ—Ä—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)</label>
                    <input type="number" id="autoInertiaTime" min="5" max="30" value="10" step="1">
                </div>
            </div>

            <div class="settings-group">
                <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <div class="setting-item">
                    <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞ (¬∞C)</label>
                    <input type="number" id="autoOverheatTemp" min="70" max="85" value="77" step="1">
                </div>
                <div class="setting-item">
                    <label>–¢–∞–π–º–∞—É—Ç —Ä–∞–∑–æ–≥—Ä–µ–≤–∞ (–º–∏–Ω—É—Ç—ã)</label>
                    <input type="number" id="autoHeatingTimeout" min="10" max="60" value="30" step="1">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveAutoSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="loadAutoSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: MQTT -->
        <div id="settingsMqtt" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –±—Ä–æ–∫–µ—Ä–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
            </div>

            <div class="settings-group">
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div class="setting-item">
                    <label>–í–∫–ª—é—á–∏—Ç—å MQTT</label>
                    <label class="switch">
                        <input type="checkbox" id="mqttEnabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞</label>
                    <label class="switch">
                        <input type="checkbox" id="mqttSystemEnabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>–ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞</label>
                    <input type="text" id="mqttServer" placeholder="m5.wqtt.ru">
                </div>
                <div class="setting-item">
                    <label>–ü–æ—Ä—Ç</label>
                    <select id="mqttPort">
                        <option value="1883">1883 (–æ–±—ã—á–Ω—ã–π)</option>
                        <option value="8883">8883 (TLS)</option>
                        <option value="5374">5374 (WQTT –æ–±—ã—á–Ω—ã–π)</option>
                        <option value="5375">5375 (WQTT TLS)</option>
                        <option value="5377">5377 (WQTT WebSocket TLS)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS</label>
                    <label class="switch">
                        <input type="checkbox" id="mqttUseTLS">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-group">
                <h3>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
                <div class="setting-item">
                    <label>–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="mqttUser" placeholder="u_OLTTB0">
                </div>
                <div class="setting-item">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="mqttPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                </div>
            </div>

            <div class="settings-group">
                <h3>–¢–æ–ø–∏–∫–∏</h3>
                <div class="setting-item">
                    <label>–ü—Ä–µ—Ñ–∏–∫—Å —Ç–æ–ø–∏–∫–æ–≤</label>
                    <input type="text" id="mqttPrefix" placeholder="kotel/device1">
                </div>
                <div class="info-box" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; margin-top: 15px;">
                    <h4 style="margin-top: 0; margin-bottom: 10px; color: var(--text-color);">üì° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–ø–∏–∫–∞—Ö:</h4>
                    <div style="font-size: 0.9em; line-height: 1.6;">
                        <div style="margin-bottom: 8px;">
                            <strong>–ü—É–±–ª–∏–∫–∞—Ü–∏—è (–ø—É–±–ª–∏–∫—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ):</strong><br>
                            ‚Ä¢ <code id="mqttTopicTemp" style="color: #3498DB;">{prefix}/simple/temp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏<br>
                            ‚Ä¢ <code id="mqttTopicEnabled" style="color: #3498DB;">{prefix}/simple/enabled</code> - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã (on/off)<br>
                            ‚Ä¢ <code id="mqttTopicSetpoint" style="color: #3498DB;">{prefix}/simple/setpoint</code> - —Ç–µ–∫—É—â–∞—è —É—Å—Ç–∞–≤–∫–∞<br>
                            ‚Ä¢ <code id="mqttTopicState" style="color: #3498DB;">{prefix}/state</code> - –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (JSON)<br>
                            ‚Ä¢ <code id="mqttTopicCoalFeeding" style="color: #3498DB;">{prefix}/coalFeeding</code> - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                            <strong>–ü–æ–¥–ø–∏—Å–∫–∞ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã):</strong><br>
                            ‚Ä¢ <code id="mqttTopicSetpointSet" style="color: #27AE60; font-weight: bold;">{prefix}/setpoint/set</code> - <strong>–∏–∑–º–µ–Ω–∏—Ç—å —É—Å—Ç–∞–≤–∫—É</strong><br>
                            <small style="display: block; margin-top: 5px; opacity: 0.8;">
                                –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 65.5) –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–π —É—Å—Ç–∞–≤–∫–∏ (40-80¬∞C)
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
                <div class="setting-item">
                    <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä (—Å–µ–∫—É–Ω–¥—ã)</label>
                    <input type="number" id="mqttTempInterval" min="5" max="60" value="10" step="1">
                </div>
                <div class="setting-item">
                    <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)</label>
                    <input type="number" id="mqttStateInterval" min="10" max="120" value="30" step="5">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveMqttSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="loadMqttSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="testMqttConnection()">üîå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: WiFi -->
        <div id="settingsWifi" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è.
            </div>

            <div class="settings-group">
                <h3>–¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
                <div class="setting-item">
                    <label>SSID</label>
                    <input type="text" id="currentSSID" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
                <div class="setting-item">
                    <label>IP –∞–¥—Ä–µ—Å</label>
                    <input type="text" id="currentIP" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
                <div class="setting-item">
                    <label>RSSI</label>
                    <input type="text" id="currentRSSI" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
                <div class="setting-item">
                    <label>MAC –∞–¥—Ä–µ—Å</label>
                    <input type="text" id="currentMAC" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
            </div>

            <div class="settings-group">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi</h3>
                <div class="setting-item">
                    <label>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω—Ç–µ–Ω–Ω—ã</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label class="switch">
                            <input type="checkbox" id="antennaTuning" onchange="toggleAntennaTuning()">
                            <span class="slider"></span>
                        </label>
                        <div id="antennaSignalInfo" style="display: none; padding: 8px 15px; background: rgba(46, 204, 113, 0.1); border-radius: 8px; border: 1px solid rgba(46, 204, 113, 0.3);">
                            <span style="font-weight: bold; color: var(--text-color);">
                                –°–∏–≥–Ω–∞–ª: <span id="signalPercentage">0</span>% 
                                (<span id="signalRSSI">0</span> dBm)
                            </span>
                        </div>
                    </div>
                </div>
                <div class="info-box" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB;">
                    <strong>–û—Å–Ω–æ–≤–Ω–æ–π WiFi (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1):</strong> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, –¥–∞–∂–µ –ø—Ä–∏ —Å–ª–∞–±–æ–º —Å–∏–≥–Ω–∞–ª–µ. –î–æ 30 —Å–µ–∫—É–Ω–¥ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
                </div>
                <div class="setting-item">
                    <label>SSID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="primarySSIDSelect" onchange="selectPrimarySSID()" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color) !important;">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>
                        </select>
                        <input type="text" id="primarySSID" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é" style="flex: 1; color: var(--text-color) !important;">
                    </div>
                </div>
                <div class="setting-item">
                    <label>–ü–∞—Ä–æ–ª—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi</label>
                    <input type="password" id="primaryPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="color: var(--text-color) !important;">
                </div>
                
                <div class="info-box" style="background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; margin-top: 15px;">
                    <strong>–†–µ–∑–µ—Ä–≤–Ω—ã–π WiFi (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2):</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π WiFi –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
                </div>
                <div class="setting-item">
                    <label>SSID —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="backupSSIDSelect" onchange="selectBackupSSID()" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color) !important;">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>
                        </select>
                        <input type="text" id="backupSSID" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é" style="flex: 1; color: var(--text-color) !important;">
                    </div>
                </div>
                <div class="setting-item">
                    <label>–ü–∞—Ä–æ–ª—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi</label>
                    <input type="password" id="backupPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="color: var(--text-color) !important;">
                </div>
                
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="saveWiFiSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-secondary" onclick="loadWiFiSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>

            <div class="settings-group">
                <h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ WiFi —Å–µ—Ç–µ–π</h3>
                <div class="info-box">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö WiFi —Å–µ—Ç–µ–π. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.
                </div>
                <button class="btn btn-primary" onclick="scanWiFiNetworks()" id="scanWiFiButton">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏</button>
                <div id="wifiScanResults" style="margin-top: 15px; display: none;">
                    <h4 style="margin-bottom: 10px; color: var(--text-color);">–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏:</h4>
                    <div id="wifiNetworksList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; background: var(--card-bg);"></div>
                </div>
            </div>

            <div class="settings-group">
                <h3>–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ WiFi</h3>
                <div class="info-box">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi. 
                    –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ "KotelAP" –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
                </div>
                <button class="btn btn-secondary" onclick="resetWiFi()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å WiFi</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –î–∞—Ç—á–∏–∫–∏ -->
        <div id="settingsSensors" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã DS18B20 –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º—ã.
            </div>

            <div class="settings-group">
                <h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏</h3>
                <div id="sensorList"></div>
                <button class="btn btn-primary" onclick="scanSensors()">üîç –ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—á–∏–∫–∏</button>
            </div>

            <div class="settings-group">
                <h3>–ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤</h3>
                <div class="setting-item">
                    <label>–ü–æ–¥–∞—á–∞</label>
                    <select id="sensorSupply"></select>
                </div>
                <div class="setting-item">
                    <label>–û–±—Ä–∞—Ç–∫–∞</label>
                    <select id="sensorReturn"></select>
                </div>
                <div class="setting-item">
                    <label>–ö–æ—Ç–µ–ª—å–Ω–∞—è</label>
                    <select id="sensorBoiler"></select>
                </div>
                <div class="setting-item">
                    <label>–£–ª–∏—Ü–∞</label>
                    <select id="sensorOutside"></select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveSensorMapping()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="loadSensorMapping()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–Ω–æ–≤ -->
        <div id="settingsPins" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∫ ESP32
            </div>

            <div class="settings-group">
                <h3>üîå –†–µ–ª–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                <div style="padding: 12px; background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 16 ‚Üí –†–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞</div>
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 17 ‚Üí –†–µ–ª–µ –Ω–∞—Å–æ—Å–∞</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">–†–µ–ª–µ —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä –∏–ª–∏ –º–æ–¥—É–ª—å —Ä–µ–ª–µ. –ü—Ä–∏ HIGH —Ä–µ–ª–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è.</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>üì∫ OLED –¥–∏—Å–ø–ª–µ–π (SSD1306 128x64, I2C)</h3>
                <div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 21 ‚Üí SDA (I2C Data)</div>
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 22 ‚Üí SCL (I2C Clock)</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">VCC ‚Üí 3.3V –∏–ª–∏ 5V | GND ‚Üí GND</div>
                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">–ê–¥—Ä–µ—Å I2C: 0x3C</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>üå°Ô∏è –î–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã DS18B20</h3>
                
                <div style="padding: 12px; background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ECC71; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #2ECC71;">–®–∏–Ω–∞ 1 (GPIO 4):</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">GPIO 4 ‚Üí Data</div>
                    <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 8px;">–ß–µ—Ä–µ–∑ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –∫ VCC</div>
                    <div style="font-size: 0.9em; font-weight: 600; margin-top: 8px;">–î–∞—Ç—á–∏–∫–∏:</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –ü–æ–¥–∞—á–∞ (–≤—ã—Ö–æ–¥ –∫–æ—Ç–ª–∞)</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –û–±—Ä–∞—Ç–∫–∞ (–≤—Ö–æ–¥ –∫–æ—Ç–ª–∞)</div>
                </div>

                <div style="padding: 12px; background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ECC71; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #2ECC71;">–®–∏–Ω–∞ 2 (GPIO 5):</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">GPIO 5 ‚Üí Data</div>
                    <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 8px;">–ß–µ—Ä–µ–∑ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –∫ VCC</div>
                    <div style="font-size: 0.9em; font-weight: 600; margin-top: 8px;">–î–∞—Ç—á–∏–∫–∏:</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –ö–æ—Ç–µ–ª—å–Ω–∞—è</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –£–ª–∏—Ü–∞</div>
                </div>

                <div style="padding: 10px; background: rgba(241, 196, 15, 0.1); border-left: 4px solid #F1C40F; border-radius: 4px; margin-top: 10px;">
                    <div style="font-size: 0.85em; font-weight: 600;">‚ö†Ô∏è –í–∞–∂–Ω–æ:</div>
                    <div style="font-size: 0.85em; opacity: 0.9;">–ö–∞–∂–¥—ã–π –¥–∞—Ç—á–∏–∫ DS18B20 —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –º–µ–∂–¥—É Data –∏ VCC</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>üîÑ –≠–Ω–∫–æ–¥–µ—Ä (—Ä–æ—Ç–æ—Ä–Ω—ã–π —Å –∫–Ω–æ–ø–∫–æ–π)</h3>
                <div style="padding: 12px; background: rgba(155, 89, 182, 0.1); border-left: 4px solid #9B59B6; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 18 ‚Üí CLK (Clock)</div>
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 19 ‚Üí DT (Data)</div>
                    <div style="font-weight: 600; margin-bottom: 8px;">GPIO 23 ‚Üí SW (Switch/Button)</div>
                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 8px;">VCC ‚Üí 3.3V –∏–ª–∏ 5V | GND ‚Üí GND</div>
                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">–ü–∏–Ω—ã —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–æ–¥—Ç—è–∂–∫–æ–π (INPUT_PULLUP)</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>‚ö° –ü–∏—Ç–∞–Ω–∏–µ</h3>
                <div style="padding: 12px; background: rgba(231, 76, 60, 0.1); border-left: 4px solid #E74C3C; border-radius: 4px;">
                    <div style="font-size: 0.9em; margin-bottom: 5px;"><strong>ESP32:</strong> USB –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ 5V</div>
                    <div style="font-size: 0.9em; margin-bottom: 5px;"><strong>OLED:</strong> 3.3V –∏–ª–∏ 5V (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥—É–ª—å)</div>
                    <div style="font-size: 0.9em; margin-bottom: 5px;"><strong>DS18B20:</strong> 3.3V –∏–ª–∏ 5V</div>
                    <div style="font-size: 0.9em; margin-bottom: 5px;"><strong>–≠–Ω–∫–æ–¥–µ—Ä:</strong> 3.3V –∏–ª–∏ 5V</div>
                    <div style="font-size: 0.9em;"><strong>–ú–æ–¥—É–ª–∏ —Ä–µ–ª–µ:</strong> 5V –¥–ª—è —Ä–µ–ª–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3.3V</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>üìã –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
                <div style="padding: 15px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; font-family: monospace; font-size: 0.85em; overflow-x: auto;">
                    <div style="margin-bottom: 8px;"><strong>ESP32</strong>                    <strong>–í–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</strong></div>
                    <div style="margin-bottom: 5px;">GPIO 16  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –†–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞</div>
                    <div style="margin-bottom: 5px;">GPIO 17  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –†–µ–ª–µ –Ω–∞—Å–æ—Å–∞</div>
                    <div style="margin-bottom: 5px;">GPIO 21  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OLED SDA</div>
                    <div style="margin-bottom: 5px;">GPIO 22  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OLED SCL</div>
                    <div style="margin-bottom: 5px;">GPIO 4   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> DS18B20 —à–∏–Ω–∞ 1</div>
                    <div style="margin-bottom: 5px;">GPIO 5   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> DS18B20 —à–∏–Ω–∞ 2</div>
                    <div style="margin-bottom: 5px;">GPIO 18  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä CLK</div>
                    <div style="margin-bottom: 5px;">GPIO 19  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä DT</div>
                    <div style="margin-bottom: 5px;">GPIO 23  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä SW</div>
                    <div style="margin-bottom: 5px;">3.3V     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –ü–∏—Ç–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π</div>
                    <div>GND      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –û–±—â–∏–π GND</div>
                </div>
            </div>

            <div class="settings-group">
                <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                <div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px;">
                    <div style="font-size: 0.9em; margin-bottom: 8px;">1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –¥–ª—è –∫–∞–∂–¥–æ–π —à–∏–Ω—ã DS18B20</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;">2. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∞ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–∞—Ç—á–∏–∫–æ–≤</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;">3. –ú–æ–¥—É–ª–∏ —Ä–µ–ª–µ —Å –æ–ø—Ç–æ–∏–∑–æ–ª—è—Ü–∏–µ–π –¥–ª—è –∑–∞—â–∏—Ç—ã ESP32</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;">4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Ç–æ–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è</div>
                    <div style="font-size: 0.9em;">5. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–±—â–∏–π GND</div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: NTP -->
        <div id="settingsNtp" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å NTP —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
            </div>

            <div class="settings-group">
                <h3>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</h3>
                <div class="setting-item">
                    <label>–í—Ä–µ–º—è (NTP)</label>
                    <input type="text" id="ntpCurrentTime" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
                <div class="setting-item">
                    <label>–î–∞—Ç–∞ (NTP)</label>
                    <input type="text" id="ntpCurrentDate" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
                <div class="setting-item">
                    <label>–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</label>
                    <input type="text" id="ntpSyncStatus" readonly style="background: #e9ecef; color: var(--text-color);">
                </div>
            </div>

            <div class="settings-group">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP</h3>
                <div class="setting-item">
                    <label>–í–∫–ª—é—á–∏—Ç—å NTP</label>
                    <label class="switch">
                        <input type="checkbox" id="ntpEnabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>NTP —Å–µ—Ä–≤–µ—Ä</label>
                    <input type="text" id="ntpServer" placeholder="ru.pool.ntp.org" style="color: var(--text-color);">
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ: ru.pool.ntp.org, pool.ntp.org, time.google.com</small>
                </div>
                <div class="setting-item">
                    <label>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (UTC)</label>
                    <input type="number" id="ntpTimezone" min="-12" max="14" value="3" step="1" style="color: var(--text-color) !important;">
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–ú–æ—Å–∫–≤–∞: +3, –ö–∏–µ–≤: +2, –ú–∏–Ω—Å–∫: +3, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥: +5</small>
                </div>
                <div class="setting-item">
                    <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—á–∞—Å—ã)</label>
                    <input type="number" id="ntpUpdateInterval" min="1" max="24" value="1" step="1" style="color: var(--text-color) !important;">
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–ö–∞–∫ —á–∞—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveNTPSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="loadNTPSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ML –û–±—É—á–µ–Ω–∏–µ -->
        <div id="settingsMl" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏. –î–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ <strong>{prefix}/ml/data</strong>.
            </div>

            <div class="settings-group">
                <h3>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML</h3>
                <div class="setting-item">
                    <label>–í–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é ML –¥–∞–Ω–Ω—ã—Ö</label>
                    <label class="switch">
                        <input type="checkbox" id="mlEnabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—Å–µ–∫—É–Ω–¥—ã)</label>
                    <input type="number" id="mlPublishInterval" min="5" max="300" value="10" step="1" style="color: var(--text-color) !important;">
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 5-30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveMLSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="loadMLSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>

            <div class="settings-group">
                <h3>üìä –ü—É–±–ª–∏–∫—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px;">
                    <div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã:</strong> supplyTemp, returnTemp, boilerTemp, outdoorTemp, homeTemp, tempDiff</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–°–æ—Å—Ç–æ—è–Ω–∏—è:</strong> fan, pump, systemEnabled, state, coalFeedingActive</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Auto:</strong> setpoint, minTemp, maxTemp, hysteresis, inertiaTemp, inertiaTime, overheatTemp, heatingTimeout</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–í—Ä–µ–º—è:</strong> timestamp, uptime, time, date</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px;"><strong>WiFi:</strong> wifiRSSI, wifiSSID, wifiIP</div>
                    <div style="font-size: 0.9em;"><strong>–°–∏—Å—Ç–µ–º–∞:</strong> freeMem, heapSize, sensorCount, mqttConnected, mlPublishInterval</div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –†–µ–ª–µ -->
        <div id="settingsRelay" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="info-box">
                –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è.
            </div>

            <div class="settings-group">
                <h3>‚ö° –õ–æ–≥–∏–∫–∞ —Ä–µ–ª–µ</h3>
                <div class="setting-item">
                    <label>–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä: –í—ã–∫–ª—é—á–µ–Ω–æ = LOW</label>
                    <label class="switch">
                        <input type="checkbox" id="fanOffIsLow" checked>
                        <span class="slider"></span>
                    </label>
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ, —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –¥–ª—è HIGH</small>
                </div>
                <div class="setting-item">
                    <label>–ù–∞—Å–æ—Å: –í—ã–∫–ª—é—á–µ–Ω–æ = LOW</label>
                    <label class="switch">
                        <input type="checkbox" id="pumpOffIsLow" checked>
                        <span class="slider"></span>
                    </label>
                    <small style="display: block; margin-top: 5px; opacity: 0.8;">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ, —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –¥–ª—è HIGH</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveRelaySettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="loadRelaySettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>

            <div class="settings-group">
                <h3>üîß –ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <div id="manualControlStatus" style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-bottom: 15px;">
                    <div style="font-size: 0.9em;">–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <strong id="manualControlState">–ù–µ –∞–∫—Ç–∏–≤–Ω–æ</strong></div>
                    <div style="font-size: 0.9em; margin-top: 5px;">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <strong id="manualControlRemaining">--</strong> —Å–µ–∫</div>
                </div>
                <div class="setting-item">
                    <label>–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="controlRelay('fan', true, true)" style="flex: 1;">–í–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button>
                        <button class="btn btn-danger" onclick="controlRelay('fan', false, true)" style="flex: 1;">–í–´–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button>
                    </div>
                </div>
                <div class="setting-item">
                    <label>–ù–∞—Å–æ—Å</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="controlRelay('pump', true, true)" style="flex: 1;">–í–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button>
                        <button class="btn btn-danger" onclick="controlRelay('pump', false, true)" style="flex: 1;">–í–´–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button>
                    </div>
                </div>
                <div style="padding: 10px; background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; border-radius: 4px; margin-top: 10px;">
                    <div style="font-size: 0.85em; opacity: 0.9;">
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º. –ß–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–µ.
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –°–∏—Å—Ç–µ–º–∞ -->
        <div id="settingsSystem" class="settings-page">
            <button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="settings-group">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
                <div class="setting-item">
                    <label>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏</label>
                    <input type="text" id="firmwareVersion" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>IP –∞–¥—Ä–µ—Å</label>
                    <input type="text" id="systemIP" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>MAC –∞–¥—Ä–µ—Å</label>
                    <input type="text" id="systemMAC" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</label>
                    <input type="text" id="systemUptime" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å</label>
                    <input type="text" id="systemFreeMem" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (NTP)</label>
                    <input type="text" id="systemTime" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
                <div class="setting-item">
                    <label>–î–∞—Ç–∞ (NTP)</label>
                    <input type="text" id="systemDate" readonly style="background: #e9ecef; color: var(--text-color) !important;">
                </div>
            </div>

            <div class="settings-group">
                <h3>OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h3>
                <div class="setting-item">
                    <label>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏</label>
                    <input type="file" id="otaFile" accept=".bin" style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="uploadOTA()" id="otaUploadBtn">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É</button>
                    <div id="otaStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
                </div>
                <div style="padding: 10px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-top: 10px;">
                    <div style="font-size: 0.85em; opacity: 0.9;">
                        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
                        1. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ—à–∏–≤–∫—É –≤ PlatformIO<br>
                        2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .bin –∏–∑ –ø–∞–ø–∫–∏ .pio/build/esp32dev/<br>
                        3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É"<br>
                        4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="rebootDevice()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞</button>
            </div>
        </div>
    </div>

    <script>
        let updateInterval;

        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            if (menu) {
                menu.classList.toggle('show');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const button = document.querySelector('.menu-button');
            if (menu && button) {
                // –ï—Å–ª–∏ –∫–ª–∏–∫ –Ω–µ –ø–æ –º–µ–Ω—é –∏ –Ω–µ –ø–æ –∫–Ω–æ–ø–∫–µ - –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                if (!menu.contains(event.target) && event.target !== button && !button.contains(event.target)) {
                    menu.classList.remove('show');
                }
            }
        });

        function showMain() {
            document.getElementById('mainPage').style.display = 'block';
            document.querySelectorAll('.settings-page').forEach(page => page.classList.remove('active'));
            document.getElementById('dropdownMenu').classList.remove('show');
        }

        function showSettings(type) {
            document.getElementById('mainPage').style.display = 'none';
            document.querySelectorAll('.settings-page').forEach(page => page.classList.remove('active'));
            const pageId = 'settings' + type.charAt(0).toUpperCase() + type.slice(1);
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
            }
            document.getElementById('dropdownMenu').classList.remove('show');
            
            if (type === 'system') {
                loadSystemInfo();
            } else if (type === 'relay') {
                loadRelaySettings();
            } else if (type === 'wifi') {
                loadWiFiInfo();
                loadWiFiSettings();
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ
                if (antennaTuningInterval) {
                    clearInterval(antennaTuningInterval);
                    antennaTuningInterval = null;
                }
                // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω—Ç–µ–Ω–Ω—ã –≤–∫–ª—é—á–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                if (document.getElementById('antennaTuning').checked) {
                    toggleAntennaTuning();
                }
            } else if (type === 'sensors') {
                loadSensorMapping();
                scanSensors();
            } else if (type === 'mqtt') {
                loadMqttSettings();
            } else if (type === 'auto') {
                loadAutoSettings();
            } else if (type === 'ntp') {
                loadNTPSettings();
                updateNTPTime();
            } else if (type === 'ml') {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏, –Ω–µ –≤ setInterval
                loadMLSettings();
            } else if (type === 'system') {
                loadSystemInfo();
            }
        }

        function changeSetpoint(delta) {
            const current = parseFloat(document.getElementById('setpointValue').textContent);
            const newValue = Math.max(40, Math.min(80, current + delta));
            document.getElementById('setpointValue').textContent = newValue;
            
            fetch('/api/setpoint?value=' + newValue, { method: 'POST' })
                .then(r => r.json())
                .then(d => console.log('Setpoint set:', d))
                .catch(e => console.error('Error:', e));
        }

        function toggleDevice(device) {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
            const statusText = document.getElementById(device === 'fan' ? 'fanStatusText' : 'pumpStatusText');
            if (!statusText) return;
            
            const isActive = statusText.textContent === '–í–ö–õ';
            const newState = !isActive;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
            statusText.textContent = newState ? '–í–ö–õ' : '–í–´–ö–õ';
            statusText.style.color = newState ? '#00ff00' : '#888';
            
            fetch('/api/control?device=' + device + '&state=' + (newState ? 1 : 0), { method: 'POST' })
                .then(r => r.json())
                .then(d => console.log('Device control:', d))
                .catch(e => console.error('Error:', e));
        }

        function toggleSystem() {
            const checkbox = document.getElementById('systemEnabled');
            const enabled = checkbox.checked;
            
            fetch('/api/system/enable?enabled=' + (enabled ? 1 : 0), { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    updateSystemStatus(enabled);
                    console.log('System control:', d);
                })
                .catch(e => console.error('Error:', e));
        }

        function updateSystemStatus(enabled) {
            const statusText = document.getElementById('systemStatusText');
            const statusBar = document.getElementById('systemStatus');
            if (enabled) {
                statusText.textContent = '–í–∫–ª—é—á–µ–Ω–∞';
                statusText.style.color = '#28a745';
                if (statusBar) statusBar.textContent = '–í–ö–õ';
            } else {
                statusText.textContent = '–í—ã–∫–ª—é—á–µ–Ω–∞';
                statusText.style.color = '#dc3545';
                if (statusBar) statusBar.textContent = '–í–´–ö–õ';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —Ç—Ä–µ–Ω–¥–∞
        function updateTrendArrow(elementId, trend) {
            const arrow = document.getElementById(elementId);
            if (!arrow) return;
            
            if (trend === 1) {
                // –†–æ—Å—Ç - –∑–µ–ª–µ–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
                arrow.textContent = '‚Üë';
                arrow.className = 'temp-trend-arrow up';
                arrow.style.display = 'inline-block';
            } else if (trend === -1) {
                // –ü–∞–¥–µ–Ω–∏–µ - –∫—Ä–∞—Å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
                arrow.textContent = '‚Üì';
                arrow.className = 'temp-trend-arrow down';
                arrow.style.display = 'inline-block';
            } else {
                // –°—Ç–∞–±–∏–ª—å–Ω–æ - —Å–∫—Ä—ã–≤–∞–µ–º
                arrow.style.display = 'none';
            }
        }

        function updateData() {
            fetch('/api/status')
                .then(r => {
                    if (!r.ok) {
                        throw new Error('HTTP error! status: ' + r.status);
                    }
                    return r.json();
                })
                .then(d => {
                    if (!d) {
                        console.error('Empty response from /api/status');
                        return;
                    }
                    document.getElementById('supplyTemp').textContent = d.supplyTemp !== null ? d.supplyTemp.toFixed(1) : '--';
                    document.getElementById('returnTemp').textContent = d.returnTemp !== null ? d.returnTemp.toFixed(1) : '--';
                    
                    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –æ–±—Ä–∞—Ç–∫–∏
                    const returnTempWarning = document.getElementById('returnTempWarning');
                    if (returnTempWarning) {
                        returnTempWarning.style.display = (d.lowReturnTemp === true) ? 'inline-block' : 'none';
                    }
                    
                    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–æ–≥–æ—Ä–∞–Ω–∏–∏ —É–≥–ª—è
                    if (d.coalBurned === true) {
                        // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        console.log('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –≤–æ–∑–º–æ–∂–Ω–æ —É–≥–æ–ª—å –ø—Ä–æ–≥–æ—Ä–µ–ª');
                    }
                    document.getElementById('boilerTemp').textContent = d.boilerTemp !== null ? d.boilerTemp.toFixed(1) : '--';
                    document.getElementById('outdoorTemp').textContent = d.outdoorTemp !== null ? d.outdoorTemp.toFixed(1) : '--';
                    document.getElementById('homeTemp').textContent = d.homeTemp !== null ? d.homeTemp.toFixed(1) : '--';
                    document.getElementById('setpointValue').textContent = d.setpoint !== null ? d.setpoint.toFixed(0) : '60';
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–æ—á–µ–∫ —Ç—Ä–µ–Ω–¥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (—Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ)
                    updateTrendArrow('supplyTrendArrow', d.supplyTrend);
                    updateTrendArrow('returnTrendArrow', d.returnTrend);
                    updateTrendArrow('boilerTrendArrow', d.boilerTrend);
                    updateTrendArrow('outdoorTrendArrow', d.outdoorTrend);
                    updateTrendArrow('homeTrendArrow', d.homeTrend);
                    
                    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
                    let statusText = '–†–∞–±–æ—Ç–∞';
                    let statusClass = 'success';
                    
                    if (d.systemEnabled === false) {
                        statusText = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
                        statusClass = 'warning';
                    } else if (d.supplyTemp >= 77) {
                        statusText = '–ü–µ—Ä–µ–≥—Ä–µ–≤!';
                        statusClass = 'danger';
                    } else if (d.coalFeeding === true) {
                        statusText = '–ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è';
                        statusClass = 'info';
                    } else if (d.fan === true || d.pump === true) {
                        statusText = '–†–∞–±–æ—Ç–∞';
                        statusClass = 'success';
                    } else {
                        statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
                        statusClass = 'idle';
                    }
                    
                    document.getElementById('stateDisplay').textContent = statusText;
                    const statusDot = document.getElementById('statusDot');
                    statusDot.className = 'status-dot ' + statusClass;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
                    try {
                        if (d.systemEnabled !== undefined) {
                            const systemEnabledCheckbox = document.getElementById('systemEnabled');
                            if (systemEnabledCheckbox) {
                                systemEnabledCheckbox.checked = d.systemEnabled;
                            }
                            updateSystemStatus(d.systemEnabled);
                        }
                    } catch (e) {
                        console.error('Error updating system status:', e);
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –∏ –Ω–∞—Å–æ—Å–∞
                    const fanStatusText = document.getElementById('fanStatusText');
                    const pumpStatusText = document.getElementById('pumpStatusText');
                    
                    if (fanStatusText) {
                        fanStatusText.textContent = d.fan ? '–í–ö–õ' : '–í–´–ö–õ';
                        fanStatusText.style.color = d.fan ? '#00ff00' : '#888';
                    }
                    
                    if (pumpStatusText) {
                        pumpStatusText.textContent = d.pump ? '–í–ö–õ' : '–í–´–ö–õ';
                        pumpStatusText.style.color = d.pump ? '#00ff00' : '#888';
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
                    if (d.coalFeeding !== undefined) {
                        updateCoalFeedingStatus(d.coalFeeding, d.coalFeedingRemaining || 0);
                        if (d.coalFeeding && !coalFeedingTimerInterval) {
                            startCoalFeedingTimer();
                        }
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–µ—Ä–µ–≥—Ä–µ–≤–µ
                    if (d.supplyTemp >= 77) {
                        document.getElementById('overheatWarning').classList.add('show');
                        document.getElementById('supplyTempCard').classList.add('overheat');
                    } else {
                        document.getElementById('overheatWarning').classList.remove('show');
                        document.getElementById('supplyTempCard').classList.remove('overheat');
                    }
                    
                    if (d.wifiStatus) {
                        document.getElementById('wifiStatus').textContent = d.wifiStatus;
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ MQTT
                    if (d.mqttStatus !== undefined) {
                        const mqttStatusEl = document.getElementById('mqttStatus');
                        mqttStatusEl.textContent = d.mqttStatus;
                        if (d.mqttStatus === '–ü–æ–¥–∫–ª—é—á–µ–Ω') {
                            mqttStatusEl.style.color = '#2ECC71';
                        } else if (d.mqttStatus === '–û—Ç–∫–ª—é—á–µ–Ω') {
                            mqttStatusEl.style.color = '#E74C3C';
                        } else {
                            mqttStatusEl.style.color = '#888';
                        }
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ WiFi —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
                    if (d.wifiRSSI !== undefined) {
                        const rssi = d.wifiRSSI;
                        const rssiDisplay = document.getElementById('wifiRSSIDisplay');
                        const signalBars = document.getElementById('wifiSignalBars');
                        const rssiText = document.getElementById('wifiRSSIText');
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª–æ—Å–æ–∫ –∏ —Ü–≤–µ—Ç
                        let activeBars = 0;
                        let barClass = '';
                        
                        if (rssi >= -50) {
                            activeBars = 4; // –û—Ç–ª–∏—á–Ω—ã–π —Å–∏–≥–Ω–∞–ª - –≤—Å–µ 4 –ø–æ–ª–æ—Å–∫–∏
                            barClass = 'active';
                            rssiText.style.color = '#2ECC71'; // –ó–µ–ª–µ–Ω—ã–π
                        } else if (rssi >= -70) {
                            activeBars = 3; // –•–æ—Ä–æ—à–∏–π —Å–∏–≥–Ω–∞–ª - 3 –ø–æ–ª–æ—Å–∫–∏
                            barClass = 'active';
                            rssiText.style.color = '#2ECC71'; // –ó–µ–ª–µ–Ω—ã–π
                        } else if (rssi >= -85) {
                            activeBars = 2; // –°–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª - 2 –ø–æ–ª–æ—Å–∫–∏
                            barClass = 'warning';
                            rssiText.style.color = '#F39C12'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                        } else {
                            activeBars = 1; // –û—á–µ–Ω—å —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª - 1 –ø–æ–ª–æ—Å–∫–∞
                            barClass = 'danger';
                            rssiText.style.color = '#E74C3C'; // –ö—Ä–∞—Å–Ω—ã–π
                        }
                        
                        // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–æ—Å–∫–∏ —Å–∏–≥–Ω–∞–ª–∞
                        signalBars.innerHTML = '';
                        for (let i = 1; i <= 4; i++) {
                            const bar = document.createElement('div');
                            bar.className = 'wifi-bar bar' + i;
                            if (i <= activeBars) {
                                bar.classList.add(barClass);
                            }
                            signalBars.appendChild(bar);
                        }
                        
                        // –¢–µ–∫—Å—Ç —Å —É—Ä–æ–≤–Ω–µ–º —Å–∏–≥–Ω–∞–ª–∞
                        rssiText.textContent = `${rssi} dBm`;
                    } else {
                        const signalBars = document.getElementById('wifiSignalBars');
                        const rssiText = document.getElementById('wifiRSSIText');
                        if (signalBars) signalBars.innerHTML = '';
                        if (rssiText) rssiText.textContent = '';
                    }
                })
                .catch(e => {
                    console.error('Error updating data:', e);
                    // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ - –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–±—Ä–æ—Å–æ–º —É–≥–ª—è (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
        function toggleCoalFeeding() {
            fetch('/api/coalFeeding', { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    if (d.success) {
                        updateCoalFeedingStatus(d.coalFeeding, d.remaining || 0);
                        console.log('Coal feeding toggled:', d.coalFeeding ? 'ON' : 'OFF');
                    }
                })
                .catch(e => console.error('Error toggling coal feeding:', e));
        }

        function updateCoalFeedingStatus(active, remainingSeconds) {
            const button = document.getElementById('coalFeedingButton');
            const buttonText = document.getElementById('coalFeedingButtonText');
            const timer = document.getElementById('coalFeedingTimer');
            const timeDisplay = document.getElementById('coalFeedingTime');
            
            if (active) {
                button.disabled = false;
                buttonText.textContent = 'üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
                button.style.background = '#E74C3C';
                timer.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
                updateCoalFeedingTimer(remainingSeconds);
            } else {
                button.disabled = false;
                buttonText.textContent = 'üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å';
                button.style.background = '#F39C12';
                timer.style.display = 'none';
                if (timeDisplay) timeDisplay.textContent = '00:00';
            }
        }

        function updateCoalFeedingTimer(remainingSeconds) {
            const timer = document.getElementById('coalFeedingTimer');
            const timeSpan = document.getElementById('coalFeedingTime');
            
            if (remainingSeconds > 0) {
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                if (timeSpan) {
                    timeSpan.textContent = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
                }
                if (timer) {
                    timer.style.display = 'block';
                }
            } else {
                if (timeSpan) timeSpan.textContent = '00:00';
                if (timer) timer.style.display = 'none';
            }
        }

        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
        let coalFeedingTimerInterval = null;
        function startCoalFeedingTimer() {
            if (coalFeedingTimerInterval) {
                clearInterval(coalFeedingTimerInterval);
            }
            coalFeedingTimerInterval = setInterval(() => {
                fetch('/api/coalFeeding')
                    .then(r => r.json())
                    .then(d => {
                        if (d.coalFeeding && d.remaining > 0) {
                            updateCoalFeedingTimer(d.remaining);
                        } else if (d.coalFeeding === false) {
                            updateCoalFeedingStatus(false, 0);
                            if (coalFeedingTimerInterval) {
                                clearInterval(coalFeedingTimerInterval);
                                coalFeedingTimerInterval = null;
                            }
                        }
                    })
                    .catch(e => console.error('Error updating coal feeding timer:', e));
            }, 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        }

        function saveAutoSettings() {
            const settings = {
                setpoint: parseFloat(document.getElementById('autoSetpoint').value),
                minTemp: parseFloat(document.getElementById('autoMinTemp').value),
                maxTemp: parseFloat(document.getElementById('autoMaxTemp').value),
                hysteresis: parseFloat(document.getElementById('autoHysteresis').value),
                inertiaTemp: parseFloat(document.getElementById('autoInertiaTemp').value),
                inertiaTime: parseFloat(document.getElementById('autoInertiaTime').value),
                overheatTemp: parseFloat(document.getElementById('autoOverheatTemp').value),
                heatingTimeout: parseFloat(document.getElementById('autoHeatingTimeout').value)
            };
            
            fetch('/api/settings/auto', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => r.json())
            .then(d => {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                console.error('Error:', e);
            });
        }

        function loadAutoSettings() {
            fetch('/api/settings/auto')
                .then(r => r.json())
                .then(d => {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
                    if (d.setpoint !== undefined && d.setpoint !== null && !isNaN(d.setpoint) && d.setpoint >= 40 && d.setpoint <= 80) {
                        document.getElementById('autoSetpoint').value = d.setpoint;
                    }
                    if (d.minTemp !== undefined && d.minTemp !== null && !isNaN(d.minTemp) && d.minTemp >= 30 && d.minTemp <= 60) {
                        document.getElementById('autoMinTemp').value = d.minTemp;
                    }
                    if (d.maxTemp !== undefined && d.maxTemp !== null && !isNaN(d.maxTemp) && d.maxTemp >= 60 && d.maxTemp <= 90) {
                        document.getElementById('autoMaxTemp').value = d.maxTemp;
                    }
                    if (d.hysteresis !== undefined && d.hysteresis !== null && !isNaN(d.hysteresis) && d.hysteresis >= 0.5 && d.hysteresis <= 10) {
                        document.getElementById('autoHysteresis').value = d.hysteresis;
                    }
                    if (d.inertiaTemp !== undefined && d.inertiaTemp !== null && !isNaN(d.inertiaTemp) && d.inertiaTemp >= 40 && d.inertiaTemp <= 70) {
                        document.getElementById('autoInertiaTemp').value = d.inertiaTemp;
                    }
                    if (d.inertiaTime !== undefined && d.inertiaTime !== null && !isNaN(d.inertiaTime) && d.inertiaTime >= 1 && d.inertiaTime <= 60) {
                        document.getElementById('autoInertiaTime').value = d.inertiaTime;
                    }
                    if (d.overheatTemp !== undefined && d.overheatTemp !== null && !isNaN(d.overheatTemp) && d.overheatTemp >= 70 && d.overheatTemp <= 90) {
                        document.getElementById('autoOverheatTemp').value = d.overheatTemp;
                    }
                    if (d.heatingTimeout !== undefined && d.heatingTimeout !== null && !isNaN(d.heatingTimeout) && d.heatingTimeout >= 10 && d.heatingTimeout <= 120) {
                        document.getElementById('autoHeatingTimeout').value = d.heatingTimeout;
                    }
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                })
                .catch(e => console.error('Error:', e));
        }

        function saveMqttSettings() {
            const settings = {
                enabled: document.getElementById('mqttEnabled').checked,
                server: document.getElementById('mqttServer').value,
                port: parseInt(document.getElementById('mqttPort').value),
                useTLS: document.getElementById('mqttUseTLS').checked,
                user: document.getElementById('mqttUser').value,
                password: document.getElementById('mqttPassword').value,
                prefix: document.getElementById('mqttPrefix').value,
                tempInterval: parseInt(document.getElementById('mqttTempInterval').value),
                stateInterval: parseInt(document.getElementById('mqttStateInterval').value)
            };
            
            fetch('/api/settings/mqtt', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => r.json())
            .then(d => {
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                const systemEnabled = document.getElementById('mqttSystemEnabled').checked;
                return fetch('/api/system/enable?enabled=' + (systemEnabled ? 1 : 0), { method: 'POST' });
            })
            .then(r => r.json())
            .then(d => {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –∏ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                console.error('Error:', e);
            });
        }

        function loadMqttSettings() {
            fetch('/api/settings/mqtt')
                .then(r => r.json())
                .then(d => {
                    if (d.enabled !== undefined) document.getElementById('mqttEnabled').checked = d.enabled;
                    if (d.server) document.getElementById('mqttServer').value = d.server;
                    if (d.port) document.getElementById('mqttPort').value = d.port;
                    if (d.useTLS !== undefined) document.getElementById('mqttUseTLS').checked = d.useTLS;
                    if (d.user) document.getElementById('mqttUser').value = d.user;
                    if (d.password) document.getElementById('mqttPassword').value = d.password;
                    if (d.prefix) {
                        document.getElementById('mqttPrefix').value = d.prefix;
                        updateMqttTopicInfo(d.prefix);
                    }
                    if (d.tempInterval) document.getElementById('mqttTempInterval').value = d.tempInterval;
                    if (d.stateInterval) document.getElementById('mqttStateInterval').value = d.stateInterval;
                })
                .catch(e => console.error('Error:', e));
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
            fetch('/api/status')
                .then(r => r.json())
                .then(d => {
                    if (d.systemEnabled !== undefined) {
                        document.getElementById('mqttSystemEnabled').checked = d.systemEnabled;
                    }
                })
                .catch(e => console.error('Error:', e));
        }

        function testMqttConnection() {
            fetch('/api/mqtt/test', { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    alert(d.success ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!' : '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + d.message);
                })
                .catch(e => {
                    alert('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                    console.error('Error:', e);
                });
        }

        function loadWiFiInfo() {
            fetch('/api/wifi/info')
                .then(r => r.json())
                .then(d => {
                    if (d.ssid !== undefined) document.getElementById('currentSSID').value = d.ssid || '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    if (d.ip !== undefined) document.getElementById('currentIP').value = d.ip || '--';
                    if (d.rssi !== undefined) document.getElementById('currentRSSI').value = d.rssi ? (d.rssi + ' dBm') : '--';
                    if (d.mac !== undefined) document.getElementById('currentMAC').value = d.mac || '--';
                })
                .catch(e => console.error('Error:', e));
        }

        let wifiScanCheckInterval = null;
        
        function scanWiFiNetworks() {
            const button = document.getElementById('scanWiFiButton');
            const results = document.getElementById('wifiScanResults');
            const list = document.getElementById('wifiNetworksList');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –µ—Å–ª–∏ –±—ã–ª–∞
            if (wifiScanCheckInterval) {
                clearInterval(wifiScanCheckInterval);
                wifiScanCheckInterval = null;
            }
            
            button.disabled = true;
            button.textContent = '‚è≥ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...</div>';
            results.style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            fetch('/api/wifi/scan')
                .then(r => r.json())
                .then(d => {
                    if (d.scanning) {
                        // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        checkWiFiScanResults();
                    } else {
                        // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∏–ª–∏ –æ—à–∏–±–∫–∞
                        button.disabled = false;
                        button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
                        if (d.message) {
                            list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">' + d.message + '</div>';
                        }
                    }
                })
                .catch(e => {
                    button.disabled = false;
                    button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
                    list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
                    console.error('Error:', e);
                });
        }
        
        function checkWiFiScanResults() {
            const button = document.getElementById('scanWiFiButton');
            const list = document.getElementById('wifiNetworksList');
            let attempts = 0;
            const maxAttempts = 20; // –ú–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ (20 –ø–æ–ø—ã—Ç–æ–∫ –ø–æ 0.5 —Å–µ–∫)
            
            wifiScanCheckInterval = setInterval(() => {
                attempts++;
                
                fetch('/api/wifi/scan/results')
                    .then(r => r.json())
                    .then(d => {
                        if (d.scanning) {
                            // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â–µ –∏–¥–µ—Ç
                            list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ... (' + attempts + ')</div>';
                            
                            if (attempts >= maxAttempts) {
                                // –¢–∞–π–º–∞—É—Ç
                                clearInterval(wifiScanCheckInterval);
                                wifiScanCheckInterval = null;
                                button.disabled = false;
                                button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
                                list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–¢–∞–π–º–∞—É—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
                            }
                        } else {
                            // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                            clearInterval(wifiScanCheckInterval);
                            wifiScanCheckInterval = null;
                            button.disabled = false;
                            button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
                            
                            if (d.success && d.networks && d.networks.length > 0) {
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
                                window.wifiNetworksList = d.networks;
                                
                                // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
                                populateWiFiSelects(d.networks);
                                
                                list.innerHTML = '';
                                d.networks.forEach((network, index) => {
                                    const networkDiv = document.createElement('div');
                                    networkDiv.style.cssText = 'padding: 12px; margin-bottom: 8px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px;';
                                    
                                    const rssi = network.rssi || 0;
                                    let rssiColor = '#E74C3C'; // –ö—Ä–∞—Å–Ω—ã–π
                                    if (rssi > -50) rssiColor = '#2ECC71'; // –ó–µ–ª–µ–Ω—ã–π
                                    else if (rssi > -70) rssiColor = '#F39C12'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                                    
                                    networkDiv.innerHTML = `
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-weight: 600; color: var(--text-color); margin-bottom: 4px;">
                                                    ${network.ssid || '<i>–°–∫—Ä—ã—Ç–∞—è —Å–µ—Ç—å</i>'}
                                                </div>
                                                <div style="font-size: 0.85em; color: var(--text-secondary);">
                                                    ${network.encryption || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | –ö–∞–Ω–∞–ª: ${network.channel || '--'} | 
                                                    <span style="color: ${rssiColor};">${rssi} dBm</span>
                                                </div>
                                            </div>
                                            <div style="font-size: 1.5em;">${network.encryption && network.encryption !== '–û—Ç–∫—Ä—ã—Ç–∞—è' ? 'üîí' : 'üîì'}</div>
                                        </div>
                                    `;
                                    list.appendChild(networkDiv);
                                });
                                
                                const countDiv = document.createElement('div');
                                countDiv.style.cssText = 'margin-top: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9em;';
                                countDiv.textContent = `–ù–∞–π–¥–µ–Ω–æ —Å–µ—Ç–µ–π: ${d.count || d.networks.length}`;
                                list.appendChild(countDiv);
                            } else {
                                list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–°–µ—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                                window.wifiNetworksList = [];
                                populateWiFiSelects([]);
                            }
                        }
                    })
                    .catch(e => {
                        clearInterval(wifiScanCheckInterval);
                        wifiScanCheckInterval = null;
                        button.disabled = false;
                        button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
                        list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>';
                        console.error('Error:', e);
                    });
            }, 500); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 500–º—Å
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π
        window.wifiNetworksList = [];
        
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏
        function populateWiFiSelects(networks) {
            const primarySelect = document.getElementById('primarySSIDSelect');
            const backupSelect = document.getElementById('backupSSIDSelect');
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é
            primarySelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>';
            backupSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ç–∏ –ø–æ RSSI (–æ—Ç –ª—É—á—à–µ–≥–æ –∫ —Ö—É–¥—à–µ–º—É)
            const sortedNetworks = [...networks].sort((a, b) => (b.rssi || -100) - (a.rssi || -100));
            
            sortedNetworks.forEach(network => {
                if (network.ssid) { // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ —Å–µ—Ç–∏
                    const rssi = network.rssi || 0;
                    const encryption = network.encryption || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    const optionText = `${network.ssid} (${rssi} dBm, ${encryption})`;
                    
                    // –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi
                    const primaryOption = document.createElement('option');
                    primaryOption.value = network.ssid;
                    primaryOption.textContent = optionText;
                    primarySelect.appendChild(primaryOption);
                    
                    // –î–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi
                    const backupOption = document.createElement('option');
                    backupOption.value = network.ssid;
                    backupOption.textContent = optionText;
                    backupSelect.appendChild(backupOption);
                }
            });
        }
        
        // –í—ã–±–æ—Ä SSID –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi
        function selectPrimarySSID() {
            const select = document.getElementById('primarySSIDSelect');
            const input = document.getElementById('primarySSID');
            if (select.value) {
                input.value = select.value;
            }
        }
        
        // –í—ã–±–æ—Ä SSID –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi
        function selectBackupSSID() {
            const select = document.getElementById('backupSSIDSelect');
            const input = document.getElementById('backupSSID');
            if (select.value) {
                input.value = select.value;
            }
        }
        
        function loadWiFiSettings() {
            fetch('/api/wifi/settings')
                .then(r => r.json())
                .then(d => {
                    document.getElementById('primarySSID').value = d.primarySSID || '';
                    document.getElementById('primaryPassword').value = d.primaryPassword || '';
                    document.getElementById('backupSSID').value = d.backupSSID || '';
                    document.getElementById('backupPassword').value = d.backupPassword || '';
                    document.getElementById('antennaTuning').checked = d.antennaTuning || false;
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö
                    const primarySelect = document.getElementById('primarySSIDSelect');
                    const backupSelect = document.getElementById('backupSSIDSelect');
                    if (d.primarySSID) {
                        primarySelect.value = d.primarySSID;
                    }
                    if (d.backupSSID) {
                        backupSelect.value = d.backupSSID;
                    }
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π, –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–∫–∏
                    if (window.wifiNetworksList && window.wifiNetworksList.length > 0) {
                        populateWiFiSelects(window.wifiNetworksList);
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
                        if (d.primarySSID) {
                            primarySelect.value = d.primarySSID;
                        }
                        if (d.backupSSID) {
                            backupSelect.value = d.backupSSID;
                        }
                    }
                    
                    toggleAntennaTuning();
                })
                .catch(e => {
                    console.error('Error loading WiFi settings:', e);
                });
        }
        
        function saveWiFiSettings() {
            const settings = {
                primarySSID: document.getElementById('primarySSID').value,
                primaryPassword: document.getElementById('primaryPassword').value,
                backupSSID: document.getElementById('backupSSID').value,
                backupPassword: document.getElementById('backupPassword').value,
                antennaTuning: document.getElementById('antennaTuning').checked
            };
            
            fetch('/api/wifi/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => r.json())
            .then(d => {
                if (d.success) {
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.');
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
                }
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                console.error('Error:', e);
            });
        }
        
        let antennaTuningInterval = null;
        
        function toggleAntennaTuning() {
            const enabled = document.getElementById('antennaTuning').checked;
            const infoDiv = document.getElementById('antennaSignalInfo');
            
            if (enabled) {
                infoDiv.style.display = 'block';
                updateAntennaSignal();
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                antennaTuningInterval = setInterval(updateAntennaSignal, 1000);
            } else {
                infoDiv.style.display = 'none';
                if (antennaTuningInterval) {
                    clearInterval(antennaTuningInterval);
                    antennaTuningInterval = null;
                }
            }
        }
        
        function updateAntennaSignal() {
            fetch('/api/wifi/signal')
                .then(r => r.json())
                .then(d => {
                    if (d.connected) {
                        document.getElementById('signalPercentage').textContent = d.percentage;
                        document.getElementById('signalRSSI').textContent = d.rssi;
                    } else {
                        document.getElementById('signalPercentage').textContent = '0';
                        document.getElementById('signalRSSI').textContent = 'N/A';
                    }
                })
                .catch(e => {
                    console.error('Error updating signal:', e);
                });
        }
        
        function resetWiFi() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi? –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞.')) {
                fetch('/api/wifi/reset', { method: 'POST' })
                    .then(() => {
                        alert('WiFi —Å–±—Ä–æ—à–µ–Ω. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
                    })
                    .catch(e => {
                        alert('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ WiFi');
                        console.error('Error:', e);
                    });
            }
        }

        function scanSensors() {
            fetch('/api/sensors/scan', { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    const list = document.getElementById('sensorList');
                    if (d.sensors && d.sensors.length > 0) {
                        let html = '<div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;">';
                        d.sensors.forEach(sensor => {
                            html += `<div style="padding: 8px; border-bottom: 1px solid #e9ecef;">
                                <strong>${sensor.address}</strong><br>
                                <small>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${sensor.temperature !== null ? sensor.temperature.toFixed(1) + '¬∞C' : 'N/A'}</small>
                            </div>`;
                        });
                        html += '</div>';
                        list.innerHTML = html;
                        
                        const selects = ['sensorSupply', 'sensorReturn', 'sensorBoiler', 'sensorOutside'];
                        selects.forEach(selectId => {
                            const select = document.getElementById(selectId);
                            select.innerHTML = '<option value="">–ù–µ –≤—ã–±—Ä–∞–Ω</option>';
                            d.sensors.forEach(sensor => {
                                const option = document.createElement('option');
                                option.value = sensor.address;
                                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–¥—Ä–µ—Å –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
                                let text = sensor.address;
                                if (sensor.temperature !== null && sensor.temperature !== undefined) {
                                    text += ` (${sensor.temperature.toFixed(1)}¬∞C)`;
                                } else {
                                    text += ' (N/A)';
                                }
                                option.textContent = text;
                                select.appendChild(option);
                            });
                        });
                    } else {
                        list.innerHTML = '<p>–î–∞—Ç—á–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    }
                })
                .catch(e => {
                    console.error('Error:', e);
                    alert('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤');
                });
        }

        function loadSensorMapping() {
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–≤—è–∑–∫—É
            fetch('/api/sensors/mapping')
                .then(r => r.json())
                .then(d => {
                    if (d.supply) document.getElementById('sensorSupply').value = d.supply;
                    if (d.return) document.getElementById('sensorReturn').value = d.return;
                    if (d.boiler) document.getElementById('sensorBoiler').value = d.boiler;
                    if (d.outside) document.getElementById('sensorOutside').value = d.outside;
                    
                    // –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ —Å–ø–∏—Å–∫–∞—Ö
                    updateSensorTemperaturesInSelects();
                })
                .catch(e => console.error('Error:', e));
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö
        function updateSensorTemperaturesInSelects() {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —á–µ—Ä–µ–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            fetch('/api/sensors/scan', { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    if (d.sensors && d.sensors.length > 0) {
                        const selects = ['sensorSupply', 'sensorReturn', 'sensorBoiler', 'sensorOutside'];
                        selects.forEach(selectId => {
                            const select = document.getElementById(selectId);
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ü–∏–π
                            Array.from(select.options).forEach(option => {
                                if (option.value && option.value !== '') {
                                    const sensor = d.sensors.find(s => s.address === option.value);
                                    if (sensor) {
                                        let text = sensor.address;
                                        if (sensor.temperature !== null && sensor.temperature !== undefined) {
                                            text += ` (${sensor.temperature.toFixed(1)}¬∞C)`;
                                        } else {
                                            text += ' (N/A)';
                                        }
                                        option.textContent = text;
                                    }
                                }
                            });
                        });
                    }
                })
                .catch(e => console.error('Error updating sensor temperatures:', e));
        }

        function saveSensorMapping() {
            const mapping = {
                supply: document.getElementById('sensorSupply').value,
                return: document.getElementById('sensorReturn').value,
                boiler: document.getElementById('sensorBoiler').value,
                outside: document.getElementById('sensorOutside').value
            };
            
            fetch('/api/sensors/mapping', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(mapping)
            })
            .then(r => r.json())
            .then(d => {
                alert('–ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                console.error('Error:', e);
            });
        }

        function loadSystemInfo() {
            fetch('/api/system/info')
                .then(r => r.json())
                .then(d => {
                    document.getElementById('firmwareVersion').value = d.version || '--';
                    document.getElementById('systemIP').value = d.ip || '--';
                    document.getElementById('systemMAC').value = d.mac || '--';
                    document.getElementById('systemUptime').value = d.uptime || '--';
                    document.getElementById('systemFreeMem').value = d.freeMem || '--';
                    document.getElementById('systemTime').value = d.time || '--:--:--';
                    document.getElementById('systemDate').value = d.date || '--.--.----';
                })
                .catch(e => {
                    console.error('Error loading system info:', e);
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    document.getElementById('firmwareVersion').value = '--';
                    document.getElementById('systemIP').value = '--';
                    document.getElementById('systemMAC').value = '--';
                    document.getElementById('systemUptime').value = '--';
                    document.getElementById('systemFreeMem').value = '--';
                    document.getElementById('systemTime').value = '--:--:--';
                    document.getElementById('systemDate').value = '--.--.----';
                });
        }

        function rebootDevice() {
            if (confirm('–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?')) {
                fetch('/api/system/reboot', { method: 'POST' })
                    .then(() => {
                        alert('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
                    })
                    .catch(e => {
                        alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏');
                        console.error('Error:', e);
                    });
            }
        }

        function uploadOTA() {
            const fileInput = document.getElementById('otaFile');
            const file = fileInput.files[0];
            const statusDiv = document.getElementById('otaStatus');
            const uploadBtn = document.getElementById('otaUploadBtn');
            
            if (!file) {
                statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏</span>';
                return;
            }
            
            if (!file.name.endsWith('.bin')) {
                statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ö†Ô∏è –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .bin</span>';
                return;
            }
            
            if (!confirm('–ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏? –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.')) {
                return;
            }
            
            uploadBtn.disabled = true;
            statusDiv.innerHTML = '<span style="color: #3498DB;">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</span>';
            
            const formData = new FormData();
            formData.append('firmware', file);
            
            fetch('/update', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    statusDiv.innerHTML = '<span style="color: #2ECC71;">‚úÖ –ü—Ä–æ—à–∏–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>';
                    setTimeout(() => {
                        window.location.reload();
                    }, 5000);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + response.statusText);
                }
            })
            .catch(error => {
                statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
                uploadBtn.disabled = false;
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º–Ω—É—é —Ç–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.body.className = 'theme-dark-blue';
            updateData();
            updateInterval = setInterval(updateData, 5000); // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
            startCoalFeedingTimer(); // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –¥–∞—Ç—á–∏–∫–æ–≤ (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
            setInterval(updateSensorTemperaturesInSelects, 10000);
        });
        
        function loadNTPSettings() {
            fetch('/api/ntp/settings')
                .then(r => r.json())
                .then(d => {
                    if (d.enabled !== undefined) document.getElementById('ntpEnabled').checked = d.enabled;
                    if (d.server) document.getElementById('ntpServer').value = d.server;
                    if (d.timezone !== undefined) document.getElementById('ntpTimezone').value = d.timezone;
                    if (d.updateInterval !== undefined) document.getElementById('ntpUpdateInterval').value = d.updateInterval / 3600; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —á–∞—Å—ã
                })
                .catch(e => console.error('Error:', e));
        }
        
        function updateNTPTime() {
            fetch('/api/ntp/time')
                .then(r => r.json())
                .then(d => {
                    if (d.time) document.getElementById('ntpCurrentTime').value = d.time;
                    if (d.date) document.getElementById('ntpCurrentDate').value = d.date;
                    if (d.synced !== undefined) {
                        document.getElementById('ntpSyncStatus').value = d.synced ? '‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ' : '‚úó –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
                        document.getElementById('ntpSyncStatus').style.color = d.synced ? '#27AE60' : '#E74C3C';
                    }
                })
                .catch(e => console.error('Error:', e));
        }
        
        function saveNTPSettings() {
            const serverValue = document.getElementById('ntpServer').value.trim();
            if (!serverValue || serverValue.length === 0) {
                alert('–û—à–∏–±–∫–∞: NTP —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
                return;
            }
            
            const timezoneValue = parseInt(document.getElementById('ntpTimezone').value);
            if (isNaN(timezoneValue) || timezoneValue < -12 || timezoneValue > 14) {
                alert('–û—à–∏–±–∫–∞: –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç -12 –¥–æ +14!');
                return;
            }
            
            const intervalValue = parseInt(document.getElementById('ntpUpdateInterval').value);
            if (isNaN(intervalValue) || intervalValue < 1 || intervalValue > 24) {
                alert('–û—à–∏–±–∫–∞: –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤!');
                return;
            }
            
            const settings = {
                enabled: document.getElementById('ntpEnabled').checked,
                server: serverValue,
                timezone: timezoneValue,
                updateInterval: intervalValue * 3600 // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å–µ–∫—É–Ω–¥—ã
            };
            
            fetch('/api/ntp/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => {
                if (!r.ok) {
                    return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
                }
                return r.json();
            })
            .then(d => {
                if (d.success !== undefined && d.success) {
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    setTimeout(() => {
                        updateNTPTime();
                        loadNTPSettings(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                    }, 1000);
                } else {
                    throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
                }
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
                console.error('Error:', e);
            });
        }
        
        function loadMLSettings() {
            fetch('/api/ml/settings')
                .then(r => r.json())
                .then(d => {
                    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ (true), –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
                    document.getElementById('mlEnabled').checked = d.enabled !== undefined ? d.enabled : true;
                    document.getElementById('mlPublishInterval').value = d.publishInterval !== undefined ? d.publishInterval : 10;
                })
                .catch(e => {
                    console.error('Error loading ML settings:', e);
                    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ
                    document.getElementById('mlEnabled').checked = true;
                    document.getElementById('mlPublishInterval').value = 10;
                });
        }
        
        function saveMLSettings() {
            const intervalValue = parseInt(document.getElementById('mlPublishInterval').value);
            if (isNaN(intervalValue) || intervalValue < 5 || intervalValue > 300) {
                alert('–û—à–∏–±–∫–∞: –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 5 –¥–æ 300 —Å–µ–∫—É–Ω–¥!');
                return;
            }
            
            const settings = {
                enabled: document.getElementById('mlEnabled').checked,
                publishInterval: intervalValue
            };
            
            fetch('/api/ml/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => {
                if (!r.ok) {
                    return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
                }
                return r.json();
            })
            .then(d => {
                if (d.success !== undefined && d.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
                    if (d.enabled !== undefined) {
                        document.getElementById('mlEnabled').checked = d.enabled;
                        console.log('ML enabled set to:', d.enabled);
                    }
                    if (d.publishInterval !== undefined) {
                        document.getElementById('mlPublishInterval').value = d.publishInterval;
                    }
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –í–∫–ª—é—á–µ–Ω–æ: ' + (d.enabled ? '–î–∞' : '–ù–µ—Ç'));
                } else {
                    throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
                }
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
                console.error('Error:', e);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
        function loadRelaySettings() {
            fetch('/api/settings/relay')
                .then(r => r.json())
                .then(d => {
                    document.getElementById('fanOffIsLow').checked = d.fanOffIsLow !== undefined ? d.fanOffIsLow : true;
                    document.getElementById('pumpOffIsLow').checked = d.pumpOffIsLow !== undefined ? d.pumpOffIsLow : true;
                    updateManualControlStatus(d);
                })
                .catch(e => {
                    console.error('Error loading relay settings:', e);
                });
        }

        function saveRelaySettings() {
            const settings = {
                fanOffIsLow: document.getElementById('fanOffIsLow').checked,
                pumpOffIsLow: document.getElementById('pumpOffIsLow').checked
            };
            
            console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–ª–µ:', settings);
            
            fetch('/api/settings/relay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(r => {
                if (!r.ok) {
                    return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
                }
                return r.json();
            })
            .then(d => {
                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', d);
                if (d.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
                    if (d.fanOffIsLow !== undefined) {
                        document.getElementById('fanOffIsLow').checked = d.fanOffIsLow;
                    }
                    if (d.pumpOffIsLow !== undefined) {
                        document.getElementById('pumpOffIsLow').checked = d.pumpOffIsLow;
                    }
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
                console.error('Error:', e);
            });
        }

        function controlRelay(device, state, manual) {
            const params = new URLSearchParams({
                device: device,
                state: state ? '1' : '0',
                manual: manual ? '1' : '0'
            });
            
            fetch('/api/control?' + params, {
                method: 'POST'
            })
            .then(r => r.json())
            .then(d => {
                if (d.success) {
                    console.log(`${device} ${state ? '–í–ö–õ' : '–í–´–ö–õ'} (${manual ? '–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ' : '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ'})`);
                    if (manual) {
                        loadRelaySettings(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(e => {
                alert('–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ: ' + e.message);
                console.error('Error:', e);
            });
        }

        function updateManualControlStatus(data) {
            const isActive = (data.manualFanControl || data.manualPumpControl);
            const statusEl = document.getElementById('manualControlState');
            const remainingEl = document.getElementById('manualControlRemaining');
            
            if (isActive) {
                statusEl.textContent = '–ê–∫—Ç–∏–≤–Ω–æ';
                const remaining = data.manualControlRemaining || 0;
                remainingEl.textContent = remaining > 0 ? remaining : '0';
            } else {
                statusEl.textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–æ';
                remainingEl.textContent = '--';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ –≤–∫–ª–∞–¥–∫–µ NTP
        setInterval(() => {
            if (document.getElementById('settingsNtp') && document.getElementById('settingsNtp').classList.contains('active')) {
                updateNTPTime();
            }
            // –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ–º ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
            if (document.getElementById('settingsRelay') && document.getElementById('settingsRelay').classList.contains('active')) {
                fetch('/api/settings/relay')
                    .then(r => r.json())
                    .then(d => {
                        updateManualControlStatus(d);
                    })
                    .catch(e => console.error('Error updating relay status:', e));
            }
        }, 1000);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ –≤–∫–ª–∞–¥–∫–µ –°–∏—Å—Ç–µ–º–∞
        setInterval(() => {
            if (document.getElementById('settingsSystem') && document.getElementById('settingsSystem').classList.contains('active')) {
                fetch('/api/ntp/time')
                    .then(r => r.json())
                    .then(d => {
                        if (d.time) document.getElementById('systemTime').value = d.time;
                        if (d.date) document.getElementById('systemDate').value = d.date;
                    })
                    .catch(e => console.error('Error:', e));
            }
        }, 1000);
        
        function updateMqttTopicInfo(prefix) {
            const prefixValue = prefix || document.getElementById('mqttPrefix').value || 'kotel/device1';
            const tempEl = document.getElementById('mqttTopicTemp');
            const enabledEl = document.getElementById('mqttTopicEnabled');
            const setpointEl = document.getElementById('mqttTopicSetpoint');
            const stateEl = document.getElementById('mqttTopicState');
            const coalEl = document.getElementById('mqttTopicCoalFeeding');
            const setpointSetEl = document.getElementById('mqttTopicSetpointSet');
            
            if (tempEl) tempEl.textContent = prefixValue + '/simple/temp';
            if (enabledEl) enabledEl.textContent = prefixValue + '/simple/enabled';
            if (setpointEl) setpointEl.textContent = prefixValue + '/simple/setpoint';
            if (stateEl) stateEl.textContent = prefixValue + '/state';
            if (coalEl) coalEl.textContent = prefixValue + '/coalFeeding';
            if (setpointSetEl) setpointSetEl.textContent = prefixValue + '/setpoint/set';
        }
    </script>
</body>
</html>

