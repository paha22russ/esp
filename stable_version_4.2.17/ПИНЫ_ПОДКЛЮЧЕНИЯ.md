# Схема подключения для ESP32

## Распиновка пинов ESP32

### Реле управления
- **GPIO 16** → Реле вентилятора (PIN_RELAY_FAN)
- **GPIO 17** → Реле насоса (PIN_RELAY_PUMP)

**Примечание:** Реле должны быть подключены через транзистор или модуль реле. При HIGH на пине реле включается.

### OLED дисплей (SSD1306 128x64, I2C)
- **GPIO 21** → SDA (I2C Data)
- **GPIO 22** → SCL (I2C Clock)
- **VCC** → 3.3V или 5V (в зависимости от модуля)
- **GND** → GND

**Адрес I2C:** 0x3C

### Датчики температуры DS18B20

**Датчики подключены к двум OneWire шинам:**

**Шина 1 (GPIO 4):**
- **GPIO 4** → Data (через подтягивающий резистор 4.7 кОм к VCC)
- **VCC** → 3.3V или 5V
- **GND** → GND
- **Датчики на шине 1:**
  - Подача (температура на выходе котла)
  - Обратка (температура на входе котла)

**Шина 2 (GPIO 5):**
- **GPIO 5** → Data (через подтягивающий резистор 4.7 кОм к VCC)
- **VCC** → 3.3V или 5V
- **GND** → GND
- **Датчики на шине 2:**
  - Котельная (температура в котельной)
  - Улица (температура на улице)

**Важно:** 
- Датчики DS18B20 подключены параллельно к соответствующим шинам
- На каждой шине нужен ОДИН подтягивающий резистор 4.7 кОм между Data и VCC (не на каждый датчик!)
- GPIO 4 и GPIO 5 выбраны как стабильные для OneWire на ESP32

### Энкодер (роторный энкодер с кнопкой)
- **GPIO 18** → CLK (Clock)
- **GPIO 19** → DT (Data)
- **GPIO 23** → SW (Switch/Button)
- **VCC** → 3.3V или 5V (в зависимости от энкодера)
- **GND** → GND

**Примечание:** Пины CLK, DT и SW должны иметь внутреннюю подтяжку к VCC (INPUT_PULLUP).

## Схема подключения

```
ESP32                    Внешние устройства
------                   ------------------
GPIO 16  ──────────────> Реле вентилятора
GPIO 17  ──────────────> Реле насоса
GPIO 21  ──────────────> OLED SDA
GPIO 22  ──────────────> OLED SCL
GPIO 4   ──────────────> DS18B20 шина 1 (Подача, Обратка)
GPIO 5   ──────────────> DS18B20 шина 2 (Котельная, Улица)
GPIO 18  ──────────────> Энкодер CLK
GPIO 19  ──────────────> Энкодер DT
GPIO 23  ──────────────> Энкодер SW
3.3V     ──────────────> Питание модулей
GND      ──────────────> Общий GND
```

## Питание

- **ESP32** питается от USB или внешнего источника 5V
- **OLED дисплей** - обычно 3.3V или 5V (проверьте документацию модуля)
- **DS18B20** - 3.3V или 5V
- **Энкодер** - 3.3V или 5V (проверьте документацию)
- **Модули реле** - обычно требуют 5V для питания реле, но управление может быть 3.3V

## Рекомендации

1. **Подтягивающий резистор:** Для DS18B20 обязательно используйте ОДИН резистор 4.7 кОм на каждой шине OneWire (GPIO 4 и GPIO 5), между Data и VCC. Не нужен отдельный резистор на каждый датчик!

2. **Защита от помех:** Используйте экранированные провода для датчиков температуры, особенно если провода длинные.

3. **Реле:** Используйте модули реле с оптоизоляцией для защиты ESP32 от высоких напряжений.

4. **Питание:** Убедитесь, что источник питания может обеспечить достаточный ток для всех компонентов.

5. **Заземление:** Все устройства должны иметь общий GND.

## Настройка датчиков

После первого запуска система автоматически найдет датчики DS18B20. В веб-интерфейсе можно:
- Просмотреть найденные датчики с их адресами
- Привязать датчики к переменным (Подача, Обратка, Котельная, Улица)
- Выполнить пересканирование датчиков

## Проверка подключения

1. Загрузите прошивку на ESP32
2. Откройте Serial Monitor (115200 baud)
3. Проверьте сообщения о подключении WiFi
4. Откройте веб-интерфейс по IP адресу (будет показан в Serial Monitor)
5. Проверьте показания датчиков температуры
6. Проверьте работу энкодера и дисплея
