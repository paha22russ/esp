# Информация о версии 4.2.17

## Статус: ✅ Стабильная версия

## Дата выпуска: 12.01.2026

## Основные изменения

### Исправления

1. **Исправлена логика проверки датчика для режима Комфорт**
   - Проблема: Режим комфорт включался, но сразу отключался, даже если датчик был в сети
   - Причина: Функция `isHomeTempSensorValid()` проверяла не только LWT статус, но и температуру и таймаут
   - Решение: Если LWT статус = `online`, режим комфорт разрешен, даже если температура еще не получена
   - Файл: `src/main.cpp` (функция `isHomeTempSensorValid()`)

2. **Улучшено отображение offline статуса датчика**
   - При offline датчика текст "offline" отображается серым цветом (#888)
   - Скрыт значок "°C" при offline
   - Файл: `data/index.html`

3. **Исправлено отображение температур в веб-интерфейсе**
   - Добавлены проверки существования элементов перед обновлением
   - Исправлена проблема, когда отображалась только температура подачи
   - Файл: `data/index.html`

4. **Убрано модальное окно прогресса обновления**
   - Причина: Веб-сервер блокируется во время загрузки, прогресс не обновляется
   - Решение: Простое сообщение в статусе, прогресс на OLED дисплее
   - Файл: `data/index.html`

### Новые возможности

1. **Отображение времени на OLED дисплее**
   - Когда нет подброса угля, отображается текущее время с секундами (HH:MM:SS)
   - Требует включенного NTP
   - Файл: `src/main.cpp` (функция `updateDisplay()`)

## Технические детали

### Версия прошивки
- **Версия:** 4.2.17
- **Платформа:** ESP32
- **Framework:** Arduino
- **Размер Flash:** ~1.24 MB (94.9%)
- **Размер RAM:** ~55 KB (17.0%)

### Зависимости
- ArduinoOTA @ 2.0.0
- OneWire @ 2.3.8
- DallasTemperature @ 3.11.0
- ArduinoJson @ 6.21.5
- PubSubClient @ 2.8.0
- U8g2 @ 2.36.15
- NTPClient @ 3.2.1
- WiFiManager @ 2.0.17
- ESPmDNS @ 2.0.0

### Функциональность

#### Режимы работы
- ✅ Авто (управление по температуре подачи)
- ✅ Комфорт (управление по температуре дома)

#### Отслеживание датчиков
- ✅ LWT статус датчика температуры дома
- ✅ Автоматическое переключение из Комфорт в Авто при offline
- ✅ Блокировка переключения в Комфорт при offline

#### Веб-интерфейс
- ✅ Адаптивный дизайн (портретная/альбомная ориентация)
- ✅ Отображение всех температур
- ✅ Управление режимами
- ✅ Настройки системы
- ✅ OTA обновления

#### MQTT
- ✅ Публикация данных
- ✅ Подписка на команды
- ✅ LWT для отслеживания статуса

#### OLED дисплей
- ✅ Температура подачи и уставка
- ✅ Статус подброса угля или время
- ✅ WiFi статус

## Известные ограничения

1. При обновлении через OTA веб-интерфейс недоступен во время загрузки
2. Прогресс обновления отображается только на OLED дисплее
3. При первом запуске может потребоваться несколько секунд для инициализации

## Рекомендации по использованию

1. **Перед обновлением:**
   - Сохраните текущие настройки через веб-интерфейс
   - Убедитесь, что устройство подключено к стабильному WiFi
   - Проверьте доступность MQTT брокера

2. **После обновления:**
   - Проверьте настройки MQTT
   - Проверьте подключение датчика температуры дома
   - Убедитесь, что режим Комфорт работает корректно

3. **Мониторинг:**
   - Используйте веб-интерфейс для проверки статуса
   - Проверяйте Serial Monitor для диагностики
   - Используйте MQTT для интеграции с другими системами

## Совместимость

- ✅ ESP32 Dev Module
- ✅ OLED дисплей 128x64 (I2C)
- ✅ Датчики DS18B20 (OneWire)
- ✅ MQTT брокер (любой совместимый)
- ✅ NTP сервер (ru.pool.ntp.org по умолчанию)

## Файлы версии

- `src/main.cpp` - основной код прошивки
- `data/index.html` - веб-интерфейс
- `platformio.ini` - конфигурация PlatformIO
- `upload_to_github.py` - скрипт загрузки на GitHub

## Следующие шаги

Эта версия стабильна и готова к использованию. Для дальнейшей разработки рекомендуется:

1. Создать новую ветку разработки
2. Не изменять файлы в этой папке
3. Использовать эту версию как эталон для отката

---

**Версия:** 4.2.17  
**Статус:** Стабильная  
**Дата:** 12.01.2026
