# –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

---

## üîß –§—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### `void setup()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1227  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ESP32.

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**:
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Serial –ø–æ—Ä—Ç–∞ (115200 baud)
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∏–Ω–æ–≤ —Ä–µ–ª–µ (GPIO 16, 17) –∫–∞–∫ OUTPUT
3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–Ω–∫–æ–¥–µ—Ä–∞ (GPIO 18, 19, 23) —Å INPUT_PULLUP
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –¥–ª—è —ç–Ω–∫–æ–¥–µ—Ä–∞ (CHANGE –Ω–∞ CLK –∏ DT)
5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è I2C –¥–ª—è OLED (GPIO 21, 22)
6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OLED –¥–∏—Å–ø–ª–µ—è SSD1306
7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è EEPROM (1024 –±–∞–π—Ç)
8. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ EEPROM:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - MQTT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
9. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SPIFFS —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WiFiManager —Å —Ç–∞–π–º–∞—É—Ç–æ–º 180 —Å–µ–∫—É–Ω–¥
11. –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WiFi –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ "KotelAP"
12. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OTA (Over-The-Air –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
13. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö API endpoints
14. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ OLED –¥–∏—Å–ø–ª–µ—è

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ EEPROM, setupOTA(), handleWebInterface()

---

### `void loop()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1390  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ.

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
1. **ArduinoOTA.handle()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
2. **server.handleClient()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
3. **MQTT –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
   - mqttClient.loop() –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏**:
   - –í—ã–≤–æ–¥ IP –∞–¥—Ä–µ—Å–∞ –≤ Serial –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö MQTT —Ç–æ–ø–∏–∫–æ–≤ (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫)
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è MQTT (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
5. **processWiFiScanResults()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ WiFi —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
6. **handleEncoder()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç–Ω–∫–æ–¥–µ—Ä–∞ (–ø–æ–≤–æ—Ä–æ—Ç –∏ –∫–Ω–æ–ø–∫–∞)
7. **checkCoalFeeding()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
8. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–º** - –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –ø–æ–¥–±—Ä–æ—Å–µ —É–≥–ª—è
9. **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ pendingRebootTime
10. **–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ EEPROM** - —á–µ—Ä–µ–∑ 2 —Å–µ–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
11. **updateDisplay()** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ OLED –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
12. **delay(1)** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.

---

## üì∫ –§—É–Ω–∫—Ü–∏–∏ OLED –¥–∏—Å–ø–ª–µ—è

### `void updateDisplay()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 142  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ OLED –¥–∏—Å–ø–ª–µ—è SSD1306 128x64.

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**:
1. **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏** (–∫—Ä—É–ø–Ω—ã–π —à—Ä–∏—Ñ—Ç, —Å—Ç—Ä–æ–∫–∞ 25):
   - –§–æ—Ä–º–∞—Ç: "XX.X¬∞C" –∏–ª–∏ "--¬∞C" –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
   - –®—Ä–∏—Ñ—Ç: u8g2_font_ncenB18_tr
2. **–£—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã** (—Å—Ä–µ–¥–Ω–∏–π —à—Ä–∏—Ñ—Ç, —Å—Ç—Ä–æ–∫–∞ 40):
   - –§–æ—Ä–º–∞—Ç: "–£—Å—Ç: XX.X¬∞C"
   - –®—Ä–∏—Ñ—Ç: u8g2_font_ncenB10_tr
3. **–°—Ç–∞—Ç—É—Å –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è** (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω, —Å—Ç—Ä–æ–∫–∞ 55):
   - –§–æ—Ä–º–∞—Ç: "–£–≥–æ–ª—å: MM:SS" (–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã)
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ coalFeedingActive == true
4. **WiFi —Å—Ç–∞—Ç—É—Å** (–Ω–∏–∂–Ω—è—è —Å—Ç—Ä–æ–∫–∞, 64):
   - IP –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω: "192.168.1.100"
   - –ò–ª–∏ "WiFi: OFF" –µ—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
   - –®—Ä–∏—Ñ—Ç: u8g2_font_6x10_tr

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
- `supplyTemp` - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏
- `setpoint` - —É—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
- `coalFeedingActive` - —Ñ–ª–∞–≥ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
- `WiFi.status()` - —Å—Ç–∞—Ç—É—Å WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `WiFi.localIP()` - IP –∞–¥—Ä–µ—Å

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è**: –í loop() –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É, —Ç–∞–∫–∂–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Å—Ç–∞–≤–∫–∏ —ç–Ω–∫–æ–¥–µ—Ä–æ–º.

---

## üîÑ –§—É–Ω–∫—Ü–∏–∏ —ç–Ω–∫–æ–¥–µ—Ä–∞

### `void IRAM_ATTR encoderISR()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 117  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –¥–ª—è —ç–Ω–∫–æ–¥–µ—Ä–∞. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∏–Ω–æ–≤ CLK –∏–ª–∏ DT.

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã**:
1. –ß–∏—Ç–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–æ–∏—Ö –ø–∏–Ω–æ–≤ (CLK –∏ DT)
2. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `(CLK << 1) | DT`
3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º —Å–æ—Å—Ç–æ—è–Ω–∏–π:
   - `00 ‚Üí 01`: –ø–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ (encoderPosition++)
   - `00 ‚Üí 10`: –ø–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ (encoderPosition--)
   - `11 ‚Üí 01`: –ø–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ (encoderPosition--)
   - `11 ‚Üí 10`: –ø–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ (encoderPosition++)
4. –û–±–Ω–æ–≤–ª—è–µ—Ç `lastEncoderState` –∏ `lastEncoderChange`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `IRAM_ATTR` –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤ –±—ã—Å—Ç—Ä–æ–π –ø–∞–º—è—Ç–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏ CHANGE –Ω–∞ –æ–±–æ–∏—Ö –ø–∏–Ω–∞—Ö
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

### `void handleEncoder()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 520  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–Ω–∫–æ–¥–µ—Ä–∞ –∏ –∫–Ω–æ–ø–∫—É. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ loop().

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞**:
1. –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É: `delta = encoderPosition - lastEncoderPosition`
2. –ò–∑–º–µ–Ω—è–µ—Ç —É—Å—Ç–∞–≤–∫—É: `newSetpoint = setpoint + (delta * 0.5)` (—à–∞–≥ 0.5¬∞C)
3. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω: 40-80¬∞C
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `autoSettingsDirty` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
5. –ü—É–±–ª–∏–∫—É–µ—Ç –≤ MQTT (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)
6. –û–±–Ω–æ–≤–ª—è–µ—Ç `lastEncoderPosition`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏**:
1. –ß–∏—Ç–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑-–∑–∞ INPUT_PULLUP)
2. –î–µ–±–∞—É–Ω—Å–∏–Ω–≥: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ 200–º—Å
3. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–±—Ä–æ—Å —É–≥–ª—è:
   - –ï—Å–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí `startCoalFeeding()`
   - –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí `stopCoalFeeding()`

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
- `encoderPosition` - —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è (–∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ ISR)
- `lastEncoderPosition` - –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
- `encoderButtonPressed` - —Ñ–ª–∞–≥ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
- `lastButtonPress` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–∂–∞—Ç–∏—è

---

## üî• –§—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è

### `void startCoalFeeding()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 568  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è.

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —É–∂–µ —Ä–µ–∂–∏–º (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞)
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `coalFeedingActive = true`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: `coalFeedingStartTime = millis()`
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞: `fanStateBeforeCoalFeeding = fanState`
5. **–í—ã–∫–ª—é—á–∞–µ—Ç –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä**: `fanState = false`, `digitalWrite(PIN_RELAY_FAN, LOW)`
6. –ü—É–±–ª–∏–∫—É–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ MQTT: `kotel/device1/coalFeeding = "1"`
7. –û–±–Ω–æ–≤–ª—è–µ—Ç OLED –¥–∏—Å–ø–ª–µ–π

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–¥—É–≤–∞–Ω–∏—è –æ–≥–Ω—è.

---

### `void stopCoalFeeding()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 593  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è.

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–µ–∂–∏–º
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `coalFeedingActive = false`
3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä:
   - –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
   - –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ ‚Üí –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º
4. –ü—É–±–ª–∏–∫—É–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ MQTT: `kotel/device1/coalFeeding = "0"`
5. –û–±–Ω–æ–≤–ª—è–µ—Ç OLED –¥–∏—Å–ø–ª–µ–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–µ.

---

### `void checkCoalFeeding()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 622  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–±—ã—Ç–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è).

**–õ–æ–≥–∏–∫–∞**:
1. –ï—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –≤—ã—Ö–æ–¥
2. –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è: `elapsed = millis() - coalFeedingStartTime`
3. –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ ‚â• 30 –º–∏–Ω—É—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `stopCoalFeeding()`

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞.

---

### `int getCoalFeedingRemainingSeconds()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 637  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
- `0` - –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ —Å –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—á–∞–ª–∞ (–º–∞–∫—Å–∏–º—É–º 1800 = 30 –º–∏–Ω—É—Ç)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞.

---

## üíæ –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å EEPROM

### `void saveAutoSettingsToEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 185  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ EEPROM.

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç EEPROM
2. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ `EEPROM_MAGIC` (0xAA)
3. –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç `autoSettings` –≤ JSON:
   - setpoint, minTemp, maxTemp, hysteresis
   - inertiaTemp, inertiaTime, overheatTemp, heatingTimeout
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–ª–∏–Ω—É JSON –∏ —Å–∞–º JSON –≤ –∞–¥—Ä–µ—Å–∞ –Ω–∞—á–∏–Ω–∞—è —Å `EEPROM_ADDR_AUTO + 4`
5. –í—ã–ø–æ–ª–Ω—è–µ—Ç `EEPROM.commit()` –¥–ª—è –∑–∞–ø–∏—Å–∏
6. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç EEPROM

**–ê–¥—Ä–µ—Å–∞**: `EEPROM_ADDR_AUTO = 1` (–º–∞–≥–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ –≤ 0, –¥–ª–∏–Ω–∞ –≤ 1-4, –¥–∞–Ω–Ω—ã–µ –≤ 5-204)

**–§–æ—Ä–º–∞—Ç JSON**:
```json
{
  "setpoint": 60.0,
  "minTemp": 45.0,
  "maxTemp": 75.0,
  "hysteresis": 2.0,
  "inertiaTemp": 55.0,
  "inertiaTime": 10,
  "overheatTemp": 77.0,
  "heatingTimeout": 30
}
```

---

### `void loadAutoSettingsFromEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 212  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏–∑ EEPROM.

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ
2. –ß–∏—Ç–∞–µ—Ç –¥–ª–∏–Ω—É JSON
3. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–ª–∏–Ω—É (0 < len < 250)
4. –ß–∏—Ç–∞–µ—Ç JSON —Å—Ç—Ä–æ–∫—É
5. –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç JSON
6. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
   - setpoint: 40-80¬∞C
   - minTemp: 30-60¬∞C
   - maxTemp: 60-90¬∞C
   - hysteresis: 0.5-10¬∞C
   - inertiaTemp: 40-70¬∞C
   - inertiaTime: 1-60 –º–∏–Ω—É—Ç
   - overheatTemp: 70-90¬∞C
   - heatingTimeout: 10-120 –º–∏–Ω—É—Ç
7. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

---

### `void saveMqttSettingsToEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 280  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –≤ EEPROM.

**–ê–¥—Ä–µ—Å–∞**: `EEPROM_ADDR_MQTT = 200`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**:
- enabled (bool)
- server (String)
- port (int)
- useTLS (bool)
- user (String)
- password (String)
- prefix (String)
- tempInterval (int)
- stateInterval (int)

**–§–æ—Ä–º–∞—Ç**: JSON, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ AutoSettings.

---

### `void loadMqttSettingsFromEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 305  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –∏–∑ EEPROM.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ë–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å).

---

### `void saveSensorMappingToEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 335  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫ —Ç–∏–ø–∞–º.

**–ê–¥—Ä–µ—Å–∞**: `EEPROM_ADDR_SENSORS = 400`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- supply - –∞–¥—Ä–µ—Å –¥–∞—Ç—á–∏–∫–∞ –ø–æ–¥–∞—á–∏
- return - –∞–¥—Ä–µ—Å –¥–∞—Ç—á–∏–∫–∞ –æ–±—Ä–∞—Ç–∫–∏
- boiler - –∞–¥—Ä–µ—Å –¥–∞—Ç—á–∏–∫–∞ –∫–æ—Ç–µ–ª—å–Ω–æ–π
- outside - –∞–¥—Ä–µ—Å –¥–∞—Ç—á–∏–∫–∞ —É–ª–∏—Ü—ã

---

### `void loadSensorMappingFromEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 355  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –¥–∞—Ç—á–∏–∫–æ–≤ –∏–∑ EEPROM.

---

### `void saveSystemEnabledToEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 380  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.

**–ê–¥—Ä–µ—Å–∞**: `EEPROM_ADDR_SYSTEM = 600`

**–î–∞–Ω–Ω—ã–µ**: –û–¥–∏–Ω –±–∞–π—Ç (bool) - `systemEnabled`

---

### `void loadSystemEnabledFromEEPROM()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 388  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–∑ EEPROM.

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: `true` (—Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞).

---

## üì° –§—É–Ω–∫—Ü–∏–∏ MQTT

### `void mqttCallback(char* topic, byte* payload, unsigned int length)`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 405  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö MQTT —Å–æ–æ–±—â–µ–Ω–∏–π.

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Ç–æ–ø–∏–∫–∏**:
- `{prefix}/setpoint/set` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å—Ç–∞–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
  - –ó–Ω–∞—á–µ–Ω–∏–µ: —á–∏—Å–ª–æ –æ—Ç 40 –¥–æ 80
  - –î–µ–π—Å—Ç–≤–∏–µ: –æ–±–Ω–æ–≤–ª—è–µ—Ç `setpoint` –∏ `autoSettings.setpoint`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ EEPROM

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ Serial.

---

### `bool mqttConnect()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 431  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT –±—Ä–æ–∫–µ—Ä—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**:
- Server: `mqttSettings.server`
- Port: `mqttSettings.port`
- User: `mqttSettings.user`
- Password: `mqttSettings.password`
- Client ID: `ESP32_Kotel_{MAC}` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ MAC –∞–¥—Ä–µ—Å–∞)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: 2 —Å–µ–∫—É–Ω–¥—ã (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `{prefix}/setpoint/set`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, `false` –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è**: –í loop() –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

---

### `void publishMqttState()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 474  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—É–±–ª–∏–∫—É–µ—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤ MQTT.

**–¢–æ–ø–∏–∫**: `{prefix}/state`

**–î–∞–Ω–Ω—ã–µ (JSON)**:
```json
{
  "supplyTemp": 65.5,
  "returnTemp": 55.0,
  "boilerTemp": 70.0,
  "outdoorTemp": -5.0,
  "setpoint": 60.0,
  "fan": true,
  "pump": false,
  "systemEnabled": true,
  "state": "HEATING",
  "wifiRSSI": -45,
  "wifiSSID": "MyWiFi",
  "wifiIP": "192.168.1.100",
  "wifiMAC": "E4:65:B8:13:83:94",
  "uptime": 3600,
  "freeMem": 250000
}
```

**–ò–Ω—Ç–µ—Ä–≤–∞–ª**: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `mqttSettings.stateInterval`).

---

### `void publishMqttSimple()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 504  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—É–±–ª–∏–∫—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ç–æ–ø–∏–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

**–¢–æ–ø–∏–∫–∏**:
- `{prefix}/simple/temp` - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏ (—á–∏—Å–ª–æ)
- `{prefix}/simple/enabled` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã ("1" –∏–ª–∏ "0")
- `{prefix}/simple/setpoint` - —É—Å—Ç–∞–≤–∫–∞ (—á–∏—Å–ª–æ)

**–ò–Ω—Ç–µ—Ä–≤–∞–ª**: –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `mqttSettings.tempInterval`).

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (QoS 0) –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## üåê –§—É–Ω–∫—Ü–∏–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

### `void handleWebInterface()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 652  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç—É.

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `/index.html` –∏–∑ SPIFFS
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É: `server.streamFile(file, "text/html; charset=utf-8")`
3. –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç fallback HTML

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏**: –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.

---

### `void handleStatus()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 669  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/status`

**–û—Ç–≤–µ—Ç (JSON)**:
```json
{
  "supplyTemp": 65.5,
  "returnTemp": 55.0,
  "boilerTemp": 70.0,
  "outdoorTemp": -5.0,
  "setpoint": 60.0,
  "fan": true,
  "pump": false,
  "systemEnabled": true,
  "state": "HEATING",
  "wifiStatus": "–ü–æ–¥–∫–ª—é—á–µ–Ω",
  "wifiRSSI": -45,
  "coalFeeding": false,
  "coalFeedingRemaining": 0
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.

---

### `void handleSetpoint()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 691  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É—Å—Ç–∞–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/setpoint`  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `value` (float, 40-80)

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ (40-80¬∞C)
2. –û–±–Ω–æ–≤–ª—è–µ—Ç `setpoint` –∏ `autoSettings.setpoint`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `autoSettingsDirty` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
4. –ü—É–±–ª–∏–∫—É–µ—Ç –≤ MQTT (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

---

### `void handleControl()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 723  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä, –Ω–∞—Å–æ—Å).

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/control`  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `device` (string: "fan" –∏–ª–∏ "pump"), `state` (int: 0 –∏–ª–∏ 1)

**–î–µ–π—Å—Ç–≤–∏—è**: –û–±–Ω–æ–≤–ª—è–µ—Ç `fanState` –∏–ª–∏ `pumpState`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–µ (TODO).

---

### `void handleSystemControl()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 859  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/system/enable`  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `enabled` (int: 0 –∏–ª–∏ 1)

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –û–±–Ω–æ–≤–ª—è–µ—Ç `systemEnabled`
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ EEPROM
3. –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ ‚Üí –≤—ã–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ä–µ–ª–µ

---

### `void handleAutoSettingsGet()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 751  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/settings/auto`

**–û—Ç–≤–µ—Ç**: JSON —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `autoSettings`.

---

### `void handleAutoSettingsPost()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 768  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/settings/auto`  
**–¢–µ–ª–æ**: JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–î–µ–π—Å—Ç–≤–∏—è**: –û–±–Ω–æ–≤–ª—è–µ—Ç `autoSettings`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ EEPROM –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.

---

### `void handleMqttSettingsGet()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 794  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ MQTT.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/settings/mqtt`

---

### `void handleMqttSettingsPost()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 812  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ MQTT.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/settings/mqtt`

**–î–µ–π—Å—Ç–≤–∏—è**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT –±—Ä–æ–∫–µ—Ä—É.

---

### `void handleMqttTest()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 844  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è MQTT –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/mqtt/test`

**–î–µ–π—Å—Ç–≤–∏—è**: –í—ã–∑—ã–≤–∞–µ—Ç `mqttConnect()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

### `void handleWiFiInfo()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 883  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ WiFi.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/wifi/info`

**–û—Ç–≤–µ—Ç**:
```json
{
  "ssid": "MyWiFi",
  "ip": "192.168.1.100",
  "rssi": -45,
  "mac": "E4:65:B8:13:83:94"
}
```

---

### `void handleWiFiScan()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 901  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è WiFi —Å–µ—Ç–µ–π.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/wifi/scan`

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∏–¥–µ—Ç –ª–∏ —É–∂–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `WiFi.scanNetworks(true, true)`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `wifiScanInProgress = true`
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ"

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

---

### `void processWiFiScanResults()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 928  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã WiFi —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ loop()).

**–õ–æ–≥–∏–∫–∞**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `WiFi.scanComplete()`
2. –ï—Å–ª–∏ `WIFI_SCAN_RUNNING` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∞–π–º–∞—É—Ç (10 —Å–µ–∫—É–Ω–¥)
3. –ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ `wifiScanResult`, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥

---

### `void handleWiFiScanResults()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 957  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ WiFi —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/wifi/scan/results`

**–û—Ç–≤–µ—Ç**:
```json
{
  "scanning": false,
  "count": 5,
  "success": true,
  "networks": [
    {
      "ssid": "MyWiFi",
      "rssi": -45,
      "channel": 6,
      "encryption": "WPA2",
      "hidden": false
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ß–∏—Ç–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `WiFi.scanComplete()` –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏.

---

### `void handleWiFiReset()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1013  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Å–±—Ä–æ—Å–∞ WiFi –Ω–∞—Å—Ç—Ä–æ–µ–∫.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/wifi/reset`

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi —á–µ—Ä–µ–∑ `wifiManager.resetSettings()`
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `pendingRebootTime` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ 500–º—Å
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)

---

### `void handleSensorsScan()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1022  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–∑–∞–≥–ª—É—à–∫–∞).

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/sensors/scan`

**TODO**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ DS18B20.

---

### `void handleSensorsMappingGet()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1036  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–≤—è–∑–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/sensors/mapping`

---

### `void handleSensorsMappingPost()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1049  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—è–∑–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/sensors/mapping`

---

### `void handleSystemInfo()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1068  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–ú–µ—Ç–æ–¥**: GET  
**–ü—É—Ç—å**: `/api/system/info`

**–û—Ç–≤–µ—Ç**:
```json
{
  "version": "1.0.3",
  "ip": "192.168.1.100",
  "mac": "E4:65:B8:13:83:94",
  "uptime": "1—á 30–º 45—Å",
  "freeMem": "250 KB"
}
```

---

### `void handleReboot()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1191  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

**–ú–µ—Ç–æ–¥**: POST  
**–ü—É—Ç—å**: `/api/system/reboot`

**–î–µ–π—Å—Ç–≤–∏—è**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `pendingRebootTime` –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

---

### `void handleCoalFeeding()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1198  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API endpoint –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–±—Ä–æ—Å–æ–º —É–≥–ª—è.

**–ú–µ—Ç–æ–¥—ã**: GET, POST  
**–ü—É—Ç—å**: `/api/coalFeeding`

**GET**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å  
**POST**: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º (toggle)

**–û—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "coalFeeding": true,
  "remaining": 450
}
```

---

## üîÑ –§—É–Ω–∫—Ü–∏–∏ OTA

### `void setupOTA()`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 1088  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Over-The-Air –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- Hostname: `KotelESP32_{MAC}` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ MAC)
- Password: `kotel12345`
- Port: 3232 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:
- `onStart`: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç "OTA Update..." –Ω–∞ OLED
- `onEnd`: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç "OTA Done!" –Ω–∞ OLED
- `onProgress`: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –Ω–∞ OLED (0-100%)
- `onError`: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç "OTA Error!" –Ω–∞ OLED

**–†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–∞—Ö**: STA (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi) –∏ AP (—Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞).

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ
- EEPROM –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- MQTT –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ (QoS 0, –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- WiFi —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ
- OLED –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ (1 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)

