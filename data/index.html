<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ç–ª–æ–º</title><style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #1a1a1a;
min-height: 100vh;
padding: 5px;
color: #fff;
overflow-x: hidden;
}

body.overheat {
background: #cc0000 !important;
animation: overheatPulse 1s infinite;
}

@keyframes overheatPulse {
0%, 100% { background: #cc0000; }
50% { background: #ff3333; }
}

body.extinguishing {
background: #3a2a1a;
}

.container {
max-width: 100%;
width: 100%;
margin: 0;
background: #2a2a2a;
border-radius: 0;
overflow-x: hidden;
position: relative;
border: none;
min-height: 100vh;
box-shadow: none;
}

.header {
display: flex;
flex-direction: column;
background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
border-radius: 0;
margin-bottom: 0;
box-shadow: 0 2px 8px rgba(0,0,0,0.4);
position: relative;
border-bottom: 2px solid #3a3a3a;
}

.header-top {
display: flex;
justify-content: space-between;
align-items: center;
padding: 12px 8px;
}

.header h1 {
font-size: 22px;
font-weight: 400;
letter-spacing: 1px;
flex: 1;
margin: 0;
color: #ff6b35;
cursor: pointer;
transition: opacity 0.3s;
}

.header h1:hover {
opacity: 0.8;
}

.menu-button {
background: linear-gradient(135deg, #3a3a3a 0%, #2a2a2a 100%);
border: 1px solid #4a4a4a;
color: #fff;
padding: 8px 16px;
border-radius: 8px;
cursor: pointer;
font-size: 18px;
transition: all 0.3s;
box-shadow: 0 2px 4px rgba(0,0,0,0.3);
min-width: 44px;
display: flex;
align-items: center;
justify-content: center;
}

.menu-button:hover {
background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
transform: translateY(-1px);
box-shadow: 0 3px 6px rgba(0,0,0,0.4);
}

.menu-button:active {
transform: translateY(0);
box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.dropdown-menu {
position: absolute;
top: 100%;
right: 0;
background: #2a2a2a;
border-radius: 8px;
box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
min-width: 200px;
z-index: 2000;
display: none;
margin-top: 5px;
overflow: hidden;
border: 1px solid #3a3a3a;
}

.dropdown-menu.show {
display: block;
}

.dropdown-item {
padding: 12px 20px;
cursor: pointer;
color: #fff !important;
border-bottom: 1px solid #3a3a3a;
transition: background 0.2s;
font-size: 0.95em;
}

.dropdown-item:hover {
background: #3a3a3a;
}

.dropdown-item:last-child {
border-bottom: none;
}

.status-bar {
background: rgba(0,0,0,0.2);
padding: 10px 15px;
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 10px 15px;
font-size: 0.75em;
border-top: 1px solid rgba(255,255,255,0.1);
}

.status-indicator {
display: flex;
align-items: center;
gap: 6px;
padding: 4px 8px;
background: rgba(255,255,255,0.05);
border-radius: 6px;
transition: all 0.3s;
}

.status-indicator:hover {
background: rgba(255,255,255,0.08);
}

.status-dot {
width: 10px;
height: 10px;
border-radius: 50%;
background: #28a745;
animation: pulse 2s infinite;
flex-shrink: 0;
box-shadow: 0 0 4px rgba(40, 167, 69, 0.5);
}

.status-dot.success {
background: #28a745;
animation: pulse 2s infinite;
box-shadow: 0 0 4px rgba(40, 167, 69, 0.5);
}

.status-dot.warning {
background: #ffc107;
animation: pulse 2s infinite;
box-shadow: 0 0 4px rgba(255, 193, 7, 0.5);
}

.status-dot.danger {
background: #dc3545;
animation: blink 1s infinite;
box-shadow: 0 0 4px rgba(220, 53, 69, 0.5);
}

.status-dot.info {
background: #17a2b8;
animation: pulse 1.5s infinite;
box-shadow: 0 0 4px rgba(23, 162, 184, 0.5);
}

.status-dot.idle {
background: #6c757d;
animation: none;
box-shadow: none;
}

.status-indicator strong {
font-weight: 600;
color: #fff;
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

@keyframes blink {
0%, 100% { opacity: 1; }
50% { opacity: 0.3; }
}

.state-display {
font-size: 0.9em;
font-weight: 500;
color: #fff;
}

.wifi-signal-bars {
display: inline-flex;
align-items: flex-end;
gap: 2px;
height: 12px;
margin-right: 4px;
}

.wifi-bar {
width: 3px;
background: #6c757d;
border-radius: 1px 1px 0 0;
transition: all 0.3s;
}

.wifi-bar.bar1 {
height: 3px;
}

.wifi-bar.bar2 {
height: 5px;
}

.wifi-bar.bar3 {
height: 7px;
}

.wifi-bar.bar4 {
height: 9px;
}

.wifi-bar.active {
background: #2ECC71;
}

.wifi-bar.warning {
background: #F39C12;
}

.wifi-bar.danger {
background: #E74C3C;
}

.wifi-rssi-text {
font-size: 0.85em;
opacity: 0.9;
font-weight: 500;
}

.main-page {
padding: 8px;
padding-bottom: 15px;
}

.temperature-display {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 6px;
margin-bottom: 6px;
}

.main-temps-container {
display: flex;
gap: 8px;
margin-bottom: 8px;
}

.main-temps-container .temp-card {
flex: 1;
padding: 30px !important;
border-radius: 30px !important;
}

.main-temps-container .temp-label {
font-size: 28px !important;
margin-bottom: 15px !important;
}

.main-temps-container .temp-value {
font-size: 72px !important;
margin: 20px 0 !important;
}

@media (orientation: portrait) and (max-width: 768px) {
.main-temps-container {
flex-direction: column;
gap: 6px;
}

.main-temps-container .temp-card {
padding: 20px !important;
border-radius: 20px !important;
}

.main-temps-container .temp-label {
font-size: 20px !important;
margin-bottom: 10px !important;
}

.main-temps-container .temp-value {
font-size: 48px !important;
margin: 15px 0 !important;
}

.main-temps-container .setpoint-value {
font-size: 20px !important;
}
}

.setpoint-section.auto-only {
display: none;
}

.setpoint-section.comfort-only {
display: none;
}

body.comfort-mode .setpoint-section.auto-only {
display: none !important;
}

body.comfort-mode .setpoint-section.comfort-only {
display: block !important;
}

body.auto-mode .setpoint-section.comfort-only {
display: none !important;
}

body.auto-mode .setpoint-section.auto-only {
display: block !important;
}

.temp-card {
background: #2a2a2a;
border-radius: 10px;
padding: 10px;
text-align: center;
position: relative;
box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
transition: all 0.3s;
}

.temp-card.main-temp-card {
padding: 12px;
}

#supplyTempCard .setpoint-value,
#homeTempCard .setpoint-value {
font-size: 28px !important;
margin: 4px 0 !important;
}

#supplyTempCard .setpoint-btn,
#homeTempCard .setpoint-btn {
padding: 3px 10px !important;
font-size: 12px !important;
min-width: 32px !important;
height: 28px !important;
}

#supplyTempCard .setpoint-section,
#homeTempCard .setpoint-section {
margin-top: 8px !important;
padding-top: 8px !important;
}

#supplyTempCard .setpoint-control-wrapper,
#homeTempCard .setpoint-control-wrapper {
gap: 10px !important;
}

.temp-card:hover {
transform: translateY(-2px);
box-shadow: 7px 7px 15px rgba(0,0,0,0.4);
}

.temp-card.overheat {
background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
animation: shake 0.5s infinite;
}

@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-2px); }
75% { transform: translateX(2px); }
}

.temp-label {
font-size: 11px;
color: #aaa;
margin-bottom: 6px;
}

.temp-value {
font-size: 28px;
font-weight: 300;
color: #ff6b35;
margin: 8px 0;
}

.temp-value.setpoint {
font-size: 20px;
color: #aaa;
margin: 4px 0;
}

.temp-unit {
font-size: 0.4em;
opacity: 0.8;
}

.temp-trend-arrow {
display: inline-block;
font-size: 0.5em;
margin-left: 4px;
animation: trendPulse 3s ease-in-out infinite;
opacity: 0.7;
}

.temp-trend-arrow.up {
color: #2ECC71;
}

.temp-trend-arrow.down {
color: #E74C3C;
}

@keyframes trendPulse {
0%, 100% {
opacity: 0.3;
}
50% {
opacity: 0.9;
}
}

.temp-trend-arrow.up {
animation: trendPulseUp 3s ease-in-out infinite;
}

.temp-trend-arrow.down {
animation: trendPulseDown 3s ease-in-out infinite;
}

@keyframes trendPulseUp {
0%, 100% {
opacity: 0.3;
transform: translateY(0);
}
50% {
opacity: 0.9;
transform: translateY(-2px);
}
}

@keyframes trendPulseDown {
0%, 100% {
opacity: 0.3;
transform: translateY(0);
}
50% {
opacity: 0.9;
transform: translateY(2px);
}
}

.overheat-warning {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(204, 0, 0, 0.95);
color: #fff;
padding: 30px 50px;
border-radius: 15px;
font-size: 32px;
font-weight: bold;
z-index: 1000;
display: none;
box-shadow: 0 0 50px rgba(255, 0, 0, 0.8);
animation: warningPulse 0.5s infinite;
}

@keyframes warningPulse {
0%, 100% { transform: translate(-50%, -50%) scale(1); }
50% { transform: translate(-50%, -50%) scale(1.05); }
}

.overheat-warning.show {
display: block;
}

.setpoint-control {
background: #2a2a2a;
border-radius: 15px;
padding: 20px 15px;
margin: 20px 0;
text-align: center;
box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
border: 2px solid #3a3a3a;
transition: border-color 0.3s;
}

.setpoint-control.fan-on {
border-color: #00ff00;
}

.setpoint-control.pump-on {
border-color: #00ff00;
}

.setpoint-control.fan-on.pump-on {
border-color: #00ff00;
}

.setpoint-control.fan-off.pump-off {
border-color: #555;
}

.setpoint-display {
font-size: 48px;
font-weight: 300;
color: #ff6b35;
margin: 15px 0;
}

.setpoint-controls {
display: flex;
align-items: center;
justify-content: center;
gap: 20px;
margin-top: 15px;
}

.setpoint-btn {
min-width: 40px;
height: 32px;
border: none;
background: #3a3a3a;
color: #fff;
font-size: 18px;
border-radius: 8px;
cursor: pointer;
transition: all 0.2s;
box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.setpoint-btn:hover:not(:disabled) {
background: #4a4a4a;
transform: scale(1.05);
}

.setpoint-btn:active:not(:disabled) {
transform: scale(0.95);
}

.setpoint-btn:disabled {
opacity: 0.3;
cursor: not-allowed;
}

.device-icons {
display: flex;
gap: 10px;
align-items: center;
justify-content: center;
margin: 20px 0;
}

.device-icon {
width: 50px;
height: 50px;
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.8em;
cursor: pointer;
transition: all 0.3s;
border: 2px solid #3a3a3a;
background: #2a2a2a;
position: relative;
overflow: hidden;
box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
}

.device-icon.active {
background: #00ff00;
border-color: #00ff00;
color: #000;
}

.device-icon.inactive {
border-color: #555;
background: #2a2a2a;
color: #888;
}

.device-icon.fan.active {
animation: pulseFan 1.2s ease-in-out infinite;
}

@keyframes pulseFan {
0%, 100% { transform: scale(1); opacity: 1; }
50% { transform: scale(1.15); opacity: 0.85; }
}

.device-icon.pump.active {
animation: pulsePump 1.5s ease-in-out infinite;
}

@keyframes pulsePump {
0%, 100% { transform: scale(1); opacity: 1; }
50% { transform: scale(1.1); opacity: 0.8; }
}

.settings-page {
display: none;
padding: 15px;
max-height: 70vh;
overflow-y: auto;
}

.settings-page.active {
display: block;
}

.settings-group {
margin-bottom: 20px;
}

.settings-group h3 {
color: #aaa;
font-size: 16px;
margin-bottom: 15px;
font-weight: 400;
}

.setting-item {
margin-bottom: 15px;
}

.setting-item label {
display: block;
color: #fff;
margin-bottom: 5px;
font-size: 14px;
}

.setting-item input[type="number"],
.setting-item input[type="text"],
.setting-item input[type="password"],
.setting-item select {
width: 100%;
padding: 10px;
background: #3a3a3a;
border: 1px solid #555;
border-radius: 5px;
color: #fff;
font-size: 14px;
}

.setting-item input[readonly][style*="background: #e9ecef"] {
background: #3a3a3a !important;
color: #fff !important;
}

.setting-item input:focus,
.setting-item select:focus {
outline: none;
border-color: #ff6b35;
}

.btn-group {
display: flex;
gap: 8px;
margin-top: 15px;
}

.btn {
flex: 1;
padding: 10px;
border: none;
border-radius: 6px;
font-size: 0.9em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
}

.btn-primary {
background: #ff6b35;
color: #fff;
}

.btn-primary:hover {
background: #ff8c55;
}

.btn-secondary {
background: #3a3a3a;
color: #fff;
}

.btn-secondary:hover {
background: #4a4a4a;
}

.back-button {
background: #3a3a3a;
color: #fff;
border: none;
padding: 10px 20px;
border-radius: 8px;
cursor: pointer;
font-size: 14px;
margin-bottom: 15px;
width: 100%;
transition: all 0.3s;
}

.back-button:hover {
background: #4a4a4a;
}

.info-box {
background: rgba(52, 152, 219, 0.1);
border-left: 4px solid #3498DB;
padding: 10px;
margin-bottom: 12px;
border-radius: 4px;
font-size: 0.8em;
color: #fff;
}

.switch {
position: relative;
display: inline-block;
width: 50px;
height: 28px;
}

.switch input {
opacity: 0;
width: 0;
height: 0;
}

.switch .slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
border-radius: 28px;
}

.switch .slider:before {
position: absolute;
content: "";
height: 20px;
width: 20px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}

.switch input:checked + .slider {
background-color: #28a745;
}

.switch input:checked + .slider:before {
transform: translateX(22px);
}
</style></head><body><div class="container"><div class="header"><div class="header-top"><h1 onclick="showMain(); updateStatus();" title="–ù–∞ –≥–ª–∞–≤–Ω—É—é">üî• –ö–æ—Ç–µ–ª</h1><button class="menu-button" onclick="toggleMenu()" title="–ú–µ–Ω—é">‚ò∞</button></div><div class="dropdown-menu" id="dropdownMenu"><div class="dropdown-item" onclick="showSettings('auto')">‚öôÔ∏è –†–µ–∂–∏–º –ê–≤—Ç–æ</div><div class="dropdown-item" onclick="showSettings('comfort')">üè† –†–µ–∂–∏–º –ö–æ–º—Ñ–æ—Ä—Ç</div><div class="dropdown-item" onclick="showSettings('mqtt')">üì° MQTT</div><div class="dropdown-item" onclick="showSettings('wifi')">üì∂ WiFi</div><div class="dropdown-item" onclick="showSettings('sensors')">üå°Ô∏è –î–∞—Ç—á–∏–∫–∏</div><div class="dropdown-item" onclick="showSettings('ntp')">üïê NTP</div><div class="dropdown-item" onclick="showSettings('ml')">ü§ñ ML –û–±—É—á–µ–Ω–∏–µ</div><div class="dropdown-item" onclick="showSettings('relay')">‚ö° –†–µ–ª–µ</div><div class="dropdown-item" onclick="showSettings('update')">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è</div><div class="dropdown-item" onclick="showSettings('pins')">üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div><div class="dropdown-item" onclick="showSettings('system')">‚ÑπÔ∏è –°–∏—Å—Ç–µ–º–∞</div><div class="dropdown-item" onclick="showSettings('log')">üìã –ñ—É—Ä–Ω–∞–ª</div><div class="dropdown-item" onclick="showSettings('timers')">‚è±Ô∏è –¢–∞–π–º–µ—Ä—ã</div></div><div class="status-bar"><div class="status-indicator"><div class="status-dot" id="statusDot"></div><span class="state-display" id="stateDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div><div class="status-indicator"><span style="color: #aaa;">–°–∏—Å—Ç–µ–º–∞:</span><strong id="systemStatus">--</strong></div><div class="status-indicator"><span style="color: #aaa;">WiFi:</span><strong id="wifiStatus">--</strong><div id="wifiRSSIDisplay" style="margin-left: 6px; display: inline-flex; align-items: center; gap: 3px;"><div class="wifi-signal-bars" id="wifiSignalBars"></div><span class="wifi-rssi-text" id="wifiRSSIText" style="font-size: 0.85em; opacity: 0.9;"></span></div></div><div class="status-indicator"><span style="color: #aaa;">MQTT:</span><strong id="mqttStatus">--</strong></div></div></div><!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ --><div class="main-page" id="mainPage"><div class="overheat-warning" id="overheatWarning">
‚ö†Ô∏è –ü–ï–†–ï–ì–†–ï–í! –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
</div><!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ–≥–∞—Å–∞–Ω–∏–∏ –∫–æ—Ç–ª–∞ --><div class="overheat-warning" id="extinguishedWarning" style="display: none; background: #8B4513; border-color: #A0522D;">
üî• –ö–û–¢–ï–õ –ü–û–ì–ê–°! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥" –∏–ª–∏ –∫–Ω–æ–ø–∫—É —ç–Ω–∫–æ–¥–µ—Ä–∞
</div><!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–∑–∂–∏–≥–µ --><div class="info-box" id="ignitionInfo" style="display: none; background: rgba(52, 152, 219, 0.2); border-left-color: #3498DB;">
üî• –†–æ–∑–∂–∏–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...
</div><!-- –ö–Ω–æ–ø–∫–∞ —Ä–æ–∑–∂–∏–≥–∞ --><div style="text-align: center; margin: 10px 0;"><button id="ignitionButton" onclick="startIgnition()" style="display: none; background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); border: none; color: white; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: all 0.3s;">
üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥
</button></div><!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫—Ä—É–ø–Ω—ã–º–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º–∏ –ø–æ–¥–∞—á–∏ –∏ –¥–æ–º–∞ —Ä—è–¥–æ–º --><div class="main-temps-container"><!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–∞—á–∏ --><div class="temp-card" id="supplyTempCard"><div class="temp-label" id="supplyTempLabel">–ü–æ–¥–∞—á–∞</div><div class="temp-value"><span id="supplyTempValue">--</span><span class="temp-unit">¬∞C</span><span class="temp-trend-arrow" id="supplyTempTrendArrow" style="display: none;"></span></div><div class="setpoint-section auto-only" style="margin-top: 4px; padding-top: 4px; border-top: 1px solid #3a3a3a;"><div class="setpoint-control-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 10px;"><button class="setpoint-btn" onclick="changeSetpoint(-1)" style="padding: 3px 10px; font-size: 12px;">-</button><div class="temp-value setpoint setpoint-value"><span id="setpointValue">60</span><span class="temp-unit">¬∞C</span></div><button class="setpoint-btn" onclick="changeSetpoint(1)" style="padding: 3px 10px; font-size: 12px;">+</button></div></div></div><!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–º–∞ --><div class="temp-card" id="homeTempCard"><div class="temp-label" id="homeTempLabel">–î–æ–º</div><div class="temp-value"><span id="homeTempValue">--</span><span id="homeTempUnit" class="temp-unit">¬∞C</span><span class="temp-trend-arrow" id="homeTempTrendArrow" style="display: none;"></span><span id="homeTempStatus" style="display: none; font-size: 0.6em; color: #ffaa00; margin-left: 4px;">offline</span></div><div class="setpoint-section comfort-only" id="homeSetpointSection" style="margin-top: 4px; padding-top: 4px; border-top: 1px solid #3a3a3a;"><div class="setpoint-control-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 10px;"><button class="setpoint-btn" id="homeSetpointMinus" onclick="changeSetpoint(-0.5)" style="padding: 3px 10px; font-size: 12px;">-</button><div class="temp-value setpoint setpoint-value"><span id="homeSetpointValue">24.0</span><span class="temp-unit">¬∞C</span></div><button class="setpoint-btn" id="homeSetpointPlus" onclick="changeSetpoint(0.5)" style="padding: 3px 10px; font-size: 12px;">+</button></div></div></div></div><div class="temperature-display"><div class="temp-card"><div class="temp-label">–û–±—Ä–∞—Ç–∫–∞</div><div class="temp-value"><span id="returnTemp">--</span><span class="temp-unit">¬∞C</span><span class="temp-trend-arrow" id="returnTrendArrow" style="display: none;"></span><span id="lowReturnTempWarning" style="display: none; color: #F39C12; font-size: 0.8em; margin-left: 4px;" title="–ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–±—Ä–∞—Ç–∫–∏">‚ö†</span></div></div><div class="temp-card sensor-card"><div class="temp-label">–ö–æ—Ç–µ–ª—å–Ω–∞—è</div><div class="temp-value"><span id="boilerTemp">--</span><span class="temp-unit">¬∞C</span><span class="temp-trend-arrow" id="boilerTrendArrow" style="display: none;"></span></div></div></div><div class="temperature-display"><div class="temp-card sensor-card"><div class="temp-label">–£–ª–∏—Ü–∞</div><div class="temp-value"><span id="outdoorTemp">--</span><span class="temp-unit">¬∞C</span><span class="temp-trend-arrow" id="outdoorTrendArrow" style="display: none;"></span></div></div><!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã --><div class="temp-card sensor-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 12px;"><div class="temp-label" style="margin-bottom: 8px;">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</div><div style="display: flex; align-items: center; justify-content: center; gap: 8px;"><label class="switch" style="width: 50px; height: 24px; margin: 0;"><input type="checkbox" id="workModeSwitch" onchange="toggleWorkMode()"><span class="slider" style="height: 24px;"></span></label><span id="workModeLabel" style="font-size: 0.9em; min-width: 60px; text-align: center; font-weight: 600;">–ê–≤—Ç–æ</span></div><div id="systemModeText" style="font-size: 0.7em; color: #666; margin-top: 6px; opacity: 0.7;">–†–µ–∂–∏–º: --</div></div></div><!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ --><div style="background: #2a2a2a; border-radius: 12px; padding: 12px; margin: 6px 0; font-size: 0.85em;"><div style="font-weight: bold; margin-bottom: 8px; color: #ff6b35;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞</div><div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;"><div style="text-align: center;"><div style="color: #aaa; font-size: 0.8em;">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç—ã</div><div style="font-weight: bold; color: #fff;" id="fanStatsTotal">--</div></div><div style="text-align: center;"><div style="color: #aaa; font-size: 0.8em;">–ó–∞ —Å–µ–≥–æ–¥–Ω—è</div><div style="font-weight: bold; color: #fff;" id="fanStatsDaily">--</div></div><div style="text-align: center;"><div style="color: #aaa; font-size: 0.8em;">–¶–∏–∫–ª–æ–≤</div><div style="font-weight: bold; color: #fff;" id="fanStatsCycles">--</div></div></div></div><!-- –°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ --><div style="background: #2a2a2a; border-radius: 12px; padding: 8px; margin: 6px 0; display: flex; justify-content: space-around; font-size: 0.85em;"><div style="text-align: center;"><div style="color: #aaa; font-size: 0.9em;">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä</div><div id="fanStatusText" style="font-weight: 600; color: #888;">–í–´–ö–õ</div></div><div style="text-align: center;"><div style="color: #aaa; font-size: 0.9em;">–ù–∞—Å–æ—Å</div><div id="pumpStatusText" style="font-weight: 600; color: #888;">–í–´–ö–õ</div></div></div><!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞, –ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è –∏ –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è --><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 8px 0;"><!-- –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª/–≤—ã–∫–ª --><div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–°–∏—Å—Ç–µ–º–∞</div><label style="display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;"><label class="switch" style="transform: scale(0.8);"><input type="checkbox" id="systemEnabled" onchange="toggleSystem()"><span class="slider"></span></label><span id="systemStatusText" style="font-size: 0.85em; font-weight: 600;">–í–ö–õ</span></label></div><!-- –ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è --><div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è</div><button id="coalFeedingButton" onclick="toggleCoalFeeding()" style="width: 100%; padding: 8px; font-size: 0.85em; font-weight: 600; background: #1a1a1a; color: #888; border: 1px solid #3a3a3a; border-radius: 8px; cursor: pointer;"><span id="coalFeedingButtonText">üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å</span></button><div id="coalFeedingTimer" style="margin-top: 6px; font-size: 0.75em; font-weight: 600; color: #666; display: none;"><span id="coalFeedingTime">00:00</span></div></div></div><!-- –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –†–æ–∑–∂–∏–≥ --><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 8px 0;"><!-- –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è --><div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è</div><button id="resetStateButton" onclick="resetSystemState()" style="width: 100%; padding: 8px; font-size: 0.85em; font-weight: 600; background: #1a1a1a; color: #ff9800; border: 1px solid #ff9800; border-radius: 8px; cursor: pointer;"><span id="resetStateButtonText">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</span></button><div style="margin-top: 6px; font-size: 0.7em; color: #666; line-height: 1.2;">
–°–±—Ä–æ—Å: –ø–æ–≥–∞—Å, –æ—à–∏–±–∫–∞ —Ä–æ–∑–∂–∏–≥–∞
</div></div><!-- –†–æ–∑–∂–∏–≥ –∫–æ—Ç–ª–∞ --><div style="background: #2a2a2a; border-radius: 12px; padding: 12px; text-align: center;"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 8px;">–†–æ–∑–∂–∏–≥ –∫–æ—Ç–ª–∞</div><button id="ignitionButton" onclick="startIgnition()" style="width: 100%; padding: 8px; font-size: 0.85em; font-weight: 600; background: #1a1a1a; color: #ff6b35; border: 1px solid #ff6b35; border-radius: 8px; cursor: pointer;"><span id="ignitionButtonText">üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥</span></button><div id="ignitionStatus" style="margin-top: 6px; font-size: 0.75em; font-weight: 600; color: #888; display: none;"><span id="ignitionTime">--:--</span></div></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ê–≤—Ç–æ --><div id="settingsAuto" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="settings-group"><h3>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–ª–∞</h3><div class="setting-item"><label>–£—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="autoSetpoint" min="40" max="80" value="60" step="1"></div><div class="setting-item"><label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="autoMinTemp" min="40" max="80" value="45" step="1"></div><div class="setting-item"><label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="autoMaxTemp" min="40" max="80" value="75" step="1"></div><div class="setting-item"><label>–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (¬∞C)</label><input type="number" id="autoHysteresis" min="0.5" max="5" value="2" step="0.5"></div></div><div class="settings-group"><h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–µ—Ä—Ü–∏–∏</h3><div class="setting-item"><label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∏–Ω–µ—Ä—Ü–∏–∏ (¬∞C)</label><input type="number" id="autoInertiaTemp" min="40" max="80" value="55" step="1"></div><div class="setting-item"><label>–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏–Ω–µ—Ä—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)</label><input type="number" id="autoInertiaTime" min="5" max="30" value="10" step="1"></div></div><div class="settings-group"><h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3><div class="setting-item"><label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞ (¬∞C)</label><input type="number" id="autoOverheatTemp" min="70" max="85" value="77" step="1"></div><div class="setting-item"><label>–¢–∞–π–º–∞—É—Ç —Ä–∞–∑–æ–≥—Ä–µ–≤–∞ (–º–∏–Ω—É—Ç—ã)</label><input type="number" id="autoHeatingTimeout" min="10" max="60" value="30" step="1"></div></div><div class="btn-group"><button class="btn btn-primary" onclick="saveAutoSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadAutoSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: MQTT --><div id="settingsMqtt" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –±—Ä–æ–∫–µ—Ä–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
</div><div class="settings-group"><h3>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3><div class="setting-item"><label>–í–∫–ª—é—á–∏—Ç—å MQTT</label><label class="switch"><input type="checkbox" id="mqttEnabled"><span class="slider"></span></label></div><div class="setting-item"><label>–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞</label><label class="switch"><input type="checkbox" id="mqttSystemEnabled"><span class="slider"></span></label></div><div class="setting-item"><label>–ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞</label><input type="text" id="mqttServer" placeholder="m5.wqtt.ru"></div><div class="setting-item"><label>–ü–æ—Ä—Ç</label><select id="mqttPort"><option value="1883">1883 (–æ–±—ã—á–Ω—ã–π)</option><option value="8883">8883 (TLS)</option><option value="5374">5374 (WQTT –æ–±—ã—á–Ω—ã–π)</option><option value="5375">5375 (WQTT TLS)</option><option value="5377">5377 (WQTT WebSocket TLS)</option></select></div><div class="setting-item"><label>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS</label><label class="switch"><input type="checkbox" id="mqttUseTLS"><span class="slider"></span></label></div></div><div class="settings-group"><h3>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3><div class="setting-item"><label>–õ–æ–≥–∏–Ω</label><input type="text" id="mqttUser" placeholder="u_OLTTB0"></div><div class="setting-item"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="mqttPassword" placeholder="–ü–∞—Ä–æ–ª—å"></div></div><div class="settings-group"><h3>–¢–æ–ø–∏–∫–∏</h3><div class="setting-item"><label>–ü—Ä–µ—Ñ–∏–∫—Å —Ç–æ–ø–∏–∫–æ–≤</label><input type="text" id="mqttPrefix" placeholder="kotel/device1"></div><div class="info-box" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; margin-top: 15px;"><h4 style="margin-top: 0; margin-bottom: 10px; color: var(--text-color);">üì° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–ø–∏–∫–∞—Ö (–∫–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è):</h4><div style="font-size: 0.9em; line-height: 1.6;"><div style="margin-bottom: 8px;"><strong>üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è (–ø—É–±–ª–∏–∫—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ):</strong><br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicTemp" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/temp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicReturnTemp" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/returnTemp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–±—Ä–∞—Ç–∫–∏<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicBoilerTemp" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/boilerTemp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–µ–ª—å–Ω–æ–π<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicOutdoorTemp" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/outdoorTemp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É–ª–∏—Ü—ã<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicHomeTemp" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/homeTemp</code> - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ–º–∞<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicEnabled" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/enabled</code> - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicSetpoint" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/simple/setpoint</code> - —Ç–µ–∫—É—â–∞—è —É—Å—Ç–∞–≤–∫–∞<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicState" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/state</code> - –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (JSON)<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicCoalFeeding" style="color: #3498DB; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/coalFeeding</code> - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
</div><div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);"><strong>üì• –ü–æ–¥–ø–∏—Å–∫–∞ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã):</strong><br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicSetpointSet" style="color: #27AE60; font-weight: bold; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/setpoint/set</code> - <strong>–∏–∑–º–µ–Ω–∏—Ç—å —É—Å—Ç–∞–≤–∫—É</strong><br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicSensorsReset" style="color: #27AE60; font-weight: bold; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/sensors/reset</code> - <strong>—Å–±—Ä–æ—Å –¥–∞—Ç—á–∏–∫–æ–≤</strong> (1/on/reset - —Å–±—Ä–æ—Å, 0/off - –≤—ã–∫–ª—é—á–∏—Ç—å)<br>
‚Ä¢ <code class="mqtt-topic" id="mqttTopicIgnitionStart" style="color: #27AE60; font-weight: bold; cursor: pointer; text-decoration: underline;" title="–ö–ª–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">{prefix}/ignition/start</code> - <strong>–∑–∞–ø—É—Å–∫ —Ä–æ–∑–∂–∏–≥–∞</strong> (1/on/start - –∑–∞–ø—É—Å—Ç–∏—Ç—å)<br><small style="display: block; margin-top: 5px; opacity: 0.8;">
–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ç–æ–ø–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
</small></div></div></div></div><div class="settings-group"><h3>–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä (—Å–µ–∫—É–Ω–¥—ã)</label><input type="number" id="mqttTempInterval" min="5" max="60" value="10" step="1"></div><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)</label><input type="number" id="mqttStateInterval" min="10" max="120" value="30" step="5"></div></div><div class="btn-group"><button class="btn btn-primary" onclick="saveMqttSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadMqttSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button><button class="btn btn-secondary" onclick="testMqttConnection()">üîå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: WiFi --><div id="settingsWifi" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è.
</div><div class="settings-group"><h3>–¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3><div class="setting-item"><label>SSID</label><input type="text" id="currentSSID" readonly style="background: #e9ecef; color: var(--text-color);"></div><div class="setting-item"><label>IP –∞–¥—Ä–µ—Å</label><input type="text" id="currentIP" readonly style="background: #e9ecef; color: var(--text-color);"></div><div class="setting-item"><label>RSSI</label><input type="text" id="currentRSSI" readonly style="background: #e9ecef; color: var(--text-color);"></div><div class="setting-item"><label>MAC –∞–¥—Ä–µ—Å</label><input type="text" id="currentMAC" readonly style="background: #e9ecef; color: var(--text-color);"></div></div><div class="settings-group"><h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi</h3><div class="setting-item"><label>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω—Ç–µ–Ω–Ω—ã</label><div style="display: flex; align-items: center; gap: 15px;"><label class="switch"><input type="checkbox" id="antennaTuning" onchange="toggleAntennaTuning()"><span class="slider"></span></label><div id="antennaSignalInfo" style="display: none; padding: 8px 15px; background: rgba(46, 204, 113, 0.1); border-radius: 8px; border: 1px solid rgba(46, 204, 113, 0.3);"><span style="font-weight: bold; color: var(--text-color);">
–°–∏–≥–Ω–∞–ª: <span id="signalPercentage">0</span>%
(<span id="signalRSSI">0</span> dBm)
</span></div></div></div><div class="info-box" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB;"><strong>–û—Å–Ω–æ–≤–Ω–æ–π WiFi (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1):</strong> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, –¥–∞–∂–µ –ø—Ä–∏ —Å–ª–∞–±–æ–º —Å–∏–≥–Ω–∞–ª–µ. –î–æ 30 —Å–µ–∫—É–Ω–¥ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
</div><div class="setting-item"><label>SSID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi</label><div style="display: flex; gap: 10px; align-items: center;"><select id="primarySSIDSelect" onchange="selectPrimarySSID()" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color) !important;"><option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option></select><input type="text" id="primarySSID" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é" style="flex: 1; color: var(--text-color) !important;"></div></div><div class="setting-item"><label>–ü–∞—Ä–æ–ª—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi</label><input type="password" id="primaryPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="color: var(--text-color) !important;"></div><div class="info-box" style="background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; margin-top: 15px;"><strong>–†–µ–∑–µ—Ä–≤–Ω—ã–π WiFi (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2):</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π WiFi –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
</div><div class="setting-item"><label>SSID —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi</label><div style="display: flex; gap: 10px; align-items: center;"><select id="backupSSIDSelect" onchange="selectBackupSSID()" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color) !important;"><option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option></select><input type="text" id="backupSSID" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é" style="flex: 1; color: var(--text-color) !important;"></div></div><div class="setting-item"><label>–ü–∞—Ä–æ–ª—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi</label><input type="password" id="backupPassword" placeholder="–ü–∞—Ä–æ–ª—å" style="color: var(--text-color) !important;"></div><div class="btn-group" style="margin-top: 15px;"><button class="btn btn-primary" onclick="saveWiFiSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button><button class="btn btn-secondary" onclick="loadWiFiSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><div class="settings-group"><h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ WiFi —Å–µ—Ç–µ–π</h3><div class="info-box">
–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö WiFi —Å–µ—Ç–µ–π. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.
</div><button class="btn btn-primary" onclick="scanWiFiNetworks()" id="scanWiFiButton">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏</button><div id="wifiScanResults" style="margin-top: 15px; display: none;"><h4 style="margin-bottom: 10px; color: var(--text-color);">–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏:</h4><div id="wifiNetworksList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; background: var(--card-bg);"></div></div></div><div class="settings-group"><h3>–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ WiFi</h3><div class="info-box">
–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi.
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ "KotelAP" –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
</div><button class="btn btn-secondary" onclick="resetWiFi()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å WiFi</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –î–∞—Ç—á–∏–∫–∏ --><div id="settingsSensors" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã DS18B20 –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º—ã.
</div><div class="settings-group"><h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏</h3><div id="sensorList"></div><button class="btn btn-primary" onclick="scanSensors()">üîç –ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—á–∏–∫–∏</button></div><div class="settings-group"><h3>–ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤</h3><div class="setting-item"><label>–ü–æ–¥–∞—á–∞</label><select id="sensorSupply"></select></div><div class="setting-item"><label>–û–±—Ä–∞—Ç–∫–∞</label><select id="sensorReturn"></select></div><div class="setting-item"><label>–ö–æ—Ç–µ–ª—å–Ω–∞—è</label><select id="sensorBoiler"></select></div><div class="setting-item"><label>–£–ª–∏—Ü–∞</label><select id="sensorOutside"></select></div></div><div class="btn-group"><button class="btn btn-primary" onclick="saveSensorMapping()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadSensorMapping()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–Ω–æ–≤ --><div id="settingsPins" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∫ ESP32
</div><div class="settings-group"><h3>üîå –†–µ–ª–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3><div style="padding: 12px; background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; border-radius: 4px; margin-bottom: 10px;"><div style="font-weight: 600; margin-bottom: 8px;">GPIO 16 ‚Üí –†–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞</div><div style="font-weight: 600; margin-bottom: 8px;">GPIO 17 ‚Üí –†–µ–ª–µ –Ω–∞—Å–æ—Å–∞</div><div style="font-size: 0.85em; opacity: 0.9;">–†–µ–ª–µ —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä –∏–ª–∏ –º–æ–¥—É–ª—å —Ä–µ–ª–µ. –ü—Ä–∏ HIGH —Ä–µ–ª–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è.</div></div></div><div class="settings-group"><h3>üì∫ OLED –¥–∏—Å–ø–ª–µ–π (SSD1306 128x64, I2C)</h3><div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-bottom: 10px;"><div style="font-weight: 600; margin-bottom: 8px;">GPIO 21 ‚Üí SDA (I2C Data)</div><div style="font-weight: 600; margin-bottom: 8px;">GPIO 22 ‚Üí SCL (I2C Clock)</div><div style="font-size: 0.85em; opacity: 0.9;">VCC ‚Üí 3.3V –∏–ª–∏ 5V | GND ‚Üí GND</div><div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">–ê–¥—Ä–µ—Å I2C: 0x3C</div></div></div><div class="settings-group"><h3>üå°Ô∏è –î–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã DS18B20</h3><div style="padding: 12px; background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ECC71; border-radius: 4px; margin-bottom: 10px;"><div style="font-weight: 600; margin-bottom: 8px; color: #2ECC71;">–®–∏–Ω–∞ 1 (GPIO 4):</div><div style="font-weight: 600; margin-bottom: 5px;">GPIO 4 ‚Üí Data</div><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 8px;">–ß–µ—Ä–µ–∑ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –∫ VCC</div><div style="font-size: 0.9em; font-weight: 600; margin-top: 8px;">–î–∞—Ç—á–∏–∫–∏:</div><div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –ü–æ–¥–∞—á–∞ (–≤—ã—Ö–æ–¥ –∫–æ—Ç–ª–∞)</div><div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –û–±—Ä–∞—Ç–∫–∞ (–≤—Ö–æ–¥ –∫–æ—Ç–ª–∞)</div></div><div style="padding: 12px; background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ECC71; border-radius: 4px; margin-bottom: 10px;"><div style="font-weight: 600; margin-bottom: 8px; color: #2ECC71;">–®–∏–Ω–∞ 2 (GPIO 5):</div><div style="font-weight: 600; margin-bottom: 5px;">GPIO 5 ‚Üí Data</div><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 8px;">–ß–µ—Ä–µ–∑ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –∫ VCC</div><div style="font-size: 0.9em; font-weight: 600; margin-top: 8px;">–î–∞—Ç—á–∏–∫–∏:</div><div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –ö–æ—Ç–µ–ª—å–Ω–∞—è</div><div style="font-size: 0.85em; opacity: 0.9;">‚Ä¢ –£–ª–∏—Ü–∞</div></div><div style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-left: 4px solid #E74C3C; border-radius: 4px; margin-top: 10px;"><div style="font-size: 0.9em; font-weight: 600; margin-bottom: 5px; color: #E74C3C;">–†–µ–ª–µ –ø–∏—Ç–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ (GPIO 25):</div><div style="font-size: 0.85em; opacity: 0.9;">–í—Å–µ –¥–∞—Ç—á–∏–∫–∏ DS18B20 –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –ø–∏—Ç–∞–Ω–∏—é —á–µ—Ä–µ–∑ —Ä–µ–ª–µ –Ω–∞ GPIO 25.</div><div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">–ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–ª–µ –ø–∏—Ç–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤.</div></div><div style="padding: 10px; background: rgba(241, 196, 15, 0.1); border-left: 4px solid #F1C40F; border-radius: 4px; margin-top: 10px;"><div style="font-size: 0.85em; font-weight: 600;">‚ö†Ô∏è –í–∞–∂–Ω–æ:</div><div style="font-size: 0.85em; opacity: 0.9;">–ö–∞–∂–¥—ã–π –¥–∞—Ç—á–∏–∫ DS18B20 —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—â–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –º–µ–∂–¥—É Data –∏ VCC</div></div></div><div class="settings-group"><h3>üîÑ –≠–Ω–∫–æ–¥–µ—Ä (—Ä–æ—Ç–æ—Ä–Ω—ã–π —Å –∫–Ω–æ–ø–∫–æ–π)</h3><div style="padding: 12px; background: rgba(155, 89, 182, 0.1); border-left: 4px solid #9B59B6; border-radius: 4px; margin-bottom: 10px;"><div style="font-weight: 600; margin-bottom: 8px;">GPIO 18 ‚Üí CLK (Clock)</div><div style="font-weight: 600; margin-bottom: 8px;">GPIO 19 ‚Üí DT (Data)</div><div style="font-weight: 600; margin-bottom: 8px;">GPIO 23 ‚Üí SW (Switch/Button)</div><div style="font-size: 0.85em; opacity: 0.9; margin-top: 8px;">VCC ‚Üí 3.3V –∏–ª–∏ 5V | GND ‚Üí GND</div><div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">–ü–∏–Ω—ã —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–æ–¥—Ç—è–∂–∫–æ–π (INPUT_PULLUP)</div></div></div><div class="settings-group"><h3>‚ö° –ü–∏—Ç–∞–Ω–∏–µ</h3><div style="padding: 12px; background: rgba(231, 76, 60, 0.1); border-left: 4px solid #E74C3C; border-radius: 4px;"><div style="font-size: 0.9em; margin-bottom: 5px;"><strong>ESP32:</strong> USB –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ 5V</div><div style="font-size: 0.9em; margin-bottom: 5px;"><strong>OLED:</strong> 3.3V –∏–ª–∏ 5V (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥—É–ª—å)</div><div style="font-size: 0.9em; margin-bottom: 5px;"><strong>DS18B20:</strong> 3.3V –∏–ª–∏ 5V</div><div style="font-size: 0.9em; margin-bottom: 5px;"><strong>–≠–Ω–∫–æ–¥–µ—Ä:</strong> 3.3V –∏–ª–∏ 5V</div><div style="font-size: 0.9em;"><strong>–ú–æ–¥—É–ª–∏ —Ä–µ–ª–µ:</strong> 5V –¥–ª—è —Ä–µ–ª–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3.3V</div></div></div><div class="settings-group"><h3>üìã –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3><div style="padding: 15px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; font-family: monospace; font-size: 0.85em; overflow-x: auto;"><div style="margin-bottom: 8px;"><strong>ESP32</strong><strong>–í–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</strong></div><div style="margin-bottom: 5px;">GPIO 16 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –†–µ–ª–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞</div><div style="margin-bottom: 5px;">GPIO 17 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –†–µ–ª–µ –Ω–∞—Å–æ—Å–∞</div><div style="margin-bottom: 5px;">GPIO 21 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OLED SDA</div><div style="margin-bottom: 5px;">GPIO 22 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OLED SCL</div><div style="margin-bottom: 5px;">GPIO 4 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> DS18B20 —à–∏–Ω–∞ 1</div><div style="margin-bottom: 5px;">GPIO 5 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> DS18B20 —à–∏–Ω–∞ 2</div><div style="margin-bottom: 5px;">GPIO 18 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä CLK</div><div style="margin-bottom: 5px;">GPIO 19 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä DT</div><div style="margin-bottom: 5px;">GPIO 23 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –≠–Ω–∫–æ–¥–µ—Ä SW</div><div style="margin-bottom: 5px;">3.3V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –ü–∏—Ç–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π</div><div>GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –û–±—â–∏–π GND</div></div></div><div class="settings-group"><h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3><div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px;"><div style="font-size: 0.9em; margin-bottom: 8px;">1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –¥–ª—è –∫–∞–∂–¥–æ–π —à–∏–Ω—ã DS18B20</div><div style="font-size: 0.9em; margin-bottom: 8px;">2. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∞ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–∞—Ç—á–∏–∫–æ–≤</div><div style="font-size: 0.9em; margin-bottom: 8px;">3. –ú–æ–¥—É–ª–∏ —Ä–µ–ª–µ —Å –æ–ø—Ç–æ–∏–∑–æ–ª—è—Ü–∏–µ–π –¥–ª—è –∑–∞—â–∏—Ç—ã ESP32</div><div style="font-size: 0.9em; margin-bottom: 8px;">4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Ç–æ–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è</div><div style="font-size: 0.9em;">5. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–±—â–∏–π GND</div></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: NTP --><div id="settingsNtp" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å NTP —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
</div><div class="settings-group"><h3>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</h3><div class="setting-item"><label>–í—Ä–µ–º—è (NTP)</label><input type="text" id="ntpCurrentTime" readonly style="background: #e9ecef; color: var(--text-color);"></div><div class="setting-item"><label>–î–∞—Ç–∞ (NTP)</label><input type="text" id="ntpCurrentDate" readonly style="background: #e9ecef; color: var(--text-color);"></div><div class="setting-item"><label>–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</label><input type="text" id="ntpSyncStatus" readonly style="background: #e9ecef; color: var(--text-color);"></div></div><div class="settings-group"><h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP</h3><div class="setting-item"><label>–í–∫–ª—é—á–∏—Ç—å NTP</label><label class="switch"><input type="checkbox" id="ntpEnabled"><span class="slider"></span></label></div><div class="setting-item"><label>NTP —Å–µ—Ä–≤–µ—Ä</label><input type="text" id="ntpServer" placeholder="ru.pool.ntp.org" style="color: var(--text-color);"><small style="display: block; margin-top: 5px; opacity: 0.8;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ: ru.pool.ntp.org, pool.ntp.org, time.google.com</small></div><div class="setting-item"><label>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (UTC)</label><input type="number" id="ntpTimezone" min="-12" max="14" value="3" step="1" style="color: var(--text-color) !important;"><small style="display: block; margin-top: 5px; opacity: 0.8;">–ú–æ—Å–∫–≤–∞: +3, –ö–∏–µ–≤: +2, –ú–∏–Ω—Å–∫: +3, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥: +5</small></div><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—á–∞—Å—ã)</label><input type="number" id="ntpUpdateInterval" min="1" max="24" value="1" step="1" style="color: var(--text-color) !important;"><small style="display: block; margin-top: 5px; opacity: 0.8;">–ö–∞–∫ —á–∞—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</small></div><div class="btn-group"><button class="btn btn-primary" onclick="saveNTPSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadNTPSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ML –û–±—É—á–µ–Ω–∏–µ --><div id="settingsMl" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏. –î–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ <strong>{prefix}/ml/data</strong>.
</div><div class="settings-group"><h3>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML</h3><div class="setting-item"><label>–í–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é ML –¥–∞–Ω–Ω—ã—Ö</label><label class="switch"><input type="checkbox" id="mlEnabled"><span class="slider"></span></label></div><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—Å–µ–∫—É–Ω–¥—ã)</label><input type="number" id="mlPublishInterval" min="5" max="300" value="10" step="1" style="color: var(--text-color) !important;"><small style="display: block; margin-top: 5px; opacity: 0.8;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 5-30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏</small></div><div class="btn-group"><button class="btn btn-primary" onclick="saveMLSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadMLSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><div class="settings-group"><h3>üìä –ü—É–±–ª–∏–∫—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ</h3><div style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px;"><div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã:</strong> supplyTemp, returnTemp, boilerTemp, outdoorTemp, homeTemp, tempDiff</div><div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–°–æ—Å—Ç–æ—è–Ω–∏—è:</strong> fan, pump, systemEnabled, state, coalFeedingActive</div><div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Auto:</strong> setpoint, minTemp, maxTemp, hysteresis, inertiaTemp, inertiaTime, overheatTemp, heatingTimeout</div><div style="font-size: 0.9em; margin-bottom: 8px;"><strong>–í—Ä–µ–º—è:</strong> timestamp, uptime, time, date</div><div style="font-size: 0.9em; margin-bottom: 8px;"><strong>WiFi:</strong> wifiRSSI, wifiSSID, wifiIP</div><div style="font-size: 0.9em;"><strong>–°–∏—Å—Ç–µ–º–∞:</strong> freeMem, heapSize, sensorCount, mqttConnected, mlPublishInterval</div></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –†–µ–ª–µ --><div id="settingsRelay" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è.
</div><div class="settings-group"><h3>‚ö° –õ–æ–≥–∏–∫–∞ —Ä–µ–ª–µ</h3><div class="setting-item"><label>–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä: –í—ã–∫–ª—é—á–µ–Ω–æ = LOW</label><label class="switch"><input type="checkbox" id="fanOffIsLow" checked><span class="slider"></span></label><small style="display: block; margin-top: 5px; opacity: 0.8;">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ, —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –¥–ª—è HIGH</small></div><div class="setting-item"><label>–ù–∞—Å–æ—Å: –í—ã–∫–ª—é—á–µ–Ω–æ = LOW</label><label class="switch"><input type="checkbox" id="pumpOffIsLow" checked><span class="slider"></span></label><small style="display: block; margin-top: 5px; opacity: 0.8;">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ, —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –¥–ª—è HIGH</small></div><div class="setting-item"><label>–î–∞—Ç—á–∏–∫–∏ DS18B20: –í—ã–∫–ª—é—á–µ–Ω–æ = LOW</label><label class="switch"><input type="checkbox" id="sensorsOffIsLow" checked><span class="slider"></span></label><small style="display: block; margin-top: 5px; opacity: 0.8;">–û–±—Ä–∞—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞. –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ, —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –¥–ª—è HIGH</small></div><div class="btn-group"><button class="btn btn-primary" onclick="saveRelaySettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadRelaySettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><div class="settings-group"><h3>üîß –ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3><div id="manualControlStatus" style="padding: 12px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-bottom: 15px;"><div style="font-size: 0.9em;">–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <strong id="manualControlState">–ù–µ –∞–∫—Ç–∏–≤–Ω–æ</strong></div><div style="font-size: 0.9em; margin-top: 5px;">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <strong id="manualControlRemaining">--</strong> —Å–µ–∫</div></div><div class="setting-item"><label>–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä</label><div style="display: flex; gap: 10px;"><button class="btn btn-success" onclick="controlRelay('fan', true, true)" style="flex: 1;">–í–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button><button class="btn btn-danger" onclick="controlRelay('fan', false, true)" style="flex: 1;">–í–´–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button></div></div><div class="setting-item"><label>–ù–∞—Å–æ—Å</label><div style="display: flex; gap: 10px;"><button class="btn btn-success" onclick="controlRelay('pump', true, true)" style="flex: 1;">–í–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button><button class="btn btn-danger" onclick="controlRelay('pump', false, true)" style="flex: 1;">–í–´–ö–õ (–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ)</button></div></div><div class="setting-item"><label>–†–µ–ª–µ –ø–∏—Ç–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ DS18B20</label><div style="display: flex; gap: 10px;"><button class="btn btn-success" onclick="controlRelay('sensors', true, false)" style="flex: 1;">–í–ö–õ</button><button class="btn btn-danger" onclick="controlRelay('sensors', false, false)" style="flex: 1;">–í–´–ö–õ (–°–±—Ä–æ—Å)</button></div><small style="display: block; margin-top: 5px; opacity: 0.8;">–í—ã–∫–ª—é—á–µ–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ –æ—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤</small></div><div style="padding: 10px; background: rgba(243, 156, 18, 0.1); border-left: 4px solid #F39C12; border-radius: 4px; margin-top: 10px;"><div style="font-size: 0.85em; opacity: 0.9;"><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º. –ß–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–µ.
</div></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –†–µ–∂–∏–º –ö–æ–º—Ñ–æ—Ä—Ç --><div id="settingsComfort" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="info-box">
–†–µ–∂–∏–º "–ö–æ–º—Ñ–æ—Ä—Ç" —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ—Ç–ª–æ–º –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –≤ –¥–æ–º–µ. –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –¥–æ–º–∞ —á–µ—Ä–µ–∑ MQTT.
</div><div class="settings-group"><h3>üéØ –¶–µ–ª–µ–≤—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h3><div class="setting-item"><label>–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –¥–æ–º–µ (¬∞C)</label><input type="number" id="comfortTargetHomeTemp" min="20" max="28" step="0.5" placeholder="24.0"></div><div class="setting-item"><label>–î–æ–≥–æ–Ω –¥–æ (¬∞C) - –Ω–∞—á–∞–ª–æ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–¥–¥—É–≤–∞</label><input type="number" id="comfortCatchUpTemp" min="20" max="28" step="0.1" placeholder="23.5"></div></div><div class="settings-group"><h3>üå°Ô∏è –î–∏–∞–ø–∞–∑–æ–Ω —Ä–∞–±–æ—Ç—ã –∫–æ—Ç–ª–∞</h3><div class="setting-item"><label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="comfortMinBoilerTemp" min="40" max="80" step="1" placeholder="45"></div><div class="setting-item"><label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="comfortMaxBoilerTemp" min="40" max="80" step="1" placeholder="75"></div><div class="setting-item"><label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –æ–∂–∏–¥–∞–Ω–∏—è (¬∞C)</label><input type="number" id="comfortWaitTemp" min="50" max="80" step="1" placeholder="65"></div><div style="padding: 10px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-top: 10px;"><div style="font-size: 0.85em; opacity: 0.9;"><strong>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong><span id="comfortIntermediateTemp">60</span>¬∞C (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: (–º–∏–Ω+–º–∞–∫—Å)/2)
</div></div></div><div class="settings-group"><h3>‚è±Ô∏è –¢–∞–π–º–µ—Ä—ã (–º–∏–Ω—É—Ç—ã)</h3><div class="setting-item"><label>–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è</label><input type="number" id="comfortWaitCoolingTime" min="5" max="30" step="1" placeholder="10"></div><div class="setting-item"><label>–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–æ–≥—Ä–µ–≤–∞</label><input type="number" id="comfortWaitAfterHeating1Time" min="10" max="60" step="1" placeholder="20"></div><div class="setting-item"><label>–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–¥–¥—É–≤–∞</label><input type="number" id="comfortWaitAfterReductionTime" min="10" max="60" step="1" placeholder="25"></div><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–µ—Ä—Ü–∏–∏</label><input type="number" id="comfortInertiaCheckInterval" min="1" max="15" step="1" placeholder="5"></div></div><div class="settings-group"><h3>üìä –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å</h3><div class="setting-item"><label>–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –≤–∫–ª—é—á–µ–Ω–∏—è (¬∞C)</label><input type="number" id="comfortHysteresisOn" min="0.1" max="2.0" step="0.1" placeholder="0.5"></div><div class="setting-item"><label>–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –≤—ã–∫–ª—é—á–µ–Ω–∏—è (¬∞C)</label><input type="number" id="comfortHysteresisOff" min="0.1" max="2.0" step="0.1" placeholder="0.3"></div><div class="setting-item"><label>–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–ª–∞ (¬∞C)</label><input type="number" id="comfortHysteresisBoiler" min="0.5" max="5.0" step="0.5" placeholder="2.0"></div></div><div class="settings-group"><h3>‚ö†Ô∏è –ó–∞—â–∏—Ç–∞</h3><div class="setting-item"><label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (¬∞C)</label><input type="number" id="comfortWarningTemp" min="80" max="90" step="1" placeholder="85"></div></div><div class="btn-group"><button class="btn btn-primary" onclick="saveComfortSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-secondary" onclick="loadComfortSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è --><div id="settingsUpdate" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="settings-group"><h3>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ GitHub</h3><div class="setting-item"><label>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è</label><input type="text" id="currentVersion" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è</label><input type="text" id="latestVersion" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–°—Ç–∞—Ç—É—Å</label><div id="updateStatus" style="padding: 10px; border-radius: 6px; background: #3a3a3a; color: #fff;">
–ü—Ä–æ–≤–µ—Ä–∫–∞...
</div></div><div class="btn-group" style="margin-top: 15px;"><button class="btn btn-primary" onclick="checkForUpdates()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button><button class="btn btn-success" id="installUpdateBtn" onclick="installUpdate()" style="display: none;">‚¨áÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button></div><!-- –°—Ç–∞—Ä—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) --><div id="updateProgressContainer" style="display: none;"></div></div><div class="settings-group"><h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</h3><div class="setting-item"><label style="display: flex; align-items: center; gap: 10px;"><input type="checkbox" id="autoCheckEnabled" style="width: auto;"><span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</span></label></div><div class="setting-item"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (—á–∞—Å—ã)</label><input type="number" id="checkInterval" min="1" max="168" value="24" style="color: var(--text-color) !important;"></div><div class="btn-group" style="margin-top: 15px;"><button class="btn btn-primary" onclick="saveUpdateSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button><button class="btn btn-secondary" onclick="loadUpdateSettings()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button></div></div><div style="padding: 10px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-top: 15px;"><div style="font-size: 0.85em; opacity: 0.9;"><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub<br>
‚Ä¢ –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è<br>
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
</div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –°–∏—Å—Ç–µ–º–∞ --><div id="settingsSystem" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="settings-group"><h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3><div class="setting-item"><label>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏</label><input type="text" id="firmwareVersion" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>IP –∞–¥—Ä–µ—Å</label><input type="text" id="systemIP" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>MAC –∞–¥—Ä–µ—Å</label><input type="text" id="systemMAC" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</label><input type="text" id="systemUptime" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å</label><input type="text" id="systemFreeMem" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (NTP)</label><input type="text" id="systemTime" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div><div class="setting-item"><label>–î–∞—Ç–∞ (NTP)</label><input type="text" id="systemDate" readonly style="background: #e9ecef; color: var(--text-color) !important;"></div></div><div class="settings-group"><h3>OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h3><div class="setting-item"><label>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏</label><input type="file" id="otaFile" accept=".bin" style="margin-bottom: 10px;"><button class="btn btn-primary" onclick="uploadOTA()" id="otaUploadBtn">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É</button><div id="otaStatus" style="margin-top: 10px; font-size: 0.9em;"></div></div><div style="padding: 10px; background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498DB; border-radius: 4px; margin-top: 10px;"><div style="font-size: 0.85em; opacity: 0.9;"><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
1. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ—à–∏–≤–∫—É –≤ PlatformIO<br>
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .bin –∏–∑ –ø–∞–ø–∫–∏ .pio/build/esp32dev/<br>
3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É"<br>
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
</div></div></div><div class="btn-group"><button class="btn btn-secondary" onclick="rebootDevice()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞</button></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ñ—É—Ä–Ω–∞–ª --><div id="settingsLog" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="settings-group"><h3>üìã –ñ—É—Ä–Ω–∞–ª –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫</h3><div class="setting-item"><label>–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫</label><input type="text" id="currentBootCount" readonly style="background: #e9ecef; color: var(--text-color) !important; font-weight: bold;"></div><div class="btn-group" style="margin-top: 10px;"><button class="btn btn-primary" onclick="loadBootLog()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button><button class="btn btn-secondary" onclick="resetBootCount()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª</button></div></div><div class="settings-group"><h3>–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫</h3><div id="bootLogContainer" style="background: #2a2a2a; border-radius: 8px; padding: 15px; max-height: 60vh; overflow-y: auto;"><div style="text-align: center; color: #888; padding: 20px;">
–ó–∞–≥—Ä—É–∑–∫–∞ –∂—É—Ä–Ω–∞–ª–∞...
</div></div></div></div><!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –¢–∞–π–º–µ—Ä—ã --><div id="settingsTimers" class="settings-page"><button class="back-button" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥</button><div class="settings-group"><h3>‚è±Ô∏è –¢–∞–π–º–µ—Ä—ã —Å–∏—Å—Ç–µ–º—ã</h3><p style="color: #aaa; font-size: 0.9em; margin-bottom: 15px;">
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤ –¥–ª—è –ø—É—Å–∫–æ–Ω–∞–ª–∞–¥–∫–∏ –∫–æ—Ç–ª–∞
</p><div class="btn-group" style="margin-bottom: 15px;"><button class="btn btn-primary" onclick="loadTimers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button></div><div id="timersContainer" style="background: #2a2a2a; border-radius: 8px; padding: 15px; max-height: 70vh; overflow-y: auto;"><div style="text-align: center; color: #888; padding: 20px;">
–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤...
</div></div></div></div></div><script>
let updateInterval;

function toggleMenu() {
const menu = document.getElementById('dropdownMenu');
if (menu) {
menu.classList.toggle('show');
}
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', function(event) {
const menu = document.getElementById('dropdownMenu');
const button = document.querySelector('.menu-button');
if (menu && button) {
// –ï—Å–ª–∏ –∫–ª–∏–∫ –Ω–µ –ø–æ –º–µ–Ω—é –∏ –Ω–µ –ø–æ –∫–Ω–æ–ø–∫–µ - –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
if (!menu.contains(event.target) && event.target !== button && !button.contains(event.target)) {
menu.classList.remove('show');
}
}
});

function showMain() {
document.getElementById('mainPage').style.display = 'block';
document.querySelectorAll('.settings-page').forEach(page => page.classList.remove('active'));
document.getElementById('dropdownMenu').classList.remove('show');
}

function showSettings(type) {
document.getElementById('mainPage').style.display = 'none';
document.querySelectorAll('.settings-page').forEach(page => page.classList.remove('active'));
const pageId = 'settings' + type.charAt(0).toUpperCase() + type.slice(1);
const page = document.getElementById(pageId);
if (page) {
page.classList.add('active');
}
document.getElementById('dropdownMenu').classList.remove('show');

if (type === 'system') {
loadSystemInfo();
} else if (type === 'relay') {
loadRelaySettings();
} else if (type === 'wifi') {
loadWiFiInfo();
loadWiFiSettings();
// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ
if (antennaTuningInterval) {
clearInterval(antennaTuningInterval);
antennaTuningInterval = null;
}
// –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω—Ç–µ–Ω–Ω—ã –≤–∫–ª—é—á–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
if (document.getElementById('antennaTuning').checked) {
toggleAntennaTuning();
}
} else if (type === 'sensors') {
loadSensorMapping();
scanSensors();
} else if (type === 'mqtt') {
loadMqttSettings();
} else if (type === 'auto') {
loadAutoSettings();
} else if (type === 'ntp') {
loadNTPSettings();
updateNTPTime();
} else if (type === 'ml') {
// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏, –Ω–µ –≤ setInterval
loadMLSettings();
} else if (type === 'update') {
loadUpdateSettings();
checkForUpdates();
} else if (type === 'comfort') {
loadComfortSettings();
} else if (type === 'system') {
loadSystemInfo();
} else if (type === 'log') {
loadBootLog();
} else if (type === 'timers') {
loadTimers();
}
}

function changeSetpoint(delta) {
const setpointValueEl = document.getElementById('setpointValue');
if (!setpointValueEl) return;

const workModeSwitch = document.getElementById('workModeSwitch');
const isComfortMode = workModeSwitch && workModeSwitch.checked;

let newValue, minVal, maxVal, apiEndpoint, step, setpointEl;
if (isComfortMode) {
// –í —Ä–µ–∂–∏–º–µ –ö–æ–º—Ñ–æ—Ä—Ç –º–µ–Ω—è–µ–º targetHomeTemp (—à–∞–≥ 0.5)
setpointEl = document.getElementById('homeSetpointValue');
if (!setpointEl) return;
const current = parseFloat(setpointEl.textContent);
minVal = 20;
maxVal = 28;
step = 0.5;
apiEndpoint = '/api/settings/comfort';
newValue = Math.max(minVal, Math.min(maxVal, current + (delta * step)));
// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É
setpointEl.textContent = newValue.toFixed(1);
// –û–±–Ω–æ–≤–ª—è–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ç–æ–∂–µ
const comfortTargetEl = document.getElementById('comfortTargetHomeTemp');
if (comfortTargetEl) comfortTargetEl.value = newValue;
// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
fetch(apiEndpoint, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ targetHomeTemp: newValue })
})
.then(r => r.json())
.then(d => {
if (!d.success) {
// –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
setpointEl.textContent = current.toFixed(1);
if (comfortTargetEl) comfortTargetEl.value = current;
}
})
.catch(e => {
setpointEl.textContent = current.toFixed(1);
if (comfortTargetEl) comfortTargetEl.value = current;
});
} else {
// –í —Ä–µ–∂–∏–º–µ –ê–≤—Ç–æ –º–µ–Ω—è–µ–º setpoint (—à–∞–≥ 1)
setpointEl = document.getElementById('setpointValue');
if (!setpointEl) return;
const current = parseFloat(setpointEl.textContent);
minVal = 40;
maxVal = 80;
step = 1;
apiEndpoint = '/api/setpoint';
// –í —Ä–µ–∂–∏–º–µ –ê–≤—Ç–æ —à–∞–≥ –≤—Å–µ–≥–¥–∞ 1
newValue = Math.max(minVal, Math.min(maxVal, current + (delta * step)));
setpointEl.textContent = newValue.toFixed(0);

fetch(apiEndpoint + '?value=' + newValue, { method: 'POST' })
.then(r => r.json())
.then(d => {
if (!d.success) {
setpointEl.textContent = current.toFixed(0);
}
})
.catch(e => {
setpointEl.textContent = current.toFixed(0);
});
}
}

function toggleDevice(device) {
// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
const statusText = document.getElementById(device === 'fan' ? 'fanStatusText' : 'pumpStatusText');
if (!statusText) return;

const isActive = statusText.textContent === '–í–ö–õ';
const newState = !isActive;

// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
statusText.textContent = newState ? '–í–ö–õ' : '–í–´–ö–õ';
statusText.style.color = newState ? '#00ff00' : '#888';

fetch('/api/control?device=' + device + '&state=' + (newState ? 1 : 0), { method: 'POST' })
.then(r => r.json())
.then(d => )
.catch(e => );
}

function toggleSystem() {
const checkbox = document.getElementById('systemEnabled');
const enabled = checkbox.checked;

fetch('/api/system/enable?enabled=' + (enabled ? 1 : 0), { method: 'POST' })
.then(r => r.json())
.then(d => {
updateSystemStatus(enabled);
})
.catch(e => );
}

function updateSystemStatus(enabled) {
const statusText = document.getElementById('systemStatusText');
const statusBar = document.getElementById('systemStatus');
if (enabled) {
statusText.textContent = '–í–∫–ª—é—á–µ–Ω–∞';
statusText.style.color = '#28a745';
if (statusBar) statusBar.textContent = '–í–ö–õ';
} else {
statusText.textContent = '–í—ã–∫–ª—é—á–µ–Ω–∞';
statusText.style.color = '#dc3545';
if (statusBar) statusBar.textContent = '–í–´–ö–õ';
}
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —Ç—Ä–µ–Ω–¥–∞
function updateTrendArrow(elementId, trend) {
const arrow = document.getElementById(elementId);
if (!arrow) return;

if (trend === 1) {
// –†–æ—Å—Ç - –∑–µ–ª–µ–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
arrow.textContent = '‚Üë';
arrow.className = 'temp-trend-arrow up';
arrow.style.display = 'inline-block';
} else if (trend === -1) {
// –ü–∞–¥–µ–Ω–∏–µ - –∫—Ä–∞—Å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
arrow.textContent = '‚Üì';
arrow.className = 'temp-trend-arrow down';
arrow.style.display = 'inline-block';
} else {
// –°—Ç–∞–±–∏–ª—å–Ω–æ - —Å–∫—Ä—ã–≤–∞–µ–º
arrow.style.display = 'none';
}
}

function updateData() {
fetch('/api/status')
.then(r => {
if (!r.ok) {
throw new Error('HTTP error! status: ' + r.status);
}
return r.json();
})
.then(d => {
if (!d) {
return;
}

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
const isComfortMode = (d.workMode === 1);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ä–µ–∂–∏–º–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è)
const workModeSwitch = document.getElementById('workModeSwitch');
const workModeLabel = document.getElementById('workModeLabel');
const homeTempSensorValid = d.homeTempSensorValid !== undefined ? d.homeTempSensorValid : true;
const homeTempSensorLWTOnline = d.homeTempSensorLWTOnline !== undefined ? d.homeTempSensorLWTOnline : true;

if (workModeSwitch && workModeSwitch.checked !== (d.workMode === 1)) {
workModeSwitch.checked = (d.workMode === 1);
}

// –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º –ö–æ–º—Ñ–æ—Ä—Ç, –µ—Å–ª–∏ –¥–∞—Ç—á–∏–∫ offline
if (workModeSwitch) {
if (!homeTempSensorValid && !workModeSwitch.checked) {
// –î–∞—Ç—á–∏–∫ offline –∏ —Ä–µ–∂–∏–º –ê–≤—Ç–æ - –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ö–æ–º—Ñ–æ—Ä—Ç
workModeSwitch.disabled = true;
workModeSwitch.title = '–î–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–æ–º–∞ offline. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –ö–æ–º—Ñ–æ—Ä—Ç.';
} else {
workModeSwitch.disabled = false;
workModeSwitch.title = '';
}
}

if (workModeLabel) {
const newLabel = (d.workMode === 1) ? '–ö–æ–º—Ñ–æ—Ä—Ç' : '–ê–≤—Ç–æ';
if (workModeLabel.textContent !== newLabel) {
workModeLabel.textContent = newLabel;
}
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –¥–∞—Ç—á–∏–∫ offline –≤ —Ä–µ–∂–∏–º–µ –ö–æ–º—Ñ–æ—Ä—Ç
if (d.workMode === 1 && !homeTempSensorValid) {
workModeLabel.textContent = '–ö–æ–º—Ñ–æ—Ä—Ç (–¥–∞—Ç—á–∏–∫ offline)';
workModeLabel.style.color = '#ffaa00';
} else {
workModeLabel.style.color = '';
}
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–º body –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ —É—Å—Ç–∞–≤–æ–∫
if (isComfortMode) {
document.body.classList.remove('auto-mode');
document.body.classList.add('comfort-mode');
} else {
document.body.classList.remove('comfort-mode');
document.body.classList.add('auto-mode');
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–æ–¥–∞—á–∏
const supplyTempValue = document.getElementById('supplyTempValue');
if (supplyTempValue) {
const newValue = d.supplyTemp !== null ? d.supplyTemp.toFixed(1) : '--';
if (supplyTempValue.textContent !== newValue) {
supplyTempValue.textContent = newValue;
}
}
updateTrendArrow('supplyTempTrendArrow', d.supplyTrend);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–≤–∫–∏ –ø–æ–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –ê–≤—Ç–æ)
const setpointValue = document.getElementById('setpointValue');
if (setpointValue) {
const newSetpoint = d.setpoint !== null ? d.setpoint.toFixed(0) : '60';
if (setpointValue.textContent !== newSetpoint) {
setpointValue.textContent = newSetpoint;
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–æ–º–∞
const homeTempValue = document.getElementById('homeTempValue');
const homeTempUnit = document.getElementById('homeTempUnit');
const homeTempStatus = document.getElementById('homeTempStatus');
if (homeTempValue) {
if (!homeTempSensorLWTOnline) {
// –î–∞—Ç—á–∏–∫ offline –ø–æ LWT - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "offline" —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º –±–µ–∑ –∑–Ω–∞—á–∫–∞ —Ü–µ–ª—å—Å–∏–π
homeTempValue.textContent = 'offline';
homeTempValue.style.color = '#888';
if (homeTempUnit) {
homeTempUnit.style.display = 'none';
}
if (homeTempStatus) {
homeTempStatus.style.display = 'none';
}
} else {
// –î–∞—Ç—á–∏–∫ online - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
const newValue = d.homeTemp !== null && d.homeTemp > 0 ? d.homeTemp.toFixed(1) : '--';
if (homeTempValue.textContent !== newValue) {
homeTempValue.textContent = newValue;
}
homeTempValue.style.color = '';
if (homeTempUnit) {
homeTempUnit.style.display = 'inline';
}
if (homeTempStatus) {
homeTempStatus.style.display = 'none';
}
}
}
updateTrendArrow('homeTempTrendArrow', d.homeTrend);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–≤–∫–∏ –¥–æ–º–∞ (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –ö–æ–º—Ñ–æ—Ä—Ç)
const homeSetpointValue = document.getElementById('homeSetpointValue');
if (homeSetpointValue) {
const newSetpoint = d.targetHomeTemp !== null && d.targetHomeTemp !== undefined ?
d.targetHomeTemp.toFixed(1) : '24.0';
if (homeSetpointValue.textContent !== newSetpoint) {
homeSetpointValue.textContent = newSetpoint;
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ–±—Ä–∞—Ç–∫–∏
const returnTemp = document.getElementById('returnTemp');
if (returnTemp) {
returnTemp.textContent = d.returnTemp !== null ? d.returnTemp.toFixed(1) : '--';
}

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –æ–±—Ä–∞—Ç–∫–∏
const lowReturnTempWarning = document.getElementById('lowReturnTempWarning');
if (lowReturnTempWarning) {
lowReturnTempWarning.style.display = (d.lowReturnTemp === true) ? 'inline-block' : 'none';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ç–µ–ª—å–Ω–æ–π
const boilerTemp = document.getElementById('boilerTemp');
if (boilerTemp) {
boilerTemp.textContent = d.boilerTemp !== null ? d.boilerTemp.toFixed(1) : '--';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —É–ª–∏—Ü—ã
const outdoorTemp = document.getElementById('outdoorTemp');
if (outdoorTemp) {
outdoorTemp.textContent = d.outdoorTemp !== null ? d.outdoorTemp.toFixed(1) : '--';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–æ—á–µ–∫ —Ç—Ä–µ–Ω–¥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (—Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ)
updateTrendArrow('supplyTrendArrow', d.supplyTrend);
updateTrendArrow('returnTrendArrow', d.returnTrend);
updateTrendArrow('boilerTrendArrow', d.boilerTrend);
updateTrendArrow('outdoorTrendArrow', d.outdoorTrend);
updateTrendArrow('homeTrendArrow', d.homeTrend);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–≥–∞—Å–∞–Ω–∏–∏ –∏ —Ä–æ–∑–∂–∏–≥–µ
const boilerExtinguished = d.boilerExtinguished === true;
const ignitionInProgress = d.ignitionInProgress === true;
const systemState = d.state || '';
const needsReset = boilerExtinguished || systemState === '–ö–û–¢–ï–õ_–ü–û–ì–ê–°' || systemState === '–û–®–ò–ë–ö–ê_–†–û–ó–ñ–ò–ì–ê';

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
const resetStateButton = document.getElementById('resetStateButton');
if (resetStateButton) {
resetStateButton.style.display = needsReset ? 'block' : 'block';
if (needsReset) {
resetStateButton.style.background = '#ff9800';
resetStateButton.style.color = '#fff';
resetStateButton.style.borderColor = '#ff9800';
} else {
resetStateButton.style.background = '#1a1a1a';
resetStateButton.style.color = '#888';
resetStateButton.style.borderColor = '#3a3a3a';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Ä–æ–∑–∂–∏–≥–∞
const ignitionButton = document.getElementById('ignitionButton');
if (ignitionButton) {
if (boilerExtinguished || d.state === '–ö–û–¢–ï–õ_–ü–û–ì–ê–°' || d.state === '–û–®–ò–ë–ö–ê_–†–û–ó–ñ–ò–ì–ê') {
ignitionButton.style.display = 'block';
ignitionButton.disabled = ignitionInProgress;
ignitionButton.textContent = ignitionInProgress ? '–†–æ–∑–∂–∏–≥...' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥';
} else {
ignitionButton.style.display = 'none';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–æ–∑–∂–∏–≥–µ
const ignitionInfo = document.getElementById('ignitionInfo');
if (ignitionInfo) {
if (ignitionInProgress) {
const elapsed = d.ignitionElapsed || 0;
const tempIncrease = d.ignitionTempIncrease || 0;
ignitionInfo.style.display = 'block';
ignitionInfo.innerHTML = `–†–æ–∑–∂–∏–≥: ${Math.floor(elapsed / 60)} –º–∏–Ω, +${tempIncrease.toFixed(1)}¬∞C`;
} else {
ignitionInfo.style.display = 'none';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ–≥–∞—Å–∞–Ω–∏–∏
const extinguishedWarning = document.getElementById('extinguishedWarning');
if (extinguishedWarning) {
extinguishedWarning.style.display = boilerExtinguished ? 'block' : 'none';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞
if (d.fanStats) {
const fanStatsTotal = document.getElementById('fanStatsTotal');
const fanStatsDaily = document.getElementById('fanStatsDaily');
const fanStatsCycles = document.getElementById('fanStatsCycles');
if (fanStatsTotal) {
const hours = Math.floor(d.fanStats.totalWorkTime / 3600);
const minutes = Math.floor((d.fanStats.totalWorkTime % 3600) / 60);
fanStatsTotal.textContent = `${hours}—á ${minutes}–º`;
}
if (fanStatsDaily) {
const hours = Math.floor(d.fanStats.dailyWorkTime / 3600);
const minutes = Math.floor((d.fanStats.dailyWorkTime % 3600) / 60);
fanStatsDaily.textContent = `${hours}—á ${minutes}–º`;
}
if (fanStatsCycles) {
fanStatsCycles.textContent = d.fanStats.cycleCount || 0;
}
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
let statusText = '–†–∞–±–æ—Ç–∞';
let statusClass = 'success';

if (d.systemEnabled === false) {
statusText = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
statusClass = 'warning';
} else if (boilerExtinguished) {
statusText = '–ö–æ—Ç–µ–ª –ø–æ–≥–∞—Å';
statusClass = 'danger';
document.body.classList.add('extinguishing');
} else if (ignitionInProgress) {
statusText = '–†–æ–∑–∂–∏–≥...';
statusClass = 'info';
document.body.classList.remove('extinguishing');
} else if (d.supplyTemp >= 77) {
statusText = '–ü–µ—Ä–µ–≥—Ä–µ–≤!';
statusClass = 'danger';
document.body.classList.remove('extinguishing');
} else if (d.coalFeeding === true) {
statusText = '–ü–æ–¥–±—Ä–æ—Å —É–≥–ª—è';
statusClass = 'info';
document.body.classList.remove('extinguishing');
} else if (d.fan === true || d.pump === true) {
statusText = '–†–∞–±–æ—Ç–∞';
statusClass = 'success';
document.body.classList.remove('extinguishing');
} else {
statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
statusClass = 'idle';
document.body.classList.remove('extinguishing');
}

document.getElementById('stateDisplay').textContent = statusText;
const statusDot = document.getElementById('statusDot');
statusDot.className = 'status-dot ' + statusClass;

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
try {
if (d.systemEnabled !== undefined) {
const systemEnabledCheckbox = document.getElementById('systemEnabled');
if (systemEnabledCheckbox) {
systemEnabledCheckbox.checked = d.systemEnabled;
}
updateSystemStatus(d.systemEnabled);
}
} catch (e) {
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –∏ –Ω–∞—Å–æ—Å–∞
const fanStatusText = document.getElementById('fanStatusText');
const pumpStatusText = document.getElementById('pumpStatusText');

if (fanStatusText) {
fanStatusText.textContent = d.fan ? '–í–ö–õ' : '–í–´–ö–õ';
fanStatusText.style.color = d.fan ? '#00ff00' : '#888';
}

if (pumpStatusText) {
pumpStatusText.textContent = d.pump ? '–í–ö–õ' : '–í–´–ö–õ';
pumpStatusText.style.color = d.pump ? '#00ff00' : '#888';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
if (d.workMode !== undefined) {
const workModeSwitch = document.getElementById('workModeSwitch');
const workModeLabel = document.getElementById('workModeLabel');
if (workModeSwitch) {
workModeSwitch.checked = (d.workMode === 1);
}
if (workModeLabel) {
workModeLabel.textContent = (d.workMode === 1) ? '–ö–æ–º—Ñ–æ—Ä—Ç' : '–ê–≤—Ç–æ';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
const systemModeText = document.getElementById('systemModeText');
if (systemModeText) {
// –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ –ê–≤—Ç–æ
const stateTranslations = {
'IDLE': '–û–∂–∏–¥–∞–Ω–∏–µ',
'HEATING': '–†–∞–∑–æ–≥—Ä–µ–≤',
'HEATING_TIMEOUT': '–¢–∞–π–º–∞—É—Ç —Ä–∞–∑–æ–≥—Ä–µ–≤–∞',
'COAL_BURNED': '–£–≥–æ–ª—å –ø—Ä–æ–≥–æ—Ä–µ–ª',
'OVERHEAT': '–ü–µ—Ä–µ–≥—Ä–µ–≤',
'HIGH_TEMP': '–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
'–û–∂–∏–¥–∞–Ω–∏–µ': '–û–∂–∏–¥–∞–Ω–∏–µ',
'–†–∞–∑–æ–≥—Ä–µ–≤ 1': '–†–∞–∑–æ–≥—Ä–µ–≤ 1',
'–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è': '–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è',
'–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ–≤–∞': '–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ–≤–∞',
'–†–∞–∑–æ–≥—Ä–µ–≤ 2': '–†–∞–∑–æ–≥—Ä–µ–≤ 2',
'–ö–æ–º—Ñ–æ—Ä—Ç': '–ö–æ–º—Ñ–æ—Ä—Ç',
'–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ': '–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ'
};

// –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ –ö–æ–º—Ñ–æ—Ä—Ç
const comfortStateTranslations = {
'WAIT': '–û–∂–∏–¥–∞–Ω–∏–µ',
'HEATING_1': '–†–∞–∑–æ–≥—Ä–µ–≤ 1',
'WAIT_COOLING': '–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è',
'WAIT_HEATING': '–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ–≤–∞',
'HEATING_2': '–†–∞–∑–æ–≥—Ä–µ–≤ 2',
'COMFORT': '–ö–æ–º—Ñ–æ—Ä—Ç',
'MAINTAIN': '–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ',
'OVERHEAT': '–ü–µ—Ä–µ–≥—Ä–µ–≤'
};

let stateText;
let stateForColor;

if (d.workMode === 1 && d.comfortState) {
// –†–µ–∂–∏–º –ö–æ–º—Ñ–æ—Ä—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º comfortState
stateText = comfortStateTranslations[d.comfortState] || d.comfortState;
stateForColor = d.comfortState;
} else if (d.state) {
// –†–µ–∂–∏–º –ê–≤—Ç–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º state
stateText = stateTranslations[d.state] || d.state;
stateForColor = d.state;
} else {
stateText = '--';
stateForColor = '';
}

systemModeText.textContent = `–†–µ–∂–∏–º: ${stateText}`;

// –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
if (stateForColor === 'HEATING' || stateForColor === 'HEATING_1' || stateForColor === 'HEATING_2' ||
stateForColor === '–†–∞–∑–æ–≥—Ä–µ–≤ 1' || stateForColor === '–†–∞–∑–æ–≥—Ä–µ–≤ 2') {
systemModeText.style.color = '#00ff00';
} else if (stateForColor === 'OVERHEAT' || stateForColor === 'HIGH_TEMP') {
systemModeText.style.color = '#ff0000';
} else if (stateForColor === 'COAL_BURNED' || stateForColor === 'HEATING_TIMEOUT') {
systemModeText.style.color = '#ffaa00';
} else if (stateForColor === 'COMFORT' || stateForColor === 'MAINTAIN' ||
stateForColor === '–ö–æ–º—Ñ–æ—Ä—Ç' || stateForColor === '–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ') {
systemModeText.style.color = '#00aaff';
} else {
systemModeText.style.color = '#666';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
if (d.coalFeeding !== undefined) {
updateCoalFeedingStatus(d.coalFeeding, d.coalFeedingRemaining || 0);
if (d.coalFeeding && !coalFeedingTimerInterval) {
startCoalFeedingTimer();
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–æ–∑–∂–∏–≥–∞
if (d.ignitionInProgress !== undefined) {
updateIgnitionStatus(d.ignitionInProgress, d.ignitionElapsed, d.ignitionStartTemp, d.ignitionTempIncrease);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–µ—Ä–µ–≥—Ä–µ–≤–µ
if (d.supplyTemp >= 77) {
document.getElementById('overheatWarning').classList.add('show');
document.getElementById('supplyTempCard').classList.add('overheat');
} else {
document.getElementById('overheatWarning').classList.remove('show');
document.getElementById('supplyTempCard').classList.remove('overheat');
}

if (d.wifiStatus) {
document.getElementById('wifiStatus').textContent = d.wifiStatus;
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ MQTT
if (d.mqttStatus !== undefined) {
const mqttStatusEl = document.getElementById('mqttStatus');
mqttStatusEl.textContent = d.mqttStatus;
if (d.mqttStatus === '–ü–æ–¥–∫–ª—é—á–µ–Ω') {
mqttStatusEl.style.color = '#2ECC71';
} else if (d.mqttStatus === '–û—Ç–∫–ª—é—á–µ–Ω') {
mqttStatusEl.style.color = '#E74C3C';
} else {
mqttStatusEl.style.color = '#888';
}
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ WiFi —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
if (d.wifiRSSI !== undefined) {
const rssi = d.wifiRSSI;
const rssiDisplay = document.getElementById('wifiRSSIDisplay');
const signalBars = document.getElementById('wifiSignalBars');
const rssiText = document.getElementById('wifiRSSIText');

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª–æ—Å–æ–∫ –∏ —Ü–≤–µ—Ç
let activeBars = 0;
let barClass = '';

if (rssi >= -50) {
activeBars = 4;
barClass = 'active';
rssiText.style.color = '#2ECC71';
} else if (rssi >= -70) {
activeBars = 3;
barClass = 'active';
rssiText.style.color = '#2ECC71';
} else if (rssi >= -85) {
activeBars = 2;
barClass = 'warning';
rssiText.style.color = '#F39C12';
} else {
activeBars = 1;
barClass = 'danger';
rssiText.style.color = '#E74C3C';
}

// –°–æ–∑–¥–∞–µ–º –ø–æ–ª–æ—Å–∫–∏ —Å–∏–≥–Ω–∞–ª–∞
signalBars.innerHTML = '';
for (let i = 1; i <= 4; i++) {
const bar = document.createElement('div');
bar.className = 'wifi-bar bar' + i;
if (i <= activeBars) {
bar.classList.add(barClass);
}
signalBars.appendChild(bar);
}

// –¢–µ–∫—Å—Ç —Å —É—Ä–æ–≤–Ω–µ–º —Å–∏–≥–Ω–∞–ª–∞
rssiText.textContent = `${rssi} dBm`;
} else {
const signalBars = document.getElementById('wifiSignalBars');
const rssiText = document.getElementById('wifiRSSIText');
if (signalBars) signalBars.innerHTML = '';
if (rssiText) rssiText.textContent = '';
}
})
.catch(e => {
// –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ - –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
});
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–±—Ä–æ—Å–æ–º —É–≥–ª—è (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
function toggleCoalFeeding() {
fetch('/api/coalFeeding', { method: 'POST' })
.then(r => r.json())
.then(d => {
if (d.success) {
updateCoalFeedingStatus(d.coalFeeding, d.remaining || 0);
}
})
.catch(e => );
}

function updateCoalFeedingStatus(active, remainingSeconds) {
const button = document.getElementById('coalFeedingButton');
const buttonText = document.getElementById('coalFeedingButtonText');
const timer = document.getElementById('coalFeedingTimer');
const timeDisplay = document.getElementById('coalFeedingTime');

if (active) {
button.disabled = false;
buttonText.textContent = 'üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
button.style.background = '#E74C3C';
timer.style.display = 'block';

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
updateCoalFeedingTimer(remainingSeconds);
} else {
button.disabled = false;
buttonText.textContent = 'üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å';
button.style.background = '#F39C12';
timer.style.display = 'none';
if (timeDisplay) timeDisplay.textContent = '00:00';
}
}

function updateCoalFeedingTimer(remainingSeconds) {
const timer = document.getElementById('coalFeedingTimer');
const timeSpan = document.getElementById('coalFeedingTime');

if (remainingSeconds > 0) {
const minutes = Math.floor(remainingSeconds / 60);
const seconds = remainingSeconds % 60;
if (timeSpan) {
timeSpan.textContent = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
}
if (timer) {
timer.style.display = 'block';
}
} else {
if (timeSpan) timeSpan.textContent = '00:00';
if (timer) timer.style.display = 'none';
}
}

// –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –ø–æ–¥–±—Ä–æ—Å–∞ —É–≥–ª—è
let coalFeedingTimerInterval = null;
function startCoalFeedingTimer() {
if (coalFeedingTimerInterval) {
clearInterval(coalFeedingTimerInterval);
}
coalFeedingTimerInterval = setInterval(() => {
fetch('/api/coalFeeding')
.then(r => r.json())
.then(d => {
if (d.coalFeeding && d.remaining > 0) {
updateCoalFeedingTimer(d.remaining);
} else if (d.coalFeeding === false) {
updateCoalFeedingStatus(false, 0);
if (coalFeedingTimerInterval) {
clearInterval(coalFeedingTimerInterval);
coalFeedingTimerInterval = null;
}
}
})
.catch(e => );
}, 1000);
}

function saveAutoSettings() {
const settings = {
setpoint: parseFloat(document.getElementById('autoSetpoint').value),
minTemp: parseFloat(document.getElementById('autoMinTemp').value),
maxTemp: parseFloat(document.getElementById('autoMaxTemp').value),
hysteresis: parseFloat(document.getElementById('autoHysteresis').value),
inertiaTemp: parseFloat(document.getElementById('autoInertiaTemp').value),
inertiaTime: parseFloat(document.getElementById('autoInertiaTime').value),
overheatTemp: parseFloat(document.getElementById('autoOverheatTemp').value),
heatingTimeout: parseFloat(document.getElementById('autoHeatingTimeout').value)
};

fetch('/api/settings/auto', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => r.json())
.then(d => {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
});
}

function resetSystemState() {
if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–ø–æ–≥–∞—Å, –æ—à–∏–±–∫–∞ —Ä–æ–∑–∂–∏–≥–∞)?')) {
return;
}

fetch('/api/system/reset', {
method: 'POST',
headers: { 'Content-Type': 'application/json' }
})
.then(r => r.json())
.then(d => {
if (d.success) {
alert('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å–±—Ä–æ—à–µ–Ω–æ');
updateData();
} else {
alert('–û—à–∏–±–∫–∞: ' + (d.message || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ'));
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è');
});
}

function startIgnition() {
const button = document.getElementById('ignitionButton');
const buttonText = document.getElementById('ignitionButtonText');
const statusDiv = document.getElementById('ignitionStatus');

if (button) {
button.disabled = true;
}
if (buttonText) {
buttonText.textContent = 'üî• –†–æ–∑–∂–∏–≥...';
}

fetch('/api/system/ignition', { method: 'POST' })
.then(r => r.json())
.then(d => {
if (d.success) {
updateData();
} else {
alert('–û—à–∏–±–∫–∞: ' + (d.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥'));
if (button) button.disabled = false;
if (buttonText) buttonText.textContent = 'üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥';
if (statusDiv) statusDiv.style.display = 'none';
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ä–æ–∑–∂–∏–≥–∞');
if (button) button.disabled = false;
if (buttonText) buttonText.textContent = 'üî• –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑–∂–∏–≥';
if (statusDiv) statusDiv.style.display = 'none';
});
}

function toggleWorkMode() {
const switchEl = document.getElementById('workModeSwitch');
const newMode = switchEl.checked ? 1 : 0;

fetch('/api/system/mode', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ mode: newMode })
})
.then(r => {
if (!r.ok) {
return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
}
return r.json();
})
.then(d => {
if (d.success) {
const label = document.getElementById('workModeLabel');
if (label) {
label.textContent = (newMode === 1) ? '–ö–æ–º—Ñ–æ—Ä—Ç' : '–ê–≤—Ç–æ';
}
updateData();
} else {
// –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
switchEl.checked = !switchEl.checked;
}
})
.catch(e => {
// –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
switchEl.checked = !switchEl.checked;
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
alert('–û—à–∏–±–∫–∞: ' + e.message);
});
}

function loadComfortSettings() {
fetch('/api/settings/comfort')
.then(r => r.json())
.then(d => {
if (d.targetHomeTemp !== undefined) document.getElementById('comfortTargetHomeTemp').value = d.targetHomeTemp;
if (d.minBoilerTemp !== undefined) document.getElementById('comfortMinBoilerTemp').value = d.minBoilerTemp;
if (d.maxBoilerTemp !== undefined) document.getElementById('comfortMaxBoilerTemp').value = d.maxBoilerTemp;
if (d.waitTemp !== undefined) document.getElementById('comfortWaitTemp').value = d.waitTemp;
if (d.catchUpTemp !== undefined) document.getElementById('comfortCatchUpTemp').value = d.catchUpTemp;
if (d.waitCoolingTime !== undefined) document.getElementById('comfortWaitCoolingTime').value = d.waitCoolingTime;
if (d.waitAfterHeating1Time !== undefined) document.getElementById('comfortWaitAfterHeating1Time').value = d.waitAfterHeating1Time;
if (d.waitAfterReductionTime !== undefined) document.getElementById('comfortWaitAfterReductionTime').value = d.waitAfterReductionTime;
if (d.inertiaCheckInterval !== undefined) document.getElementById('comfortInertiaCheckInterval').value = d.inertiaCheckInterval;
if (d.hysteresisOn !== undefined) document.getElementById('comfortHysteresisOn').value = d.hysteresisOn;
if (d.hysteresisOff !== undefined) document.getElementById('comfortHysteresisOff').value = d.hysteresisOff;
if (d.hysteresisBoiler !== undefined) document.getElementById('comfortHysteresisBoiler').value = d.hysteresisBoiler;
if (d.warningTemp !== undefined) document.getElementById('comfortWarningTemp').value = d.warningTemp;

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
const min = parseFloat(d.minBoilerTemp || 45);
const max = parseFloat(d.maxBoilerTemp || 75);
const intermediate = (min + max) / 2;
const intermediateEl = document.getElementById('comfortIntermediateTemp');
if (intermediateEl) intermediateEl.textContent = intermediate.toFixed(0);
})
.catch(e => );
}

function saveComfortSettings() {
const data = {
targetHomeTemp: parseFloat(document.getElementById('comfortTargetHomeTemp').value),
minBoilerTemp: parseFloat(document.getElementById('comfortMinBoilerTemp').value),
maxBoilerTemp: parseFloat(document.getElementById('comfortMaxBoilerTemp').value),
waitTemp: parseFloat(document.getElementById('comfortWaitTemp').value),
catchUpTemp: parseFloat(document.getElementById('comfortCatchUpTemp').value),
waitCoolingTime: parseInt(document.getElementById('comfortWaitCoolingTime').value),
waitAfterHeating1Time: parseInt(document.getElementById('comfortWaitAfterHeating1Time').value),
waitAfterReductionTime: parseInt(document.getElementById('comfortWaitAfterReductionTime').value),
inertiaCheckInterval: parseInt(document.getElementById('comfortInertiaCheckInterval').value),
hysteresisOn: parseFloat(document.getElementById('comfortHysteresisOn').value),
hysteresisOff: parseFloat(document.getElementById('comfortHysteresisOff').value),
hysteresisBoiler: parseFloat(document.getElementById('comfortHysteresisBoiler').value),
warningTemp: parseFloat(document.getElementById('comfortWarningTemp').value)
};

fetch('/api/settings/comfort', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(data)
})
.then(r => r.json())
.then(d => {
if (d.success) {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º—Ñ–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
loadComfortSettings();
} else {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
});
}

function loadAutoSettings() {
fetch('/api/settings/auto')
.then(r => r.json())
.then(d => {
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
if (d.setpoint !== undefined && d.setpoint !== null && !isNaN(d.setpoint) && d.setpoint >= 40 && d.setpoint <= 80) {
document.getElementById('autoSetpoint').value = d.setpoint;
}
if (d.minTemp !== undefined && d.minTemp !== null && !isNaN(d.minTemp) && d.minTemp >= 30 && d.minTemp <= 60) {
document.getElementById('autoMinTemp').value = d.minTemp;
}
if (d.maxTemp !== undefined && d.maxTemp !== null && !isNaN(d.maxTemp) && d.maxTemp >= 60 && d.maxTemp <= 90) {
document.getElementById('autoMaxTemp').value = d.maxTemp;
}
if (d.hysteresis !== undefined && d.hysteresis !== null && !isNaN(d.hysteresis) && d.hysteresis >= 0.5 && d.hysteresis <= 10) {
document.getElementById('autoHysteresis').value = d.hysteresis;
}
if (d.inertiaTemp !== undefined && d.inertiaTemp !== null && !isNaN(d.inertiaTemp) && d.inertiaTemp >= 40 && d.inertiaTemp <= 70) {
document.getElementById('autoInertiaTemp').value = d.inertiaTemp;
}
if (d.inertiaTime !== undefined && d.inertiaTime !== null && !isNaN(d.inertiaTime) && d.inertiaTime >= 1 && d.inertiaTime <= 60) {
document.getElementById('autoInertiaTime').value = d.inertiaTime;
}
if (d.overheatTemp !== undefined && d.overheatTemp !== null && !isNaN(d.overheatTemp) && d.overheatTemp >= 70 && d.overheatTemp <= 90) {
document.getElementById('autoOverheatTemp').value = d.overheatTemp;
}
if (d.heatingTimeout !== undefined && d.heatingTimeout !== null && !isNaN(d.heatingTimeout) && d.heatingTimeout >= 10 && d.heatingTimeout <= 120) {
document.getElementById('autoHeatingTimeout').value = d.heatingTimeout;
}
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
})
.catch(e => );
}

function saveMqttSettings() {
const settings = {
enabled: document.getElementById('mqttEnabled').checked,
server: document.getElementById('mqttServer').value,
port: parseInt(document.getElementById('mqttPort').value),
useTLS: document.getElementById('mqttUseTLS').checked,
user: document.getElementById('mqttUser').value,
password: document.getElementById('mqttPassword').value,
prefix: document.getElementById('mqttPrefix').value,
tempInterval: parseInt(document.getElementById('mqttTempInterval').value),
stateInterval: parseInt(document.getElementById('mqttStateInterval').value)
};

fetch('/api/settings/mqtt', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => r.json())
.then(d => {
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
const systemEnabled = document.getElementById('mqttSystemEnabled').checked;
return fetch('/api/system/enable?enabled=' + (systemEnabled ? 1 : 0), { method: 'POST' });
})
.then(r => r.json())
.then(d => {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –∏ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
});
}

function loadMqttSettings() {
fetch('/api/settings/mqtt')
.then(r => r.json())
.then(d => {
if (d.enabled !== undefined) document.getElementById('mqttEnabled').checked = d.enabled;
if (d.server) document.getElementById('mqttServer').value = d.server;
if (d.port) document.getElementById('mqttPort').value = d.port;
if (d.useTLS !== undefined) document.getElementById('mqttUseTLS').checked = d.useTLS;
if (d.user) document.getElementById('mqttUser').value = d.user;
if (d.password) document.getElementById('mqttPassword').value = d.password;
if (d.prefix) {
document.getElementById('mqttPrefix').value = d.prefix;
updateMqttTopicInfo(d.prefix);
}
if (d.tempInterval) document.getElementById('mqttTempInterval').value = d.tempInterval;
if (d.stateInterval) document.getElementById('mqttStateInterval').value = d.stateInterval;
})
.catch(e => );

// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
fetch('/api/status')
.then(r => r.json())
.then(d => {
if (d.systemEnabled !== undefined) {
document.getElementById('mqttSystemEnabled').checked = d.systemEnabled;
}
})
.catch(e => );
}

function testMqttConnection() {
fetch('/api/mqtt/test', { method: 'POST' })
.then(r => r.json())
.then(d => {
alert(d.success ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!' : '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + d.message);
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
});
}

function loadWiFiInfo() {
fetch('/api/wifi/info')
.then(r => r.json())
.then(d => {
if (d.ssid !== undefined) document.getElementById('currentSSID').value = d.ssid || '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
if (d.ip !== undefined) document.getElementById('currentIP').value = d.ip || '--';
if (d.rssi !== undefined) document.getElementById('currentRSSI').value = d.rssi ? (d.rssi + ' dBm') : '--';
if (d.mac !== undefined) document.getElementById('currentMAC').value = d.mac || '--';
})
.catch(e => );
}

let wifiScanCheckInterval = null;

function scanWiFiNetworks() {
const button = document.getElementById('scanWiFiButton');
const results = document.getElementById('wifiScanResults');
const list = document.getElementById('wifiNetworksList');

// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –µ—Å–ª–∏ –±—ã–ª–∞
if (wifiScanCheckInterval) {
clearInterval(wifiScanCheckInterval);
wifiScanCheckInterval = null;
}

button.disabled = true;
button.textContent = '‚è≥ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...</div>';
results.style.display = 'block';

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
fetch('/api/wifi/scan')
.then(r => r.json())
.then(d => {
if (d.scanning) {
// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
checkWiFiScanResults();
} else {
// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∏–ª–∏ –æ—à–∏–±–∫–∞
button.disabled = false;
button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
if (d.message) {
list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">' + d.message + '</div>';
}
}
})
.catch(e => {
button.disabled = false;
button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
});
}

function checkWiFiScanResults() {
const button = document.getElementById('scanWiFiButton');
const list = document.getElementById('wifiNetworksList');
let attempts = 0;
const maxAttempts = 20;

wifiScanCheckInterval = setInterval(() => {
attempts++;

fetch('/api/wifi/scan/results')
.then(r => r.json())
.then(d => {
if (d.scanning) {
// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â–µ –∏–¥–µ—Ç
list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ... (' + attempts + ')</div>';

if (attempts >= maxAttempts) {
// –¢–∞–π–º–∞—É—Ç
clearInterval(wifiScanCheckInterval);
wifiScanCheckInterval = null;
button.disabled = false;
button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–¢–∞–π–º–∞—É—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
}
} else {
// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
clearInterval(wifiScanCheckInterval);
wifiScanCheckInterval = null;
button.disabled = false;
button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';

if (d.success && d.networks && d.networks.length > 0) {
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
window.wifiNetworksList = d.networks;

// –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
populateWiFiSelects(d.networks);

list.innerHTML = '';
d.networks.forEach((network, index) => {
const networkDiv = document.createElement('div');
networkDiv.style.cssText = 'padding: 12px; margin-bottom: 8px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px;';

const rssi = network.rssi || 0;
let rssiColor = '#E74C3C';
if (rssi > -50) rssiColor = '#2ECC71';
else if (rssi > -70) rssiColor = '#F39C12';

networkDiv.innerHTML = `
<div style="display: flex; justify-content: space-between; align-items: center;"><div><div style="font-weight: 600; color: var(--text-color); margin-bottom: 4px;">
${network.ssid || '<i>–°–∫—Ä—ã—Ç–∞—è —Å–µ—Ç—å</i>'}
</div><div style="font-size: 0.85em; color: var(--text-secondary);">
${network.encryption || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | –ö–∞–Ω–∞–ª: ${network.channel || '--'} |
<span style="color: ${rssiColor};">${rssi} dBm</span></div></div><div style="font-size: 1.5em;">${network.encryption && network.encryption !== '–û—Ç–∫—Ä—ã—Ç–∞—è' ? 'üîí' : 'üîì'}</div></div>
`;
list.appendChild(networkDiv);
});

const countDiv = document.createElement('div');
countDiv.style.cssText = 'margin-top: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9em;';
countDiv.textContent = `–ù–∞–π–¥–µ–Ω–æ —Å–µ—Ç–µ–π: ${d.count || d.networks.length}`;
list.appendChild(countDiv);
} else {
list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">–°–µ—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
window.wifiNetworksList = [];
populateWiFiSelects([]);
}
}
})
.catch(e => {
clearInterval(wifiScanCheckInterval);
wifiScanCheckInterval = null;
button.disabled = false;
button.textContent = 'üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏';
list.innerHTML = '<div style="text-align: center; padding: 20px; color: #E74C3C;">–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>';
});
}, 500);
}

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π
window.wifiNetworksList = [];

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏
function populateWiFiSelects(networks) {
const primarySelect = document.getElementById('primarySSIDSelect');
const backupSelect = document.getElementById('backupSSIDSelect');

// –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é
primarySelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>';
backupSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ --</option>';

// –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ç–∏ –ø–æ RSSI (–æ—Ç –ª—É—á—à–µ–≥–æ –∫ —Ö—É–¥—à–µ–º—É)
const sortedNetworks = [...networks].sort((a, b) => (b.rssi || -100) - (a.rssi || -100));

sortedNetworks.forEach(network => {
if (network.ssid) {
const rssi = network.rssi || 0;
const encryption = network.encryption || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
const optionText = `${network.ssid} (${rssi} dBm, ${encryption})`;

// –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi
const primaryOption = document.createElement('option');
primaryOption.value = network.ssid;
primaryOption.textContent = optionText;
primarySelect.appendChild(primaryOption);

// –î–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi
const backupOption = document.createElement('option');
backupOption.value = network.ssid;
backupOption.textContent = optionText;
backupSelect.appendChild(backupOption);
}
});
}

// –í—ã–±–æ—Ä SSID –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ WiFi
function selectPrimarySSID() {
const select = document.getElementById('primarySSIDSelect');
const input = document.getElementById('primarySSID');
if (select.value) {
input.value = select.value;
}
}

// –í—ã–±–æ—Ä SSID –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ WiFi
function selectBackupSSID() {
const select = document.getElementById('backupSSIDSelect');
const input = document.getElementById('backupSSID');
if (select.value) {
input.value = select.value;
}
}

function loadWiFiSettings() {
fetch('/api/wifi/settings')
.then(r => r.json())
.then(d => {
document.getElementById('primarySSID').value = d.primarySSID || '';
document.getElementById('primaryPassword').value = d.primaryPassword || '';
document.getElementById('backupSSID').value = d.backupSSID || '';
document.getElementById('backupPassword').value = d.backupPassword || '';
document.getElementById('antennaTuning').checked = d.antennaTuning || false;

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö
const primarySelect = document.getElementById('primarySSIDSelect');
const backupSelect = document.getElementById('backupSSIDSelect');
if (d.primarySSID) {
primarySelect.value = d.primarySSID;
}
if (d.backupSSID) {
backupSelect.value = d.backupSSID;
}

// –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π, –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–∫–∏
if (window.wifiNetworksList && window.wifiNetworksList.length > 0) {
populateWiFiSelects(window.wifiNetworksList);
// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
if (d.primarySSID) {
primarySelect.value = d.primarySSID;
}
if (d.backupSSID) {
backupSelect.value = d.backupSSID;
}
}

toggleAntennaTuning();
})
.catch(e => {
});
}

function saveWiFiSettings() {
const settings = {
primarySSID: document.getElementById('primarySSID').value,
primaryPassword: document.getElementById('primaryPassword').value,
backupSSID: document.getElementById('backupSSID').value,
backupPassword: document.getElementById('backupPassword').value,
antennaTuning: document.getElementById('antennaTuning').checked
};

fetch('/api/wifi/settings', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => r.json())
.then(d => {
if (d.success) {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.');
} else {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
});
}

let antennaTuningInterval = null;

function toggleAntennaTuning() {
const enabled = document.getElementById('antennaTuning').checked;
const infoDiv = document.getElementById('antennaSignalInfo');

if (enabled) {
infoDiv.style.display = 'block';
updateAntennaSignal();
// –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
antennaTuningInterval = setInterval(updateAntennaSignal, 1000);
} else {
infoDiv.style.display = 'none';
if (antennaTuningInterval) {
clearInterval(antennaTuningInterval);
antennaTuningInterval = null;
}
}
}

function updateAntennaSignal() {
fetch('/api/wifi/signal')
.then(r => r.json())
.then(d => {
if (d.connected) {
document.getElementById('signalPercentage').textContent = d.percentage;
document.getElementById('signalRSSI').textContent = d.rssi;
} else {
document.getElementById('signalPercentage').textContent = '0';
document.getElementById('signalRSSI').textContent = 'N/A';
}
})
.catch(e => {
});
}

function resetWiFi() {
if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi? –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞.')) {
fetch('/api/wifi/reset', { method: 'POST' })
.then(() => {
alert('WiFi —Å–±—Ä–æ—à–µ–Ω. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ WiFi');
});
}
}

function scanSensors() {
fetch('/api/sensors/scan', { method: 'POST' })
.then(r => r.json())
.then(d => {
const list = document.getElementById('sensorList');
if (d.sensors && d.sensors.length > 0) {
let html = '<div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;">';
d.sensors.forEach(sensor => {
html += `<div style="padding: 8px; border-bottom: 1px solid #e9ecef;"><strong>${sensor.address}</strong><br><small>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${sensor.temperature !== null ? sensor.temperature.toFixed(1) + '¬∞C' : 'N/A'}</small></div>`;
});
html += '</div>';
list.innerHTML = html;

const selects = ['sensorSupply', 'sensorReturn', 'sensorBoiler', 'sensorOutside'];
selects.forEach(selectId => {
const select = document.getElementById(selectId);
select.innerHTML = '<option value="">–ù–µ –≤—ã–±—Ä–∞–Ω</option>';
d.sensors.forEach(sensor => {
const option = document.createElement('option');
option.value = sensor.address;
// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–¥—Ä–µ—Å –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
let text = sensor.address;
if (sensor.temperature !== null && sensor.temperature !== undefined) {
text += ` (${sensor.temperature.toFixed(1)}¬∞C)`;
} else {
text += ' (N/A)';
}
option.textContent = text;
select.appendChild(option);
});
});
} else {
list.innerHTML = '<p>–î–∞—Ç—á–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤');
});
}

function loadSensorMapping() {
// –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–≤—è–∑–∫—É
fetch('/api/sensors/mapping')
.then(r => r.json())
.then(d => {
if (d.supply) document.getElementById('sensorSupply').value = d.supply;
if (d.return) document.getElementById('sensorReturn').value = d.return;
if (d.boiler) document.getElementById('sensorBoiler').value = d.boiler;
if (d.outside) document.getElementById('sensorOutside').value = d.outside;

// –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ —Å–ø–∏—Å–∫–∞—Ö
updateSensorTemperaturesInSelects();
})
.catch(e => );
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö
function updateSensorTemperaturesInSelects() {
// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —á–µ—Ä–µ–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
fetch('/api/sensors/scan', { method: 'POST' })
.then(r => r.json())
.then(d => {
if (d.sensors && d.sensors.length > 0) {
const selects = ['sensorSupply', 'sensorReturn', 'sensorBoiler', 'sensorOutside'];
selects.forEach(selectId => {
const select = document.getElementById(selectId);
// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ü–∏–π
Array.from(select.options).forEach(option => {
if (option.value && option.value !== '') {
const sensor = d.sensors.find(s => s.address === option.value);
if (sensor) {
let text = sensor.address;
if (sensor.temperature !== null && sensor.temperature !== undefined) {
text += ` (${sensor.temperature.toFixed(1)}¬∞C)`;
} else {
text += ' (N/A)';
}
option.textContent = text;
}
}
});
});
}
})
.catch(e => );
}

function saveSensorMapping() {
const mapping = {
supply: document.getElementById('sensorSupply').value,
return: document.getElementById('sensorReturn').value,
boiler: document.getElementById('sensorBoiler').value,
outside: document.getElementById('sensorOutside').value
};

fetch('/api/sensors/mapping', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(mapping)
})
.then(r => r.json())
.then(d => {
alert('–ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞—Ç—á–∏–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
});
}

function loadSystemInfo() {
fetch('/api/system/info')
.then(r => r.json())
.then(d => {
document.getElementById('firmwareVersion').value = d.version || '--';
document.getElementById('systemIP').value = d.ip || '--';
document.getElementById('systemMAC').value = d.mac || '--';
document.getElementById('systemUptime').value = d.uptime || '--';
document.getElementById('systemFreeMem').value = d.freeMem || '--';
document.getElementById('systemTime').value = d.time || '--:--:--';
document.getElementById('systemDate').value = d.date || '--.--.----';
})
.catch(e => {
// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
document.getElementById('firmwareVersion').value = '--';
document.getElementById('systemIP').value = '--';
document.getElementById('systemMAC').value = '--';
document.getElementById('systemUptime').value = '--';
document.getElementById('systemFreeMem').value = '--';
document.getElementById('systemTime').value = '--:--:--';
document.getElementById('systemDate').value = '--.--.----';
});
}

function loadBootLog() {
fetch('/api/system/log')
.then(r => r.json())
.then(d => {
const container = document.getElementById('bootLogContainer');
const bootCountEl = document.getElementById('currentBootCount');

if (bootCountEl) {
bootCountEl.value = d.currentBootCount || 0;
}

if (container) {
if (!d.entries || d.entries.length === 0) {
container.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">–ñ—É—Ä–Ω–∞–ª –ø—É—Å—Ç</div>';
return;
}

let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">';
html += '<thead><tr style="border-bottom: 2px solid #3a3a3a;">';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">#</th>';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–î–∞—Ç–∞/–í—Ä–µ–º—è</th>';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–ü—Ä–∏—á–∏–Ω–∞</th>';
html += '</tr></thead><tbody>';

// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ bootCount (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
const sorted = [...d.entries].sort((a, b) => b.bootCount - a.bootCount);

sorted.forEach(entry => {
const reasonColor = entry.reason.includes('WDT') || entry.reason.includes('–ü–∞–Ω–∏–∫–∞') || entry.reason.includes('–°–±–æ–π') ? '#ff4444' :
entry.reason.includes('–í–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è') || entry.reason.includes('POWERON') ? '#4A90E2' : '#50C878';
html += '<tr style="border-bottom: 1px solid #3a3a3a;">';
html += `<td style="padding: 8px; color: #fff; font-weight: bold;">${entry.bootCount}</td>`;
html += `<td style="padding: 8px; color: #aaa;">${entry.datetime || 'N/A'}</td>`;
html += `<td style="padding: 8px; color: ${reasonColor};">${entry.reason}</td>`;
html += '</tr>';
});

html += '</tbody></table>';
container.innerHTML = html;
}
})
.catch(e => {
const container = document.getElementById('bootLogContainer');
if (container) {
container.innerHTML = '<div style="text-align: center; color: #ff4444; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂—É—Ä–Ω–∞–ª–∞</div>';
}
});
}

function resetBootCount() {
if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
return;
}

fetch('/api/system/bootcount/reset', { method: 'POST' })
.then(r => r.json())
.then(d => {
if (d.success) {
alert('–ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω');
loadBootLog();
} else {
alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∂—É—Ä–Ω–∞–ª–∞');
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∂—É—Ä–Ω–∞–ª–∞');
});
}

function loadTimers() {
fetch('/api/system/timers')
.then(r => r.json())
.then(d => {
const container = document.getElementById('timersContainer');
if (!container) return;

if (!d.timers || d.timers.length === 0) {
container.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∞–π–º–µ—Ä–∞—Ö</div>';
return;
}

let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">';
html += '<thead><tr style="border-bottom: 2px solid #3a3a3a;">';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–¢–∞–π–º–µ—Ä</th>';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–°—Ç–∞—Ç—É—Å</th>';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–ó–Ω–∞—á–µ–Ω–∏–µ</th>';
html += '<th style="text-align: left; padding: 8px; color: #aaa;">–û–ø–∏—Å–∞–Ω–∏–µ</th>';
html += '</tr></thead><tbody>';

d.timers.forEach(timer => {
const isActive = timer.active;
const statusColor = isActive ? '#50C878' : '#888';
const statusText = isActive ? '‚óè –ê–∫—Ç–∏–≤–µ–Ω' : '‚óã –ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
const valueText = timer.value || 'N/A';

html += '<tr style="border-bottom: 1px solid #3a3a3a;">';
html += `<td style="padding: 8px; color: #fff; font-weight: bold;">${timer.name}</td>`;
html += `<td style="padding: 8px; color: ${statusColor};">${statusText}</td>`;
html += `<td style="padding: 8px; color: #aaa;">${valueText}</td>`;
html += `<td style="padding: 8px; color: #888; font-size: 0.85em;">${timer.description || ''}</td>`;
html += '</tr>';
});

html += '</tbody></table>';
container.innerHTML = html;
})
.catch(e => {
const container = document.getElementById('timersContainer');
if (container) {
container.innerHTML = '<div style="text-align: center; color: #ff4444; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–π–º–µ—Ä–æ–≤</div>';
}
});
}

function rebootDevice() {
if (confirm('–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?')) {
fetch('/api/system/reboot', { method: 'POST' })
.then(() => {
alert('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏');
});
}
}

function uploadOTA() {
const fileInput = document.getElementById('otaFile');
const file = fileInput.files[0];
const statusDiv = document.getElementById('otaStatus');
const uploadBtn = document.getElementById('otaUploadBtn');

if (!file) {
statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏</span>';
return;
}

if (!file.name.endsWith('.bin')) {
statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ö†Ô∏è –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .bin</span>';
return;
}

if (!confirm('–ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏? –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.')) {
return;
}

uploadBtn.disabled = true;
statusDiv.innerHTML = '<span style="color: #3498DB;">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</span>';

const formData = new FormData();
formData.append('firmware', file);

fetch('/update', {
method: 'POST',
body: formData
})
.then(response => {
if (response.ok) {
statusDiv.innerHTML = '<span style="color: #2ECC71;">‚úÖ –ü—Ä–æ—à–∏–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>';
setTimeout(() => {
window.location.reload();
}, 5000);
} else {
throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + response.statusText);
}
})
.catch(error => {
statusDiv.innerHTML = '<span style="color: #E74C3C;">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
uploadBtn.disabled = false;
});
}

document.addEventListener('DOMContentLoaded', function() {
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º–Ω—É—é —Ç–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
document.body.className = 'theme-dark-blue';
// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
fetch('/api/system/mode')
.then(r => r.json())
.then(d => {
if (d.mode !== undefined) {
const workModeSwitch = document.getElementById('workModeSwitch');
const workModeLabel = document.getElementById('workModeLabel');
if (workModeSwitch) {
workModeSwitch.checked = (d.mode === 1);
}
if (workModeLabel) {
workModeLabel.textContent = (d.mode === 1) ? '–ö–æ–º—Ñ–æ—Ä—Ç' : '–ê–≤—Ç–æ';
}
}
})
.catch(e => );

updateData();
updateInterval = setInterval(updateData, 3000);
startCoalFeedingTimer();

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –¥–∞—Ç—á–∏–∫–æ–≤ (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
setInterval(updateSensorTemperaturesInSelects, 10000);
});

function loadNTPSettings() {
fetch('/api/ntp/settings')
.then(r => r.json())
.then(d => {
if (d.enabled !== undefined) document.getElementById('ntpEnabled').checked = d.enabled;
if (d.server) document.getElementById('ntpServer').value = d.server;
if (d.timezone !== undefined) document.getElementById('ntpTimezone').value = d.timezone;
if (d.updateInterval !== undefined) document.getElementById('ntpUpdateInterval').value = d.updateInterval / 3600;
})
.catch(e => );
}

function updateNTPTime() {
fetch('/api/ntp/time')
.then(r => r.json())
.then(d => {
if (d.time) document.getElementById('ntpCurrentTime').value = d.time;
if (d.date) document.getElementById('ntpCurrentDate').value = d.date;
if (d.synced !== undefined) {
document.getElementById('ntpSyncStatus').value = d.synced ? '‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ' : '‚úó –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
document.getElementById('ntpSyncStatus').style.color = d.synced ? '#27AE60' : '#E74C3C';
}
})
.catch(e => );
}

function saveNTPSettings() {
const serverValue = document.getElementById('ntpServer').value.trim();
if (!serverValue || serverValue.length === 0) {
alert('–û—à–∏–±–∫–∞: NTP —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
return;
}

const timezoneValue = parseInt(document.getElementById('ntpTimezone').value);
if (isNaN(timezoneValue) || timezoneValue < -12 || timezoneValue > 14) {
alert('–û—à–∏–±–∫–∞: –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç -12 –¥–æ +14!');
return;
}

const intervalValue = parseInt(document.getElementById('ntpUpdateInterval').value);
if (isNaN(intervalValue) || intervalValue < 1 || intervalValue > 24) {
alert('–û—à–∏–±–∫–∞: –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤!');
return;
}

const settings = {
enabled: document.getElementById('ntpEnabled').checked,
server: serverValue,
timezone: timezoneValue,
updateInterval: intervalValue * 3600
};

fetch('/api/ntp/settings', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => {
if (!r.ok) {
return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
}
return r.json();
})
.then(d => {
if (d.success !== undefined && d.success) {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ NTP —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
setTimeout(() => {
updateNTPTime();
loadNTPSettings();
}, 1000);
} else {
throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
});
}

function loadMLSettings() {
fetch('/api/ml/settings')
.then(r => r.json())
.then(d => {
// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ (true), –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
document.getElementById('mlEnabled').checked = d.enabled !== undefined ? d.enabled : true;
document.getElementById('mlPublishInterval').value = d.publishInterval !== undefined ? d.publishInterval : 10;
})
.catch(e => {
// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ
document.getElementById('mlEnabled').checked = true;
document.getElementById('mlPublishInterval').value = 10;
});
}

function saveMLSettings() {
const intervalValue = parseInt(document.getElementById('mlPublishInterval').value);
if (isNaN(intervalValue) || intervalValue < 5 || intervalValue > 300) {
alert('–û—à–∏–±–∫–∞: –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 5 –¥–æ 300 —Å–µ–∫—É–Ω–¥!');
return;
}

const settings = {
enabled: document.getElementById('mlEnabled').checked,
publishInterval: intervalValue
};

fetch('/api/ml/settings', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => {
if (!r.ok) {
return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
}
return r.json();
})
.then(d => {
if (d.success !== undefined && d.success) {
// –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
if (d.enabled !== undefined) {
document.getElementById('mlEnabled').checked = d.enabled;
}
if (d.publishInterval !== undefined) {
document.getElementById('mlPublishInterval').value = d.publishInterval;
}
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –í–∫–ª—é—á–µ–Ω–æ: ' + (d.enabled ? '–î–∞' : '–ù–µ—Ç'));
} else {
throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
});
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
function loadRelaySettings() {
fetch('/api/settings/relay')
.then(r => r.json())
.then(d => {
document.getElementById('fanOffIsLow').checked = d.fanOffIsLow !== undefined ? d.fanOffIsLow : true;
document.getElementById('pumpOffIsLow').checked = d.pumpOffIsLow !== undefined ? d.pumpOffIsLow : true;
document.getElementById('sensorsOffIsLow').checked = d.sensorsOffIsLow !== undefined ? d.sensorsOffIsLow : true;
updateManualControlStatus(d);
})
.catch(e => {
});
}

function saveRelaySettings() {
const settings = {
fanOffIsLow: document.getElementById('fanOffIsLow').checked,
pumpOffIsLow: document.getElementById('pumpOffIsLow').checked,
sensorsOffIsLow: document.getElementById('sensorsOffIsLow').checked
};

fetch('/api/settings/relay', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(settings)
})
.then(r => {
if (!r.ok) {
return r.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'); });
}
return r.json();
})
.then(d => {
if (d.success) {
// –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
if (d.fanOffIsLow !== undefined) {
document.getElementById('fanOffIsLow').checked = d.fanOffIsLow;
}
if (d.pumpOffIsLow !== undefined) {
document.getElementById('pumpOffIsLow').checked = d.pumpOffIsLow;
}
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
} else {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
});
}

function controlRelay(device, state, manual) {
const params = new URLSearchParams({
device: device,
state: state ? '1' : '0',
manual: manual ? '1' : '0'
});

fetch('/api/control?' + params, {
method: 'POST'
})
.then(r => r.json())
.then(d => {
if (d.success) {
`);
if (manual) {
loadRelaySettings();
}
} else {
alert('–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ: ' + e.message);
});
}

function updateManualControlStatus(data) {
const isActive = (data.manualFanControl || data.manualPumpControl);
const statusEl = document.getElementById('manualControlState');
const remainingEl = document.getElementById('manualControlRemaining');

if (isActive) {
statusEl.textContent = '–ê–∫—Ç–∏–≤–Ω–æ';
const remaining = data.manualControlRemaining || 0;
remainingEl.textContent = remaining > 0 ? remaining : '0';
} else {
statusEl.textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–æ';
remainingEl.textContent = '--';
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ –≤–∫–ª–∞–¥–∫–µ NTP
setInterval(() => {
if (document.getElementById('settingsNtp') && document.getElementById('settingsNtp').classList.contains('active')) {
updateNTPTime();
}
// –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ–º ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
// –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞
// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–µ
if (document.getElementById('settingsRelay') && document.getElementById('settingsRelay').classList.contains('active')) {
fetch('/api/settings/relay')
.then(r => r.json())
.then(d => {
updateManualControlStatus(d);
})
.catch(e => );
}
}, 1000);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ –≤–∫–ª–∞–¥–∫–µ –°–∏—Å—Ç–µ–º–∞
setInterval(() => {
if (document.getElementById('settingsSystem') && document.getElementById('settingsSystem').classList.contains('active')) {
fetch('/api/ntp/time')
.then(r => r.json())
.then(d => {
if (d.time) document.getElementById('systemTime').value = d.time;
if (d.date) document.getElementById('systemDate').value = d.date;
})
.catch(e => );
}
}, 1000);

function updateMqttTopicInfo(prefix) {
const prefixValue = prefix || document.getElementById('mqttPrefix').value || 'kotel/device1';

// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–æ–ø–∏–∫–∏
const topics = {
'mqttTopicTemp': prefixValue + '/simple/temp',
'mqttTopicReturnTemp': prefixValue + '/simple/returnTemp',
'mqttTopicBoilerTemp': prefixValue + '/simple/boilerTemp',
'mqttTopicOutdoorTemp': prefixValue + '/simple/outdoorTemp',
'mqttTopicHomeTemp': prefixValue + '/simple/homeTemp',
'mqttTopicEnabled': prefixValue + '/simple/enabled',
'mqttTopicSetpoint': prefixValue + '/simple/setpoint',
'mqttTopicState': prefixValue + '/state',
'mqttTopicCoalFeeding': prefixValue + '/coalFeeding',
'mqttTopicSetpointSet': prefixValue + '/setpoint/set',
'mqttTopicSensorsReset': prefixValue + '/sensors/reset',
'mqttTopicIgnitionStart': prefixValue + '/ignition/start'
};

for (const [id, topic] of Object.entries(topics)) {
const el = document.getElementById(id);
if (el) {
el.textContent = topic;
el.setAttribute('data-topic', topic);
}
}
}

// –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–ø–∏–∫–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
function copyMqttTopic(topic) {
if (navigator.clipboard && navigator.clipboard.writeText) {
navigator.clipboard.writeText(topic).then(() => {
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
const notification = document.createElement('div');
notification.textContent = '‚úì –¢–æ–ø–∏–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + topic;
notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #2ECC71; color: white; padding: 15px 20px; border-radius: 5px; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.3); font-size: 14px; max-width: 400px;';
document.body.appendChild(notification);
setTimeout(() => {
notification.style.opacity = '0';
notification.style.transition = 'opacity 0.3s';
setTimeout(() => notification.remove(), 300);
}, 2000);
}).catch(err => {
alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø–∏–∫: ' + topic);
});
} else {
// Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
const textArea = document.createElement('textarea');
textArea.value = topic;
textArea.style.position = 'fixed';
textArea.style.opacity = '0';
document.body.appendChild(textArea);
textArea.select();
try {
document.execCommand('copy');
alert('–¢–æ–ø–∏–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + topic);
} catch (err) {
alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø–∏–∫');
}
document.body.removeChild(textArea);
}
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–ø–∏–∫–æ–≤
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
if (typeof document !== 'undefined') {
document.addEventListener('click', function(e) {
if (e.target && e.target.classList.contains('mqtt-topic')) {
const topic = e.target.getAttribute('data-topic') || e.target.textContent;
if (topic && !topic.includes('{prefix}')) {
copyMqttTopic(topic);
}
}
});
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
function checkForUpdates() {
const statusEl = document.getElementById('updateStatus');
const installBtn = document.getElementById('installUpdateBtn');

if (statusEl) {
statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...';
statusEl.style.background = '#3498DB';
}

fetch('/api/update/check')
.then(r => {
if (!r.ok) {
throw new Error(`HTTP ${r.status}: ${r.statusText}`);
}
return r.json();
})
.then(d => {
const currentEl = document.getElementById('currentVersion');
const latestEl = document.getElementById('latestVersion');

if (currentEl) currentEl.value = d.currentVersion || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
if (latestEl) latestEl.value = d.latestVersion || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–Ω–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π")
if (d.error && d.error !== "Could not check for updates. Check serial output for details.") {
// –≠—Ç–æ —Ä–µ–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, WiFi –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
if (statusEl) {
statusEl.textContent = '–û—à–∏–±–∫–∞: ' + d.error;
statusEl.style.background = '#dc3545';
}
if (installBtn) installBtn.style.display = 'none';
return;
}

// –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
if (d.updateAvailable) {
if (statusEl) {
statusEl.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!';
statusEl.style.background = '#28a745';
}
if (installBtn) installBtn.style.display = 'inline-block';
} else {
// –ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–µ –æ—à–∏–±–∫–∞
if (statusEl) {
statusEl.textContent = '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è';
statusEl.style.background = '#6c757d';
}
if (installBtn) installBtn.style.display = 'none';
}
})
.catch(e => {
if (statusEl) {
statusEl.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: ' + e.message;
statusEl.style.background = '#dc3545';
}
if (installBtn) installBtn.style.display = 'none';
});
}

function installUpdate() {
if (!confirm('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ? –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –ü—Ä–æ–≥—Ä–µ—Å—Å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–∞ OLED –¥–∏—Å–ø–ª–µ–µ.')) {
return;
}

const statusEl = document.getElementById('updateStatus');
const installBtn = document.getElementById('installUpdateBtn');

if (statusEl) {
statusEl.textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...';
statusEl.style.background = '#ffc107';
}
if (installBtn) installBtn.disabled = true;

fetch('/api/update/install', { method: 'POST' })
.then(r => r.json())
.then(d => {
if (d.success) {
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å, –∂–¥–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
setTimeout(() => {
window.location.reload();
}, 5000);
} else {
if (statusEl) {
statusEl.textContent = '–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + (d.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
statusEl.style.background = '#dc3545';
}
if (installBtn) installBtn.disabled = false;
}
})
.catch(e => {
if (statusEl) {
statusEl.textContent = '–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
statusEl.style.background = '#dc3545';
}
if (installBtn) installBtn.disabled = false;
});
}

function loadUpdateSettings() {
fetch('/api/update/settings')
.then(r => r.json())
.then(d => {
const autoCheckEl = document.getElementById('autoCheckEnabled');
const intervalEl = document.getElementById('checkInterval');

if (autoCheckEl) autoCheckEl.checked = d.autoCheckEnabled || false;
if (intervalEl) intervalEl.value = d.checkInterval || 24;
})
.catch(e => );
}

function saveUpdateSettings() {
const autoCheckEl = document.getElementById('autoCheckEnabled');
const intervalEl = document.getElementById('checkInterval');

const data = {
autoCheckEnabled: autoCheckEl ? autoCheckEl.checked : false,
checkInterval: intervalEl ? parseInt(intervalEl.value) : 24
};

fetch('/api/update/settings', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(data)
})
.then(r => r.json())
.then(d => {
if (d.success) {
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
} else {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
}
})
.catch(e => {
alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
});
}
</script></body></html>

